function HashMap(){var i=0,n={};this.isEmpty=function(){return 0==i},this.containsKey=function(e){return e in n},this.containsValue=function(e){for(var t in n)if(n[t]==e)return!0;return!1},this.put=function(e,t){this.containsKey(e)||i++,n[e]=t},this.get=function(e){return this.containsKey(e)?n[e]:null},this.remove=function(e){var t;return this.containsKey(e)?(t=n[e],delete n[e],i--,t):null},this.values=function(){var e,t=[];for(e in n)t.push(n[e]);return t.sort()},this.keySet=function(){var e,t=[];for(e in n)t.push(e);return t.sort()},this.size=function(){return i},this.clear=function(){i=0,n={}}}function getPos_X(e){for(var t=0,i=e.offsetWidth;t+=e.offsetLeft,e=e.offsetParent;);return t+i}function getPos_Y(e){for(var t=0;t+=e.offsetTop,e=e.offsetParent;);return t+5}!function(){console.log(this)}(window);var SystemData={getDataList:function(){return window.DataList},getAppData:function(){return window.appData}};function Application(){this.tokenId=null,this.lastAccessTime=null,this.requestCount=0}try{void 0===parent.appData?(window.appData=new Application,window.appData.tokenId="dummyId"):window.appData=parent.appData}catch(e){}$.ajaxSetup({xhrFields:{withCredentials:!0},crossDomain:!0});var DEF_DEFINITIONS={REG_DEF_RENDERED:"RGRD",REG_DEF_FORMINGRID_RENDERRED:"RFIGRD",REG_DEF_GRID_DELETE:"RDGD"},TAG_DEFINITIONS={REGION_APP_TAG:"REGION",REG_TAG_LS:"region-list",REG_TAG_INDEX_LS:"index",LAST_ITEM_IN_LS:"lastRowItem"};function getBrowserVerion(){var e=navigator.userAgent,t=-1<e.indexOf("Opera");return t?1:-1<e.indexOf("Firefox")?2:-1<e.indexOf("Chrome")?3:-1<e.indexOf("Safari")?4:-1<e.indexOf("Windows")||-1<e.indexOf("MSIE")&&!t?5:void 0}var browserVersion=getBrowserVerion(),RegionUtil={getElemPosition:function(e){var t=e.getBoundingClientRect();return{x:t.left,y:t.top,w:$(e).outerWidth(!0),h:$(e).outerHeight(!0)}},addRegionDetailHolder:function(){var e;null==window.regionDetailHolder&&((e=document.createElement("div")).className="region-info",$(e).css("position","absolute").css("width","100%").css("height","2rem").css("bottom","0rem").css("color","white").css("padding","0.2rem 0.5rem 0.2rem 2rem").css("background","rgba(0,0,0,0.5)").css("border","1px solid blue"),document.body.appendChild(e),window.regionDetailHolder=$(e))},regionClickFunction:function(e){var t;null==document.lastClickTime?document.lastClickTime=(new Date).getTime():((t=(new Date).getTime())-document.lastClickTime<300&&((document.lastClickTime=null)!=(e=RS.getRegionByEvent(e))&&(e.rcsFile.startWith("common/shared/preview/comp-detail.rs")||openDrawerWindow("common/shared/preview/comp-detail.rs?targetRegionId="+e.regionId,"替换组件","50%"))),document.lastClickTime=t)},regionOverFunction:function(e){var t=RS.getRegionByEvent(e);null!=window.regionDetailTarget&&$(window.regionDetailTarget.regionDivElem).removeClass("actived"),null!=t?(regionDetailHolder.text("双击组件区域可替换组件     "+t.rcsFile),$(t.regionDivElem).addClass("actived")):regionDetailHolder.text(""),e.stopPropagation(),window.regionDetailTarget=t},edit:function(){RegionUtil.addRegionDetailHolder(),document.addEventListener("mouseover",RS.regionOverFunction),document.addEventListener("click",RS.regionClickFunction)},quitEdit:function(){document.removeEventListener("mouseover",RS.regionOverFunction),document.removeEventListener("click",RS.regionClickFunction),null!=window.regionDetailHolder&&(window.regionDetailHolder.remove(),window.regionDetailHolder=null)},enableCopy:function(e){var t;null!=e.getAttribute("copy")&&null==e.getAttribute("en-copy")&&(e.setAttribute("en-copy",""),(t=$(e)).click(function(){RS.copy(t.text()),RS.alert("已复制")}))},enablePrompt:function(e){var a;null!=e.getAttribute("prompt")&&null==e.getAttribute("en-prompt")&&(a=$(e),e.setAttribute("en-prompt",""),a.mouseenter(function(){var e,t,i=this,n=RS.getRegionByElem(i),r=a.text().trim();""!=r&&((e=new HashMap).put("msg",r),r=i.getAttribute("prompt"),null!=(t=i.getAttribute("prompt-width"))&&""!=t||(t=$(i).outerWidth()),RS.showMsgAuto(i,RegionUtil.appendParaMapToUrl(r=null!=r&&""!=r?r:"common/shared/float-dialog/promptMsg.rs",e),null,10,t,!0).done(function(e){null!=n.promptRegionId&&RS.clearMsg(n.promptRegionId),n.promptRegionId=e.regionId}))}),a.mouseleave(function(){var e=RS.getRegionByElem(this),t=e.promptRegionId;null!=t&&(e.promptRegionId=null,RS.clearMsg(t))}))},setDigits:function(e,t){e.addClass("digits");for(var i="",n=t.toString().split(""),r="zero one two three four five six seven eight nine".split(" "),a=0;a<n.length;a++)"."==n[a]?i+='<div class="dot"></div>':i+='<div class="'+r[n[a]]+'"><span class="d1"></span><span class="d2"></span><span class="d3"></span><span class="d4"></span><span class="d5"></span><span class="d6"></span><span class="d7"></span></div>';e.html(i)},getLoginInfo:function(){return JSON.parse(RegionUtil.getCookie("_region_login"))},addHock:function(e,t){"onload"==(e=e.toLowerCase())?RegionUtil.onLoadHock.push(t):"onrelease"==e&&RegionUtil.onReleaseHock.push(t)},onLoadHock:[],onReleaseHock:[],callOnReleaseHock:function(e){if(null!=RS.onReleaseHock)for(var t=0;t<RS.onReleaseHock.length;t++){var i=RS.onReleaseHock[t];"function"==typeof i&&i.call(e)}},callOnLoadHock:function(e){if(null!=RS.onLoadHock)for(var t=0;t<RS.onLoadHock.length;t++){var i=RS.onLoadHock[t];"function"==typeof i&&i.call(e)}},enableScroll:function(i){var n=RS.getRegionByElem(i[0]);setTimeout(function(){RegionUtil.appendHtml(n,i[0],' <div class="match-parent tableScrollControl" style="overflow: auto;"><div style="height: 1px;margin-top: 10px"></div></div>');var e,t=n.find(".tableScrollRow");0!=t.length&&(e=(e=t[t.length-1]).scrollWidth-e.offsetWidth,n.find(".tableScrollControl").children().css("width",n.find(".tableScrollControl").width()+e+60),t.addClass("box-right box-left"),n.find(".tableScrollControl").scroll(function(){for(var e=$(this).scrollLeft(),t=n.find(".tableScrollRow"),i=0;i<t.length;i++)$(t[i]).scrollLeft(e),0<e?(t.addClass("shadow-right shadow-left"),t.removeClass("box-right box-left")):(t.removeClass("shadow-right shadow-left"),t.addClass("box-right box-left"))}))})},resolveTag:function(e,t,i,n){if("REGION"!=i){try{if(null==t.getAttribute("region-attr"))return!1}catch(e){return!1}var r=$(t);if(null==t.className)return!1;for(var a=t.className.replace(/\t/g," ").split(" "),o={},l=0;l<a.length;l++){var s=a[l].trim();""!==s&&(o[s]=!0)}if("VIEW"==i){if(o.barcode)return r.hasClass("wrapped")||(r=BarcodePlugin.render(e,r,n)),!0;if(o.qrcode)return r.hasClass("wrapped")||(r=QrcodePlugin.render(e,r,n)),!0;if(o.code)return r.hasClass("wrapped")||(r=CodePlugin.render(e,r,n)),!0;if(o.image)return r.hasClass("wrapped")||(r=ImgPlugin.view(e,r,n)),!0;if(o.video)return r.hasClass("wrapped")||(r=VideoPlugin.view(e,r,n)),!0}else{if(o.date)return r.hasClass("wrapped")||(r=DatepickerPlugin.render(e,r,n)),!0;if(o.star)return r.hasClass("wrapped")||(r=StarPlugin.render(e,r,n)),!0;if(o["items-input"])return r.hasClass("wrapped")||(r=ItemsinputPlugin.render(e,r,n)),!0;if(o["split-input"])return r.hasClass("wrapped")||(r=SplitInputPlugin.render(e,r,n)),!0;if(o.switch)return r.hasClass("wrapped")||(r=SwitchPlugin.render(e,r,n)),!0;if(o.numcounter)return r.hasClass("wrapped")||(r=NumcounterPlugin.render(e,r,n)),!0;if(o.slider)return r.hasClass("wrapped")||(r=SliderPlugin.render(e,r,n)),!0;if(o.timepicker)return r.hasClass("wrapped")||(r=TimePickerPlugin.render(e,r,n)),!0;if(o.time)return r.hasClass("wrapped")||(r=TimePickerPlugin.render(e,r,n)),!0;if(o.colorpicker)return r.hasClass("wrapped")||(r=ColorPickerPlugin.render(e,r,n)),!0;if(o.transfer)return r.hasClass("wrapped")||(r=TransferPlugin.render(e,r,n)),!0;if(o.richinput)return r.hasClass("wrapped")||(r=RichInputPlugin.render(e,r,n)),!0;if(o.img)return r.hasClass("wrapped")||(r=ImgPlugin.render(e,r,n)),!0;if(o.video)return r.hasClass("wrapped")||(r=VideoPlugin.render(e,r,n)),!0;if(o["color-picker"])return r.hasClass("wrapped")||(r=ColorPickerPlugin.render(e,r,n)),!0;if(o["multi-text"])return r.hasClass("wrapped")||(r=InputMutiPlugin.render(e,r,n)),!0;if(o["editable-table"])return r.hasClass("wrapped")||(r=EditableTablePlugin.render(e,r,n)),!0;if(o.file)return r.hasClass("wrapped")||(r=FilePlugin.render(e,r,n)),!0;var d=r.attr("type");if("INPUT"==i){if("text"==d)return r.hasClass("wrapped")||(r=InputPlugin.render(e,r,n)),!0;if("password"==d)return r.hasClass("wrapped")||(r=PasswordPlugin.render(e,r,n)),!0}else"hidden"==d&&r.val(n)}if("SPAN"==i||"TD"==i||"DIV"==i||"LI"==i||"I"==i){if(null==t.getAttribute("region-ds"))return null!=n&&("false"==t.getAttribute("escapeHtml")?t.innerHTML=n:t.innerText=n),!0}else"IMG"==i&&$(t).attr("src",n);return RegionUtil.resolveDataSourceTag(e,t,i,n)}RegionTagPlugin.render(e,$(t),n)},isPlainTag:function(e){return"SPAN"==e||"TD"==e||"DIV"==e},resolveDataSourceTag:function(region,htmlElem,tagName,selectValue){try{if(null==htmlElem.getAttribute("region-attr"))return!1}catch(e){return!1}var tmpObj=$(htmlElem);if(tmpObj.selectValue=selectValue,tmpObj.hasClass("wrapped")){for(var classNames=tmpObj.parent()[0].className.replace(/\t/g," ").split(" "),classObject={},i=0;i<classNames.length;i++){var tmpClassName=classNames[i].trim();""!==tmpClassName&&(classObject[tmpClassName]=!0)}if(classObject["dropdown-wrapper"]){if(tmpObj.hasClass("inner"))return;DropdownPlugin.updateVal(region,tmpObj.parent(),tmpObj,tmpObj.selectValue)}else if(classObject["m-dropdown-wrapper"]){if(tmpObj.hasClass("inner"))return;MultiDropdownPlugin.updateVal(region,tmpObj.parent(),tmpObj,tmpObj.selectValue)}else classObject["checkbox-wrapper"]?CheckboxPlugin.updateVal(region,tmpObj.parent(),tmpObj,tmpObj.selectValue):classObject["radio-wrapper"]?RadioPlugin.updateVal(region,tmpObj.parent(),tmpObj,tmpObj.selectValue):classObject["multiselect-wrapper"]&&MultiSelectPlugin.updateVal(region,tmpObj.parent(),tmpObj,tmpObj.selectValue);return!0}var regionDs=tmpObj.attr("region-ds");if("SELECT"==tagName){tmpObj.attr("multiple")?(tmpObj.attr("region-dsrendered","true"),tmpObj.prop("title",tmpObj.children("option:selected").text()),MultiSelectPlugin.render(region,tmpObj,tmpObj.selectValue)):"multiple"!=tmpObj.attr("type")?(tmpObj.attr("region-dsrendered","true"),tmpObj.prop("title",tmpObj.children("option:selected").text()),DropdownPlugin.render(region,tmpObj,tmpObj.selectValue)):(tmpObj.attr("region-dsrendered","true"),tmpObj.prop("title",tmpObj.children("option:selected").text()),MultiDropdownPlugin.render(region,tmpObj,tmpObj.selectValue));var loadedCallBack=eval(tmpObj.attr("loadedCallBack"));null!=loadedCallBack&&"function"==typeof loadedCallBack&&loadedCallBack(region,tmpObj)}else if("INPUT"==tagName){var parentNode=null,loadedCallBack=("radio"==tmpObj.attr("type")&&null!=tmpObj.attr("region-ds")?(tmpObj.attr("region-dsrendered","true"),RadioPlugin.render(region,tmpObj,tmpObj.selectValue)):"checkbox"==tmpObj.attr("type")&&null!=tmpObj.attr("region-ds")&&(tmpObj.attr("region-dsrendered","true"),CheckboxPlugin.render(region,tmpObj,tmpObj.selectValue)),eval(tmpObj.attr("loadedCallBack")));null!=loadedCallBack&&"function"==typeof loadedCallBack&&loadedCallBack(region,parentNode)}else{var regionDsName=tmpObj.attr("region-ds"),options=RegionUtil.getRegionDsList(region,regionDsName),array=[];if(null!=options){for(var j=0;j<options.length;j++){var newObj={};newObj.indexNo=i,newObj.desc=options[j].text,newObj.value=options[j].value+"",array.push(newObj)}if(null==tmpObj.selectValue||""===(tmpObj.selectValue+"").trim()){var defaultVal=tmpObj.attr("default");null==defaultVal&&(defaultVal=""),tmpObj.text(defaultVal)}else if((tmpObj.selectValue+"").startWith("[")&&(tmpObj.selectValue+"").endWith("]")){for(var checkedArray=eval(tmpObj.selectValue),tmpText="",y=0;y<checkedArray.length;y++)for(var x=0;x<array.length;x++)if(array[x].value==checkedArray[y]+""){tmpText+=array[x].desc+" ";break}tmpObj.text(tmpText)}else{for(var tmpText="",selectVal=tmpObj.selectValue+"",cacheResult=(null!=selectVal&&(selectVal=selectVal.split(",")),{}),i=0;i<selectVal.length;i++)cacheResult[selectVal[i]+""]=!0;for(var x=0;x<array.length;x++)cacheResult[array[x].value+""]&&(""===tmpText?tmpText=array[x].desc:tmpText+=", "+array[x].desc);tmpObj.text(tmpText),tmpObj.attr("real-val",tmpObj.selectValue)}}}return region.addRegionId(tmpObj[0]),!0},updateValForElem:function(e,t,i){if(0!=t.length){var n=t[0].tagName;if(t.hasClass("wrapped")){for(var r=t.parent(),a=r[0].className.replace(/\t/g," ").split(" "),o={},l=0;l<a.length;l++)""!==(s=a[l].trim())&&(o[s]=!0);o["input-wrapper"]?t.hasClass("inner")||InputPlugin.updateVal(e,r,t,i):o["password-wrapper"]?t.hasClass("inner")||PasswordPlugin.updateVal(e,r,t,i):o["input-muti-wrapper"]?InputMutiPlugin.updateVal(e,r,t,i):o["editable-table-wrapper"]?EditableTablePlugin.updateVal(e,r,t,i):o["calendar-wrapper"]?DatepickerPlugin.updateVal(e,r,t,i):o["star-wrapper"]?StarPlugin.updateVal(e,r,t,i):o["items-input-wrapper"]?ItemsinputPlugin.updateVal(e,r,t,i):o["split-input-wrapper"]?SplitInputPlugin.updateVal(e,r,t,i):o["switch-wrapper"]?SwitchPlugin.updateVal(e,r,t,i):o["numcounter-wrapper"]?NumcounterPlugin.updateVal(e,r,t,i):o["slider-wrapper"]?SliderPlugin.updateVal(e,r,t,i):o["timepicker-wrapper"]?TimePickerPlugin.updateVal(e,r,t,i):o["colorpicker-wrapper"]?ColorPickerPlugin.updateVal(e,r,t,i):o["transfer-wrapper"]?TransferPlugin.updateVal(e,r,t,i):o["richinput-wrapper"]?RichInputPlugin.updateVal(e,r,t,i):o["barcode-wrapper"]?BarcodePlugin.updateVal(e,r,t,i):o["qrcode-wrapper"]?QrcodePlugin.updateVal(e,r,t,i):o["file-wrapper"]?FilePlugin.updateVal(e,r,t,i):o["img-wrapper"]?ImgPlugin.updateVal(e,r,t,i):o["video-wrapper"]?VideoPlugin.updateVal(e,r,t,i):o["code-wrapper"]?CodePlugin.updateVal(e,r,t,i):RegionUtil.resolveDataSourceTag(e,t[0],n,i)}else{for(var s,a=t[0].className.replace(/\t/g," ").split(" "),o={},l=0;l<a.length;l++)""!==(s=a[l].trim())&&(o[s]=!0);if("VIEW"==n)o.barcode?t.hasClass("wrapped")||(t=BarcodePlugin.render(e,t,i)):o.qrcode?t.hasClass("wrapped")||(t=QrcodePlugin.render(e,t,i)):o.code?t.hasClass("wrapped")||(t=CodePlugin.render(e,t,i)):o.image?t.hasClass("wrapped")||(t=ImgPlugin.view(e,t,i)):o.video&&(t.hasClass("wrapped")||(t=VideoPlugin.view(e,t,i)));else if("INPUT"==n){if(o.date)return t.hasClass("wrapped")||(t=DatepickerPlugin.render(e,t,i)),!0;if(o.star)return t.hasClass("wrapped")||(t=StarPlugin.render(e,t,i)),!0;if(o["items-input"])return t.hasClass("wrapped")||(t=ItemsinputPlugin.render(e,t,i)),!0;if(o["split-input"])return t.hasClass("wrapped")||(t=SplitInputPlugin.render(e,t,i)),!0;if(o.switch)return t.hasClass("wrapped")||(t=SwitchPlugin.render(e,t,i)),!0;if(o.numcounter)return t.hasClass("wrapped")||(t=NumcounterPlugin.render(e,t,i)),!0;if(o.slider)return t.hasClass("wrapped")||(t=SliderPlugin.render(e,t,i)),!0;if(o.timepicker)return t.hasClass("wrapped")||(t=TimePickerPlugin.render(e,t,i)),!0;if(o.time)return t.hasClass("wrapped")||(t=TimePickerPlugin.render(e,t,i)),!0;if(o.colorpicker)return t.hasClass("wrapped")||(t=ColorPickerPlugin.render(e,t,i)),!0;if(o.transfer)return t.hasClass("wrapped")||(t=TransferPlugin.render(e,t,i)),!0;if(o.richinput)return t.hasClass("wrapped")||(t=RichInputPlugin.render(e,t,i)),!0;if(o.img)return t.hasClass("wrapped")||(t=ImgPlugin.render(e,t,i)),!0;if(o.video)return t.hasClass("wrapped")||(t=VideoPlugin.render(e,t,i)),!0;if(o["color-picker"])return t.hasClass("wrapped")||(t=ColorPickerPlugin.render(e,t,i)),!0;if(o["multi-text"])return t.hasClass("wrapped")||(t=InputMutiPlugin.render(e,t,i)),!0;if(o["editable-table"])return t.hasClass("wrapped")||(t=EditableTablePlugin.render(e,t,i)),!0;if(o.file)return t.hasClass("wrapped")||(t=FilePlugin.render(e,t,i)),!0;r=t.attr("type");if("INPUT"==n){if("text"==r)return t.hasClass("wrapped")||(t=InputPlugin.render(e,t,i)),!0;if("password"==r)return t.hasClass("wrapped")||(t=PasswordPlugin.render(e,t,i)),!0;if("checkbox"==r){if(t.hasClass("wrapped"))return!0;t.prop("checked",i)}else"hidden"==r&&t.val(i)}}else"SPAN"==n||"TD"==n||"DIV"==n||"LI"==n||"I"==n?null==t.attr("region-ds")?"false"==t.attr("escapeHtml")?t.html(i):t.text(i):RegionUtil.resolveDataSourceTag(e,t[0],n,i):"IMG"==n?t.attr("src",i):"false"==t.attr("escapeHtml")?t.html(i):t.val(i)}}},resolveStaticVariables:function(e,t){for(var i=e.matchAll("<%\\w+%>"),n=i.next().value,r=[];null!=n;)r.push(n),n=i.next().value;return r},resolveDynamicVariables:function(e){for(var t=e.matchAll("{{[\\w|.]+}}"),i=t.next().value,n=[];null!=i;)n.push(i),i=t.next().value;return n},wrapList:function(e,t){for(var i="",n=0;n<t.length;n++)i+=RegionUtil.subWrapList(e,t[n]);return i},subWrapList:function(e,t){for(var i=e.matchAll("\\${[\\w|.]+}"),n=i.next().value,r=[];null!=n;)r.push(n),n=i.next().value;for(var a=e,o=r.length-1;-1<o;o--){var l=(n=r[o])[0],s=null;null==(s=""!=(l=l.substring(2,l.length-1).trim())?t[l]:s)&&(s="");a=a.substring(0,n.index)+s+a.substring(n.index+l.length+3)}return a},resolveRowTemplate:function(e,t){for(var i=e.matchAll("{{[\\w|.]+}}"),n=i.next().value,r=[];null!=n;)r.push(n),n=i.next().value;for(var a=e,o=r.length-1;-1<o;o--){var l=(n=r[o])[0],s=null;null==(s=""!=(l=l.substring(2,l.length-1).trim())?t[l]:s)&&(s="");a=a.substring(0,n.index)+s+a.substring(n.index+l.length+3)}return a},getFileInfoById:function(e){return null==window.filesInfo?null:window.filesInfo[e]},getFileInfoByIds:function(e){if(null==e)return null;if(e instanceof Array){for(var t=[],i=0;i<e.length;i++)t.push(RegionUtil.getFileInfoById(e[i]));return t}return null},getAttrDom:function(e,t){return e.find("[region-attr='"+t+"']").closest(".region-wrapper").find(".wrapped")},disableAttr:function(e,t){e.find("[region-attr='"+t+"']").closest(".region-wrapper").addClass("disabled").find(".wrapped").addClass("disabled")},enableAttr:function(e,t){e.find("[region-attr='"+t+"']").closest(".region-wrapper").removeClass("disabled").find(".wrapped").removeClass("disabled")},disableRowAttr:function(e,t){$(e).find("[region-attr='"+t+"']").closest(".region-wrapper").addClass("disabled").find(".wrapped").addClass("disabled")},enableRowAttr:function(e,t){$(e).find("[region-attr='"+t+"']").closest(".region-wrapper").removeClass("disabled").find(".wrapped").removeClass("disabled")},showRowMsg:function(e,t,i,n,r,a,o){null==r&&(r=0),null==a&&(a="auto"),null==o&&(o=!0);e=$(e).find("[region-attr='"+t+"']").closest(".region-wrapper");return RS.showMsgAuto(e[0],RS.appendParaMapToUrl(i,n),null,r,a,o)},getProvinces:function(){var t=new jQuery.Deferred;return null!=window.provinces?t.resolve(window.provinces):"undefined"!=typeof AndroidClient&&AndroidClient.isFromWebview?(window.provinces=JSON.parse(AndroidClient.getProvincesJson()),t.resolve(window.provinces)):$.getJSON(ResFilePrefix+"libs/cities/provinces.json",function(e){window.provinces=e,t.resolve(window.provinces)}),t.promise()},gotoScreen:function(e,t,i){RegionUtil.getRegionById(e).loadScreen(t,i)},screenBack:function(e){null==e?history.go(-1):history.go(e)},renderWheels:function(e,t,i,n,r,a,o,l,s){var d;null==window.mobileSelect?(d=new MobileSelect,window.mobileSelect=d):window.mobileSelect.divObject.find(".wheel").remove(),window.mobileSelect.refreshWheels(e,t,i,n,r,a,o,l,s)},validateFormItem:function(e){var t=e.getAttribute("region-attr");RegionUtil.getRegionByElem(e).validateItem(t)},searchDialog:function(t,e,i,n){var r,a,o,l,s,d;null!=e?(a=RegionUtil.getRegionByElem((r=this)[0]),"1"!=(o=r.parent()).attr("loaded")?(o.attr("loaded","1"),l=RegionUtil.getDomPosition(r[0]),RegionUtil.appendHtml(a,o[0],'<div class="float-dialog-holder" style="display:none;"></div>'),s=o.find(".float-dialog-holder"),null!=i?s.css("width",i):s.css("width",l.w-10+"px"),null!=n&&s.css("height",n),s.slideDown(100),i=RegionUtil.loadRegion(s,e),s.attr("ot","1"),s.attr("oc","0"),d=RegionUtil.getUUID(),s.attr("uuid",d),i.done(function(e){null==a.floatDialogFunctions&&(a.floatDialogFunctions={}),a.floatDialogFunctions[s.attr("uuid")+"_readyHideDialog"]=function(){setTimeout(function(){var e=s.attr("ot"),t=s.attr("oc");null!=e&&0!=e||null!=t&&0!=t||(s.slideUp(100),s.attr("shown",0))},20)},s.attr("shown","1"),"function"==typeof e.onSearchDialog?e.onSearchDialog(t,a):RegionUtil.alert("search method doesnot exist in target region"),e.hideSearchDialog=function(){s.attr("ot",0),s.attr("oc",0),s.slideUp(100),s.attr("shown",0)},null==a.floatDialogs&&(a.floatDialogs={}),a.floatDialogs[""+d]=e}),r.blur(function(){var e;s.attr("ot","0"),"0"==s.attr("oc")&&(e=s.attr("uuid"),a.floatDialogFunctions[e+"_readyHideDialog"]())}),r.focus(function(){s.attr("ot","1")}),r.mouseover(function(){s.attr("ot","1")}),r.mouseout(function(){var e;s.attr("ot","0"),"0"==s.attr("oc")&&(e=s.attr("uuid"),a.floatDialogFunctions[e+"_readyHideDialog"]())}),s.mouseover(function(){s.attr("oc","1")}),s.mouseout(function(){var e;s.attr("oc","0"),console.log(s.attr("ot")),"0"==s.attr("ot")&&(e=s.attr("uuid"),a.floatDialogFunctions[e+"_readyHideDialog"]())})):((s=o.find(".float-dialog-holder")).slideDown(100),d=s.attr("uuid"),a.floatDialogs[""+d].onSearchDialog(t,a))):console.log("searchRegion is null")},enableDrag:function(e,t){null==t&&(t=e);var i,n,r,a,o=$(t),l=RegionUtil.isPc(),s=l?(i="mousedown",n="mousemove","mouseup"):(i="touchstart",n="touchmove","touchend"),d=function(){var e,t=l?(e=event.clientX,event.clientY):(e=event.targetTouches[0].pageX,event.targetTouches[0].pageY);null==r?((r={}).left=o.css("left"),r.left=parseInt(r.left.replace("px","")),r.top=o.css("top"),r.top=parseInt(r.top.replace("px","")),(a={}).left=e,a.top=t):(e=e-a.left,t=t-a.top,o.css("left",r.left+e+"px"),o.css("top",r.top+t+"px"))},g=function(){document.removeEventListener(n,d),document.removeEventListener(s,g),a=r=null};e.addEventListener(i,function(){document.addEventListener(n,d),document.addEventListener(s,g),r=null})},newListener:function(e){return RegionUtil.eventBus().newListener(e)},eventBus:function(){return null==RegionUtil._privateEventBus&&(RegionUtil._privateEventBus=new EventBus),RegionUtil._privateEventBus},loadingStart:function(e){CoverPlugin.loadingStart(e)},loadingComplete:function(){CoverPlugin.loadingComplete()},disableInput:function(e,t){0!=t?$(e.getRegionDivElem()).css("pointer-events","none"):$(e.getRegionDivElem()).css("pointer-events","auto")},copyObj:function(e){if(null==e)return null;var t,i={};for(t in e)i[t]=e[t];return i},setCache:function(e,t){null==RegionUtil.cacheObj&&(RegionUtil.cacheObj={}),RegionUtil.cacheObj[e]=t},getCache:function(e){null==RegionUtil.cacheObj&&(RegionUtil.cacheObj={});var t=RegionUtil.cacheObj[e];return t=null==t?RegionCache.get(e):t},clearCache:function(){delete RegionUtil.cacheObj,RegionUtil.cacheObj=null},getInnerRegionIds:function(e){if(null==e.childRegionIds)return null;for(var t=[],i=0;i<e.childRegionIds.length;i++){t.push(e.childRegionIds[i]);var n=RegionUtil.getRegionById(e.childRegionIds[i]);null!=n&&(null!=(n=RegionUtil.getInnerRegionIds(n))&&(t=t.concat(n)))}return t},copy:function(e){var t=document.createElement("textarea");t.innerHTML=e,t.className="oInput",document.body.appendChild(t),t.select(),document.execCommand("Copy"),t.style.display="none",$(t).remove()},enableChildDrag:function(e,t){e.children().each(function(){var e=$(this);(null!=t?e.find(t):e).mousedown(function(){e.attr("draggable","true")}),this.removeEventListener("dragstart",RegionUtil.privateDragstart),this.removeEventListener("dragover",RegionUtil.privateDragover),this.removeEventListener("dragend",RegionUtil.privateDragend),this.addEventListener("dragstart",RegionUtil.privateDragstart),this.addEventListener("dragover",RegionUtil.privateDragover),this.addEventListener("dragend",RegionUtil.privateDragend)})},privateDragstart:function(e){var t=RegionUtil.getEventTarget(e),i=RegionUtil.getRegionByElem(t);i.dragObject=$(t),i.dragInterval=setInterval(function(){i.dragObject.addClass("minimized")},100),i.insertedBefore=!1,i.insertAfter=!1,e.dataTransfer.setData("Text","")},privateDragover:function(e){var t,i,n=RegionUtil.getEventTarget(e);null!=(n=$(n).hasClass(".editable-row")?n:0==(n=$(n).closest(".editable-row")).length?null:n[0])&&null!=(t=RegionUtil.getRegionByElem(n))&&(i=t.dragObject,2*e.offsetY<$(n).height()?1!=t.insertedBefore&&(i.insertBefore($(n)),t.insertedBefore=!0,t.insertAfter=!1):1!=t.insertAfter&&(i.insertAfter($(n)),t.insertAfter=!0,t.insertedBefore=!1)),e.preventDefault()},privateDragend:function(e){e.preventDefault();e=RegionUtil.getRegionByEvent(e);null!=e.dragObject&&(e.dragObject.attr("draggable","false"),e.dragObject.removeClass("minimized"),clearInterval(e.dragInterval),e.dragObject=null)},getDsDesc:function(e,t,i){var n=RegionUtil.getRegionDsList(i,e);if(null==n||0==n.length)return null;for(var r=0;r<n.length;r++)if(n[r].value==t)return n[r].text},getRegionDsList:function(e,t){var i,n,r=null;if(null!=e){if(null!=(r=null!=e.regionData&&null!=e.regionData[t]?e.regionData[t]:r)){if(r instanceof Array)return r;r=null}null==r&&null!=e.resources&&null!=e.resources.dataList&&(i=Config.locale,null!=(n=null==(r=null!=(n=e.resources.dataList[i=""===i?"dft":i])?n[t]:r)&&"dft"!=i?e.resources.dataList.dft:n)&&(r=n[t]))}return r=null==(r=null==r?DataList.get(t):r)?[]:r},isPc:function(){for(var e=navigator.userAgent,t=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],i=!0,n=0;n<t.length;n++)if(0<e.indexOf(t[n])){i=!1;break}return i},encodePara:function(e){return encodeURIComponent(JSON.stringify(e))},decodePara:function(e){return JSON.parse(decodeURIComponent(e))},getUUID:function(){return RegionUtil.UUID()},UUID:function(){var e=setTimeout("0");return clearTimeout(e),e+""},debug:function(e){console.log(e)},error:function(e){console.log(e)},getOuterRegion:function(e){return null==e.getRegionDivContainer().parentNode?null:RegionUtil.getRegionById(e.getRegionDivContainer().parentNode.getAttribute("region-id"))},refreshDs:function(e,t,i,n){RS.refreshRegionDsElement(e,t,i,n)},refreshRegionDsElement:function(e,t,i,n){t=e.find("input[region-attr='"+t+"']"),null!=n&&t.val(n),n=t.parent();n.hasClass("select-wrapper")||n.hasClass("dropdown-wrapper")?DropdownPlugin.refreshDataSource(e,n,t,i):n.hasClass("m-select-wrapper")?MultiDropdownPlugin.refreshDataSource(e,n,t,i):n.hasClass("multiselect-wrapper")?MultiSelectPlugin.refreshDataSource(e,n,t,i):n.hasClass("radio-wrapper")?RadioPlugin.refreshDataSource(e,n,t,i):n.hasClass("checkbox-wrapper")&&CheckboxPlugin.refreshDataSource(e,n,t,i)},convertListToTree:function(e){e=RegionUtil.clone(e);for(var t=[],i={},n=0;n<e.length;n++)i[e[n].id]=e[n],"0"!=e[n].parentNodeId&&"null"!=e[n].parentNodeId&&""!==e[n].parentNodeId||(e[n].depth=1,t.push(e[n])),null==e[n].text&&null!=e[n].label&&(e[n].text=e[n].label);for(n=0;n<e.length;n++){var r=i[e[n].parentNodeId];null!=r&&(null==r.childs&&(r.childs=new Array),e[n].depth=r.depth+1,r.childs.push(e[n]))}for(n=0;n<t.length;n++){var a=RegionUtil.getDepthForTreeNode(t[n]);t[n].treeDepth=a}return delete i,i=null,t},getDepthForTreeNode:function(e){var t=e.childs;if(null==t||0==t.length)return 1;for(var i=0,n=0;n<t.length;n++){var r=RegionUtil.getDepthForTreeNode(t[n]);i<r&&(i=r)}return i+1},newRegion:function(e,t,i){return new StaticRegion(e,t,i)},newFormRegion:function(e,t,i){return new RegionForm(e,i,null,null,null,t)},newGridRegion:function(e,t,i){return new RegionGrid(e,i,null,t)},newStaticRegion:function(e,t,i){return new StaticRegion(e,t,i)},getCurrentLocale:function(){return RegionUtil.getCookie("locale")},setLocale:function(e){var t=new jQuery.Deferred,e=(RegionUtil.setCookie("locale",e),Config.locale=e,Config.frontendPath+"messages_"+e+"/global_msg.js");return $.getScript(e).done(function(){$(document).find(".messagelabel").each(function(){var e=this.getAttribute("key"),t=this.getAttribute("region-id"),t=RegionUtil.getRegionById(t),t=RegionUtil.getMessage(t,e);$(this).text(t)}),$(document).find(".messageoptions").each(function(){for(var e=$(this),t=e.parent(),i=RegionUtil.getRegionByElem(this),n=t.find(".wrapped").attr("region-ds"),r=RegionUtil.getRegionDsList(i,n),a={},o=0;o<r.length;o++)a[r[o].value+""]=r[o].text;e.children("li").each(function(){var e=this.getAttribute("val");$(this).hasClass("selected")&&t.find("input[type='text']").val(a[e]),$(this).text(a[e])})}),t.resolve()}),t.promise()},getMessage:function(region,keyVal){if(null==keyVal)return null;var localeStr=Config.locale,text=(""===localeStr&&(localeStr="dft"),null);if(keyVal.startWith("global_msg."))try{return text=eval(keyVal),text}catch(e){}if(null!=region.resources&&null!=region.resources.message&&null!=region.resources.message[localeStr]&&(text=region.resources.message[localeStr][keyVal]),null!=text&&""!==text||"dft"==localeStr||(text=region.resources.message.dft[keyVal]),null==text||""===text){try{text=eval(keyVal)}catch(e){}"function"==typeof text&&(text=keyVal),null!=text&&""!==text||(text=keyVal)}return text},attributeCount:function(e){var t,i=0;for(t in e)i++;return i},firstCapWord:function(e){e.value=e.value.replace(/[^a-zA-Z0-9_]/g,"").firstCapitalize()},firstSmallWord:function(e){e.value=e.value.replace(/[^a-zA-Z0-9_]/g,"").firstSmall()},numberOnly:function(e){e.value=e.value.replace(/[^0-9]/g,"")},isEmpty:function(e){return null==e||""===e.trim()},reportFrontEndError:function(e,t,i){null!=t&&(e.srcUrl=t.mainUrl),e.requestId=i;try{RegionUtil.ajaxJsonTask(Config.backendPath+"/admin/errorlog/reportFrontendError","POST",e)}catch(e){console.log(e)}},getTopWindow:function(e){return e.parent!=e?RegionUtil.getTopWindow(e.parent):e},cleanRegions:function(){var e=window.regions;if(null!=e)for(tmp in e){var t=e[tmp];null!=t&&0==$(t.getRegionDivElem()).height()&&ErrorPromptPlugin.cleanErrorsForRegion(t)}},findInHtmlObj:function(e,t){for(var i=e.getAttribute("region-id"),n=(null!=i&&""!==i||(console.log(e),console.log(t),alert("Error in RegionUtil.findInHtmlObj")),$(e).find(t)),r=0;r<n.length;r++)n[r].getAttribute("region-id")!=i&&(n.splice(r,1),r--);return n},findInRegion:function(e,t){var i=RegionUtil.getRegionById(t);if(null!=i){for(var n=$(i.getRegionDivElem()).find(e),r=0;r<n.length;r++)n[r].getAttribute("region-id")!=t&&(n.splice(r,1),r--);return n}},disableReady:!1,ready:function(e){RegionUtil.disableReady||$(document).ready(function(){e()})},loadMessage:function(e){return RegionUtil.loadJs(Config.frontendPath+e)},loadAbsMessage:function(e){return RegionUtil.loadJs(e)},loadJs:function(e){var t=new jQuery.Deferred;if(null!=document.getElementById(e))return t.resolve(),t.promise();var i=document.getElementsByTagName("HEAD").item(0),n=document.createElement("script");return n.type="text/javascript",n.defer=!0,n.src=e,n.id=e,n.readyState?n.onreadystatechange=function(){"loaded"!=n.readyState&&"complete"!=n.readyState||(i.appendChild(n),t.resolve())}:(i.appendChild(n),n.onload=function(){t.resolve()}),t.promise()},loadCss:function(e){var t=document.getElementsByTagName("HEAD").item(0),i=document.createElement("link");i.rel="stylesheet",i.href=e,t.appendChild(i)},alert:function(e,t,i){return null==t&&(t=global_msg.alert),RegionUtil.isPc()?AlertPlugin.alert(e,t):RegionUtil.toast(e,i)},confirm:function(e,t,i,n){return AlertPlugin.confirm(e,t,i,n)},appAlert:function(e,t){RegionUtil.alert(e,t)},appConfirm:function(e,t,i,n){RegionUtil.confirm(e,t,i,n)},toast:function(e,t){return AlertPlugin.toast(e,t)},prompt:function(e,t,i,n,r,a){return AlertPlugin.prompt(e,t,i,n,r,a)},getClosest:function(e,t){return 5==browserVersion?$(e).closest(t).get(0):e.closest(t)},wrapBtnParameters:function(e){for(var t=e.find(".parameter"),i=new HashMap,n=0;n<t.length;n++){var r=$(t[n]);i.put(r.attr("paraName"),r.val())}return i},parseMapToUrlParameter:function(e){var t=e.keySet(),i="";if(0!=t.length)for(var n=0;n<t.length;n++)i+=t[n]+"="+e.get(t[n]),n<t.length-1&&(i+="&");return i},handleListDataByPrimaryval:function(e,t){var i=RegionUtil.getEventTarget(e),e=(e.stopPropagation(),RegionUtil.getRegionByElem(i)),n=$(i).closest("*[index]").attr("primary-val");t.call(e,n,i)},getRowIdByEvent:function(e){var t=RegionUtil.getEventTarget(e);e.stopPropagation(),RegionUtil.getRegionByElem(t);return $(t).closest("*[index]").attr("primary-val")},getRowDataByEvent:function(e){var t=RegionUtil.getEventTarget(event),i=RegionUtil.getRegionByElem(t);if(null!=i){var n=$(t).closest("*[index]"),r=n.attr("primary-val"),a=n.attr("index"),o=i.regionData[$(t).closest(".region-list").attr("region-list")],l=null;if(null!=r){for(var s=0;s<o.length;s++)if(o[s].id==r){(l=o[s]).index=a;break}}else(l=o[a]).index=a;return l}},handleListData:function(e,t){var i,n=RegionUtil.getEventTarget(e),r=RegionUtil.getRegionByElem(n);null!=r&&(e.stopPropagation(),e=RegionUtil.getRowDataByEvent(e),i=$(n).closest("*[index]"),t.call(r,e,n,i))},callRegionFunction:function(e,t){var i=RegionUtil.getEventTarget(event),i=RegionUtil.getRegionByElem(i);"function"==typeof i[e]&&i[e](t,event)},callRegionScopeFunction:function(region,regionScopeFunction,para){var func=eval("region_"+region.regionId+"."+regionScopeFunction);"function"==typeof func?func.call(region,para):RegionUtil.alert(regionScopeFunction+" isn't defined")},getRegionScopeFunction:function(region,regionScopeFunction){var func=eval("region_"+region.regionId+"."+regionScopeFunction);return"function"==typeof func?func:null},getSelectedCheckboxValues:function(e,t){var e=e.find(t),i=[];return $.each(e,function(e,t){t.checked&&(t=RegionUtil.getRowData(t),i.push(t.id))}),i},getDisselectedCheckboxValues:function(e,t){var e=e.find(t),i=[];return $.each(e,function(e,t){t.checked||(t=RegionUtil.getRowData(t),i.push(t.id))}),i},getRowData:function(e){var t=RegionUtil.getRegionByElem(e),i=$(e).closest("*[index]");if(null==i||i.attr("region-id")!=t.regionId)return null;for(var e=$(e).closest(".region-list").attr("region-list"),n=i.attr("primary-val"),r=t.regionData[e],a=null,o=0;o<r.length;o++)if(r[o].id==n){a=r[o];break}return a},createNewDef:function(e){var t;return null==window.regionDef&&(window.regionDef={}),null==window.regionDef[e]?(t=new jQuery.Deferred,(window.regionDef[e]=t).promise()):window.regionDef[e].promise()},resolveDef:function(e,t){var i=window.regionDef[e];null!=i&&(i.resolve(t),window.regionDef[e]=null)},suspend:function(){return new jQuery.Deferred},wrapRegionParas:function(e,t){e=e.parentNode.getAttribute("region-url");return null!=e&&(t.clear(),RegionUtil.fillParamap(e,t)),e},getUrlParaMap:function(){var e=new HashMap,t=location.search.substr(1).split("&");if(t)for(var i=0;i<t.length;i++){var n=t[i].substring(0,t[i].indexOf("="));null!=n&&""!==n&&e.put(t[i].substring(0,t[i].indexOf("=")),decodeURIComponent(t[i].substring(t[i].indexOf("=")+1)))}return e},fillParamap:function(e,t){var i=e.indexOf("?");if(-1!=i)for(var n=e.substring(i+1).split("&"),r=0;r<n.length;r++){var a=n[r].split("=");t.put(a[0],decodeURIComponent(a[1]))}},appendParaMapToUrl:function(e,t){if(null==t)return e;for(var i,n=t.keySet(),r="",a=0;a<n.length;a++)""===n[a]||null==n[a]||null!=(i=t.get(n[a]))&&(r+="object"==typeof i?n[a]+"="+encodeURIComponent(JSON.stringify(i)):n[a]+"="+encodeURIComponent(i),a<n.length-1&&(r+="&"));var o=e.indexOf("?");return r=null!=r&&""!=r?-1==o?e+"?"+r:e+"&"+r:e},appendParaObjectToUrl:function(e,t){if(null==t)return e;var i,n=new HashMap;for(i in t)n.put(i,t[i]);return RegionUtil.appendParaMapToUrl(e,n)},invoke:function(e,t,i,n,r){return contentType=1==n?"application/json; charset=UTF-8":"application/x-www-form-urlencoded; charset=UTF-8",RegionUtil.ajaxJsonTask(e,t,i,null,null,r,contentType)},call:function(e,t,i,n,r,a){return RegionUtil.ajaxJsonTask(e,t,i,n,null,r,a)},ajaxJsonTask:function(e,t,i,n,r,a,o){null==a&&(a=!0);var l=new jQuery.Deferred;return RegionUtil.ajaxRequestJson(null,e,t,i,function(e,t){if(null!=n&&"function"==typeof n)try{n(e,t)}catch(e){console.log(e),null!=r&&"function"==typeof r&&r.call()}l.resolve(e,t)},a,l,function(){null!=r&&"function"==typeof r&&r.call(),l.resolve(!1,i)},o),l.promise()},pendingRequests:new HashMap,combileRequestStartTime:null,putMergedRequestJson:function(e,t){0!=RegionUtil.pendingRequests.size()&&null!=RegionUtil.combileRequestStartTime||(RegionUtil.combileRequestStartTime=(new Date).getTime()),RegionUtil.pendingRequests.put(e,t),RegionUtil.sendMergedRequestJson()},decryptStr:function(e){if(null==e)return null;var t=CryptoJS.enc.Utf8.parse("323412A412ABCDHF"),i=CryptoJS.enc.Utf8.parse("AOCDEF12341X34I2");return unzip(CryptoJS.AES.decrypt(e,t,{iv:i,mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.Pkcs7}).toString(CryptoJS.enc.Base64))},encryptStr:function(e){if(null==e)return null;var t=CryptoJS.enc.Utf8.parse("323412A412ABCDHF"),i=CryptoJS.enc.Utf8.parse("AOCDEF12341X34I2"),e=CryptoJS.enc.Base64.parse(zip(e)),e=CryptoJS.AES.encrypt(e,t,{iv:i,mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.Pkcs7}),t=CryptoJS.enc.Hex.parse(e.ciphertext.toString());return CryptoJS.enc.Base64.stringify(t)},encryptData:function(e){for(var t in e)e[t]=RegionUtil.encryptStr(e[t])},decriptData:function(e){for(var t in e)e[t]=RegionUtil.decryptStr(e[t])},ajaxRequestJson:function(n,g,u,r,a,e,c,o,t){if(null!=r)for(x in r)null==r[x]&&delete r[x];null==e&&(e=!0);var i,l,p,s={},d=(null==t&&(t="application/x-www-form-urlencoded; charset=UTF-8"),null!=Config.requestInterceptor?s=Config.requestInterceptor(r):(null==r&&(r={}),(i={}).data=JSON.stringify(r),l=getUUID2().replaceAll("-",""),i.requestId=l,null!=n&&null!=n.paraMap?null!=(p=n.paraMap.get("rsAppId"))&&(i.rsAppId=p):null!=r.rsAppId&&(i.rsAppId=r.rsAppId),s.requestStr=i.data),"unknown");null!=n&&null!=n.regionId&&(d=n.regionId),1==Config.encrypt&&RegionUtil.encryptData(s),Config.REGION_DEBUG_MODE&&console.log(s),Config.REGION_DEBUG_MODE&&console.log(d+":Sending data to server:"+s.requestStr),$.ajax({url:g,type:u,data:s,cache:!1,async:e,contentType:t,beforeSend:function(e){var t;"undefined"!=typeof AndroidClient&&AndroidClient.isFromWebview&&(null!=(t=AndroidClient.getToken())?RegionUtil.setCookie("_token",t):RegionUtil.delCookie("_token")),e.setRequestHeader("Request-Id",l)},success:function(e,t,i){if(i.getResponseHeader("encrypt")&&(e=RegionUtil.decryptStr(e),e=JSON.parse(e)),Config.REGION_DEBUG_MODE&&console.log(d+":revceived data from server:"),Config.REGION_DEBUG_MODE&&console.log(e),null!=Config.responseInterceptor)Config.responseInterceptor.call(n,e);else if(0==e.success){if("401"==e.respCode)return void LoginPlugin.preLogin();"403"==e.respCode||"405"==e.respCode||"409"==e.respCode?null!=n?(n.regionData=e,RegionUtil.loadRegion($(n.getRegionDivElem()).parent(),"common/shared/error/"+e.respCode+".rs",null)):RegionUtil.alert(global_msg.access_forbidden):"700"==e.respCode&&RegionUtil.alert(e.msg)}"function"==typeof a&&a.call(n,e,r,c)},error:function(e,t,i){console.log("revceived error from server:"+t),null==Config.netErrorInterceptor?(0==e.readyState?RegionUtil.alert(global_msg.connection_error):1==e.readyState?RegionUtil.alert(global_msg.sending_error):4==e.readyState&&RegionUtil.alert(global_msg.connection_error),"function"==typeof o&&o.call()):Config.netErrorInterceptor(e.readyState)},complete:function(e,t){}})},preLoadRegion:function(e){return RegionUtil.ajaxGetStaticPage(e)},getJson:function(e){var t=new jQuery.Deferred;return $.getJSON(e+"?v="+Config.releaseVersion,function(e){t.resolve(e)}),t.promise()},ajaxGetStaticPage:function(n){var r=new jQuery.Deferred,e=r.promise(),t=n,t=(t.startWith("/")||(t="/"+t),RegionUtil.getCache("page:"+t)),t=(null!=t&&r.resolve(t),n+"?v="+Config.releaseVersion);return $.ajax({url:t,type:"GET",data:null,cache:!0,async:!0,dataType:"text",xhrFields:{withCredentials:!1},success:function(e,t,i){r.resolve(e)},error:function(e,t,i){console.log("failed to get file "+n,t,t),r.resolve(null)},complete:function(e,t){}}),e},fixEvent:function(e){return e||window.event},getRegionByElem:function(e){e=e.getAttribute("region-id");return window.regions[e]},getRegionByDom:function(e){e=e.getAttribute("region-id");return window.regions[e]},getRegionByEvent:function(e){e=RegionUtil.getEventTarget(e);return RegionUtil.getRegionByElem(e)},getEventTarget:function(e){return null==(e=RegionUtil.fixEvent(e)).target?e.srcElement:e.target},getRegionById:function(e){return window.regions[e]},getWindowRegionById:function(e,t){return e.regions[t]},createRegionFromPageContent:function(regionDivObj,pageContent,paraMap,regionId,pageUrl,regionLoadedPromise){for(var parentObject=null,curRegionId=regionDivObj.attr("region-id"),parentObject=null==curRegionId?window:RegionUtil.getRegionById(curRegionId),containerObj=regionDivObj,childDivs=(regionDivObj.children().remove(),regionLoadedPromise.done(function(e){}),regionDivObj.append("<div class='new'><div>")),variables=(regionDivObj=regionDivObj.children(".new"),regionDivObj.addClass("hidden"),isEmpty(regionId)&&(regionId=getUUID()),regionDivObj.attr("region-id",regionId),null==paraMap&&(paraMap=new HashMap),paraMap.put("region-id",regionId),null==pageUrl&&(pageUrl="static:"+regionId),pageUrl=RegionUtil.appendParaMapToUrl(pageUrl,paraMap),regionDivObj.addClass("region-holder"),regionDivObj.attr("region-url",pageUrl),regionDivObj.css("height","100%"),regionDivObj.addClass(regionId),pageContent=eval('pageContent.replace(/REGION/g,"region_"+regionId)'),pageContent=pageContent.replace(/regionreserve/g,"REGION"),RegionUtil.resolveStaticVariables(pageContent)),i=variables.length-1;-1<i;i--){var varIndex=variables[i].index,matchPartStr=variables[i][0],varKey=matchPartStr.substring(2,matchPartStr.length-2),staticVarVal=paraMap.get(varKey);null==staticVarVal&&(staticVarVal=""),pageContent=pageContent.substring(0,varIndex)+staticVarVal+pageContent.substring(varIndex+matchPartStr.length)}null==window.regionsContent&&(window.regionsContent={}),window.regionsContent[regionId]=pageContent,regionDivObj.html(pageContent),regionDivObj.removeClass("hidden"),null==parentObject.childRegionIds&&(parentObject.childRegionIds=[]),parentObject.childRegionIds.push(regionId)},loadRegionByConfig:function(e,t,i,n,r,a,o){t=DynamicFormTemplates.resolveRegionContent(t,r,a,o);return RegionUtil.loadRegionByContent(e,null,t,i,n)},loadListRegionByConfig:function(e,t,i,n,r,a,o){t=DynamicFormTemplates.resolveListRegionContent(t,r,a,o);return RegionUtil.loadRegionByContent(e,null,t,i,n)},getRegionCachedUrlByContent:function(e){var t,i;if(null!=e)return t=new SparkMD5,t.append(e),t=t.end(),i=t,i.startWith("/")||(i="/"+i),RegionUtil.setCache("page:"+i,e),t},loadRegionByContent:function(e,t,i,n,r){var a,o,l;if(null!=i)return a=null,null==t?((l=new SparkMD5).append(i),a=l.end(),(l=Config.frontendPath+a).startWith("/")||(l="/"+l),RegionUtil.setCache("page:"+l,i),t=RegionUtil.appendParaMapToUrl(a,n),RegionUtil.loadRegion(e,a,r)):((l=a=-1!=(o=(a=t).indexOf("?"))?a.substring(0,o):a).startWith("/")||(l="/"+l),RegionUtil.setCache("page:"+l,i),t=RegionUtil.appendParaMapToUrl(t,n),RegionUtil.loadRegion(e,t,r))},loadRegionWithoutChangeUrl:function(e,t,i){return RegionUtil.subLoadRegion(e,t,i,!1)},load:function(e,t,i){RegionUtil.loadRegion(e,t,i)},loadRepoRegion:function(e,t,i,n){return null!=n&&(t=RS.appendParaMapToUrl(t,n)),null==Config.rsRepo&&(Config.rsRepo="http://cdn.rcsdn.cn/rsrepo/"),RS.loadRegion(e,Config.rsRepo+t,i)},loadRegion:function(e,t,i,n){var r;{if(null!=e&&null!=e.length&&0!=e.length||alert("Region Holder is invalid for region "+t),null!=t&&""!=t)return(r=(t=(r=null)!=n?RS.appendParaMapToUrl(t,n):t).startWith("http:")||t.startWith("https:")?RegionUtil.subLoadRegion(e,t,i,!0):RegionUtil.subLoadRegion(e,t,i,!1)).done(function(e){null!=e&&RS.callOnLoadHock(e)}),r;alert("Region Url is invalid "+t)}},loadAbsRegion:function(e,t,i){return RegionUtil.subLoadRegion(e,t,i,!0)},subLoadRegion:function(t,i,n,g){if(null!=t&&0!=t.length){for(var e=t.children(),r=0;r<e.length;r++){var a=e[r].getAttribute("region-id");null!=a&&RegionUtil.getRegionById(a).release()}t.html("");var o=null,l=i.indexOf("?"),s=null,d=(-1!=l?(s=i.substring(0,l),o=new HashMap,RegionUtil.fillParamap(i,o)):s=i,null==n&&(n=RegionUtil.getUUID()),RegionUtil.createNewDef(DEF_DEFINITIONS.REG_DEF_RENDERED+n));return(g?RegionUtil.ajaxGetStaticPage(s):RegionUtil.ajaxGetStaticPage(Config.frontendPath+s)).done(function(e){0!=e&&(null==e?(console.error("组件资源不存在:"+s),RegionUtil.resolveDef(DEF_DEFINITIONS.REG_DEF_RENDERED+n,null)):(RegionUtil.createRegionFromPageContent(t,e,o,n,s,d),d.done(function(e){var t=i.indexOf("?");e.rcsFile=-1==t?i:i.substring(0,t),$(e.getRegionDivElem()).addClass("Region").addClass(e.type)})))}),d}},setSessionCache:function(e,t){sessionStorage.setItem(e,t)},getSessionCache:function(e){return sessionStorage.getItem(e)},decrypt:function(e,t){t=CryptoJS.enc.Utf8.parse(t),e=CryptoJS.AES.decrypt(e,t,{mode:CryptoJS.mode.ECB,padding:CryptoJS.pad.Pkcs7});return CryptoJS.enc.Utf8.stringify(e).toString()},createXMLHTTPRequest:function(){var e;if(window.XMLHttpRequest)(e=new XMLHttpRequest).overrideMimeType&&e.overrideMimeType("text/xml");else if(window.ActiveXObject)for(var t=["MSXML2.XMLHTTP","Microsoft.XMLHTTP"],i=0;i<t.length;i++)try{if(e=new ActiveXObject(t[i]))break}catch(e){}return e},addRegionUniqueId:function(e,t){if(null==e.getAttribute("region-id")&&e.setAttribute("region-id",t),null==e.getAttribute("region-url"))for(var i=e.childNodes,n=0;n<i.length;n++)null!=i[n].tagName&&RegionUtil.addRegionUniqueId(i[n],t)},insertBefore:function(e,t,i){if(!RegionUtil.isEmpty(i)){RegionUtil.getUUID();var n=$(i),r=n.length,a=(1<n.length&&(n=$("<div>"+i+"</div>")),RegionUtil.addRegionUniqueId(n[0],e.regionId),null),a=(1<r?$(n.prop("innerHTML")):$(n.prop("outerHTML"))).insertBefore($(t));if("function"==typeof e.resolveInnerTags)for(var o=0;o<a.length;o++)e.resolveInnerTags(a[o]);return n}},insertAfter:function(e,t,i){if(!RegionUtil.isEmpty(i)){RegionUtil.getUUID();var n=$(i),r=n.length,a=(1<r&&(n=$("<div>"+i+"</div>")),RegionUtil.addRegionUniqueId(n[0],e.regionId),null),a=(1<r?$(n.prop("innerHTML")):$(n.prop("outerHTML"))).insertAfter($(t));if("function"==typeof e.resolveInnerTags)for(var o=0;o<a.length;o++)e.resolveInnerTags(a[o]);return n}},appendHtml:function(e,t,i){if(!RegionUtil.isEmpty(i)){var n=RegionUtil.getUUID(),r=$(i),a=r.length;if(1<a&&(r=$("<div>"+i+"</div>")),RegionUtil.addRegionUniqueId(r[0],e.regionId),$(r.children()).addClass(n),1<a?$(t).append(r.prop("innerHTML")):$(t).append(r.prop("outerHTML")),"function"==typeof e.resolveInnerTags)for(var o=e.find("."+n),l=0;l<o.length;l++)e.resolveInnerTags(o[l])}},setInnerHtml:function(e,t,i){RegionUtil.isEmpty(i)?$(t).html(""):(t.innerHTML=i,RegionUtil.addRegionUniqueId(t,e.regionId),"function"==typeof e.resolveInnerTags&&e.resolveInnerTags(t))},diableRegion:function(e,t){RS.disableInput(RS.getRegionById(t),!0)},hashCode:function(e){var t=0;if(0==e.length)return t;for(i=0;i<e.length;i++)t=(t<<5)-t+(char=e.charCodeAt(i)),t&=t;return t},toggleTableDetail:function(e,g,t,u,i,n,r,a,c){var o=!1,l=$(t).closest("*[region-list]"),t=$(t).closest("*[index]"),s=t.attr("primary-val"),d=(null==r&&(r=0),RegionUtil.hashCode(g)),p=d+"_group"+s+"_"+e.regionId,h=(a&&(p="group"+s+"_"+e.regionId),d+"_"+s+"_"+e.regionId+"_"+r),a=d+"div"+s+"_"+e.regionId+"_"+r,d="."+h,e=(l.find("."+p).each(function(e,t){var i=$(this);i.hasClass(h)||i.addClass("hidden")}),l.find("#"+a));0!=e.length&&(l.find(d).hasClass("hidden")||(o=!0)),o?l.find(d).addClass("hidden"):(0==e.length&&(o=r="",e='<tr record-id="'+s+'" class="list-inner-comp '+p+" "+h+'">'+(r=null!=i&&0!=i?"<td colspan='"+i+"'> </td>":r)+"<td colspan='"+u+"'><div id=\""+a+'"/></div></td>'+(o=null!=n&&0!=n?"<td colspan='"+n+"'> </td>":o)+'</tr><tr record-id="'+s+"\"class='list-inner-comp' style='display:none'><td></td></tr>",$(e).insertAfter(t),RegionUtil.loadRegion(l.find("#"+a),g,c)),l.find(d).removeClass("hidden"))},toggleDivListDetail:function(e,g,t,u,i,n,r,c){var t=$(t),p=(t.hasClass("fa-plus")?t.removeClass("fa-plus").addClass("fa-minus"):t.hasClass("fa-minus")&&t.addClass("fa-plus").removeClass("fa-minus"),!1),a=t.closest("*[region-list]"),t=t.closest("*[index]"),o=t.attr("primary-val"),l=(null==n&&(n=0),RegionUtil.hashCode(g)),s=l+"_group"+o+"_"+e.regionId,d=(r&&(s="group"+o+"_"+e.regionId),l+"_"+o+"_"+e.regionId+"_"+n),r=l+"div"+o+"_"+e.regionId+"_"+n,l="."+d,e=(a.find("."+s).each(function(e,t){var i=$(this);i.hasClass(d)||i.addClass("hidden")}),a.find("#"+r));0!=e.length&&(a.find(l).hasClass("hidden")||(p=!0)),p?a.find(l).addClass("hidden"):(0==e.length&&(null==i&&(i="40px"),$('<div record-id="'+o+'" class="inner-row list-inner-comp '+s+" "+d+"\"><div style='"+("padding-left:"+i)+"' class='col-xs-"+u+'\'><div class="col-xs-12" id="'+r+'"/></div></div></div>').insertAfter(t),RegionUtil.loadRegion(a.find("#"+r),g,c)),a.find(l).removeClass("hidden"))},getAttriObjVal:function(e){if(null==e.attr("region-ds"))return e.val();var t=e.attr("region-attr");if("radio"==e.attr("type"))return null!=(n=e.closest(".ds-gen").find("input:radio[region-attr='"+t+"']:checked"))?n.val():null;if("checkbox"!=e.attr("type"))return"SELECT"==e.get(0).tagName&&e.attr("multiple")?(i=[],e.find("> option").each(function(e,t){i.push($(t).val())}),JSON.stringify(i)):(n="","string"==(r=typeof e.val())?n=e.val().trim():null==r||(n=JSON.stringify(e.val())),""!=n?n:null);for(var i,n,r,a=e.closest(".ds-gen").find("input:checkbox[region-attr='"+t+"']:checked"),o=[],l=0;l<a.length;l++)o.push(a[l].value);return JSON.stringify(o)},setCookie:function(e,t){var i=new Date;i.setTime(i.getTime()+864e5),document.cookie=e+"="+encodeURIComponent(t)+";expires="+i.toGMTString()+";path=/"},getCookie:function(e){var e=new RegExp("(^| )"+e+"=([^;]*)(;|$)");return(e=document.cookie.match(e))?decodeURIComponent(e[2]):null},delCookie:function(e){var t=new Date,i=(t.setTime(t.getTime()-1),RegionUtil.getCookie(e));null!=i&&(document.cookie=e+"="+i+";expires="+t.toGMTString()+";path=/")},setCookieWithExpire:function(e,t,i){var i=RegionUtil.getsec(i),n=new Date;n.setTime(n.getTime()+ +i),document.cookie=e+"="+encodeURIComponent(t)+";expires="+n.toGMTString()+";path=/"},getsec:function(e){var t=+e.substring(1,e.length),e=e.substring(0,1);return"s"==e?1e3*t:"m"==e?60*t*1e3:"h"==e?60*t*60*1e3:"d"==e?24*t*60*60*1e3:void 0},clone:function(e,t){if(null==e)return null;null==t&&(t=0);var i=null;if(e instanceof Array)for(var i=[],n=0;n<e.length;n++)i[n]=RegionUtil.clone(e[n],t+1);else if(e instanceof Object)if(t<5)for(var r in i={},e)i[r]=RegionUtil.clone(e[r],t+1);else i=e;else i=e;return i},mergeData:function(e,t,i){if(null!=e&&null!=t)for(var n in null==i&&(i=0),e){var r=e[n];if(r instanceof Array){null==t[n]&&(t[n]=[]);for(var a=0;a<r.length;a++)null==(l=t[n][a])&&(l={}),RS.mergeData(r[a],l,i+1),t[n][a]=l;0<(s=t[n].length-r.length)&&t[n].splice(r.length,s)}else if(r instanceof Object)if(i<5)for(var o in t[n]={},r)if(r[o]instanceof Array){null==t[n][o]&&(t[n][o]=[]);for(var l,s,a=0;a<r[o].length;a++)null==(l=t[n][o][a])&&(l={}),RS.mergeData(r[o][a],l,i+1),t[n][o][a]=l;0<(s=t[n][o].length-r[o].length)&&t[n][o].splice(r[o].length,s)}else t[n][o]=r[o];else t[n]=r;else t[n]=r}},getElementTopOffset:function(e){return e.parentElement?RegionUtil.getElementTopOffset(e.parentElement)+e.offsetTop:e.offsetTop},getAvaliableHeight:function(e){return $(document).height()-RegionUtil.getElementTopOffset(e)},pureCall:function(e,t,i,n){return RegionUtil.pureAjaxRequest(e,t,i,n)},pureAjaxRequest:function(e,t,i,n){1==Config.encrypt&&RegionUtil.encryptData(i);var r=new jQuery.Deferred;return $.ajax({url:e,type:t,data:i,cache:!1,async:!0,beforeSend:function(e){var t;"undefined"!=typeof AndroidClient&&AndroidClient.isFromWebview&&(null!=(t=AndroidClient.getToken())?RegionUtil.setCookie("_token",t):RegionUtil.delCookie("_token"))},success:function(e,t,i){if(i.getResponseHeader("encrypt")){try{e=RegionUtil.decryptStr(e)}catch(e){}try{e=JSON.parse(e)}catch(e){}}null!=n&&n(e),r.resolve(e)},error:function(e,t,i){r.resolve()}}),r.promise()},modalWindowHtml:"<div class='cover-bgdiv'>\t<div class='cover-window'>\t \t<div class='animation-holder'>\t\t\t<div class='cover-header col-xs-12'>\t\t\t\t<div class='pull-left cover-title' style='height:100%'></div>\t\t\t\t<div class='pull-right' style='height:100%'>\t\t\t\t\t<span class='fa-light fa-external-link detach' aria-hidden='true' onclick='RegionUtil.detachModalWindow()'></span>\t\t\t\t\t<span class='fa-light fa-window-maximize popresize' title='最大化'  aria-hidden='true' onclick='RegionUtil.toggleModalWindow()'></span>\t\t\t\t\t<span class='fa-light fa-remove popclose' title='关闭' aria-hidden='true' onclick='RegionUtil.closeModalWindow()'></span>\t\t\t\t</div>\t\t\t</div>\t\t\t<div class='modal-container-wrap col-xs-12'>\t\t\t\t<div class='modal-container auto-overflow scroll-bar2'>\t\t\t\t</div>\t\t\t</div>\t\t</div>\t</div></div>",drawerWindowHtml:"<div class='cover-bgdiv'>\t<div class='cover-window'>\t \t<div class='animation-holder'>\t\t\t<div class='cover-header col-xs-12 drawerHeader'>\t\t\t\t<div class='pull-left' style='height:100%'>\t\t\t\t\t<span class='fa-light fa-remove popclose' aria-hidden='true' title='关闭' onclick='RegionUtil.closeModalWindow()'></span>\t\t\t\t\t<span class='fa-light fa-external-link detach' aria-hidden='true' onclick='RegionUtil.detachModalWindow()'></span>\t\t\t\t\t<span class='fa-light fa-window-maximize popresize' aria-hidden='true' title='最大化' onclick='RegionUtil.toggleModalWindow()'></span>\t\t\t\t</div>\t\t\t\t<div class='pull-left cover-title' style='height:100%'></div>\t\t\t</div>\t\t\t<div class='modal-container-wrap col-xs-12 drawerBody'>\t\t\t\t<div class='modal-container auto-overflow scroll-bar2'>\t\t\t\t</div>\t\t\t</div>\t\t</div>\t</div></div>",floatMsgHtml:"<div class='floatmsg-container box-shadow'>\t\t\t<div class='header'>\t\t\t\t<div class='pull-left cover-title' style='height:100%'></div>\t\t\t\t<div class='pull-right' style='height:100%'>\t\t\t\t\t<span class='fa-light fa-remove popclose' title='关闭' aria-hidden='true' onclick='RS.closeFloatWindow(this)'></span>\t\t\t\t\t<span class='fa-light fa-window-maximize popresize' title='最大化'  aria-hidden='true' onclick='RS.toggleFloatWindow(this)'></span>\t\t\t\t</div>\t\t\t</div>\t\t\t<div class='scroll-bar2 float-body'>\t\t\t</div></div>",openFloatWindow:function(e,t,i,n,r){null==window.floatWindow&&(window.floatWindow={});var a=RS.UUID(),o={},l=(o.id=a,floatWindow[a]=o,$(RS.floatMsgHtml)),s=((o.dom=l).attr("float-id",a),null==i&&(i="20rem"),null==r&&(r="300"),l.css("width",t=null==t?"100%":t),l.css("height",i),l.attr("ow",t),l.attr("oh",i),l.css("z-index",r),document.body.appendChild(l[0]),1==n&&RS.enableDrag(l[0]),new jQuery.Deferred);return RS.loadRegion(l.find(".float-body"),e,a).done(function(e){o.close=function(){"function"==typeof this.onClose&&this.onClose();var e=this.dom,t=e.attr("float-id");delete window.floatWindow[t],RS.getRegionById(t).release(),e.remove()},s.resolve(o)}),s.promise()},closeFloatWindow:function(e){e=$(e).closest(".floatmsg-container").attr("float-id");window.floatWindow[e].close()},toggleFloatWindow:function(e){var e=$(e).closest(".floatmsg-container"),t=e.attr("max"),i=e.children(".header").find(".popresize");"true"==t?(e.attr("max",""),i.addClass("fa-window-maximize"),i.removeClass("fa-window-restore"),e.css("width",e.attr("ow")),e.css("height",e.attr("oh"))):(e.attr("max","true"),i.removeClass("fa-window-maximize"),i.addClass("fa-window-restore"),e.css("width","100%"),e.css("height","100%")),e.css("right","0"),e.css("bottom","0"),e.css("inset","")},openModalWindowByContent:function(e,t,i,n){var r=new SparkMD5,r=(r.append(e),r.end()),a=r;return a.startWith("/")||(a="/"+a),RegionUtil.setCache("page:"+a,e),openModalWindow(RegionUtil.appendParaMapToUrl(r,i),t,n)},openModalWindow:function(e,g,t,i,n,u,c,r,a,o){var l={},s=(null==window.modalIndex?(window.modalIndex=0,window.modalWindowObjects={},window.modalPromiseObjects={},$(window).resize(function(){var e=window.modalWindowObjects[window.modalIndex];null!=e&&RegionUtil.calPositionWithRatio(e.find(".cover-window"),e.widthRatio,e.heightRatio)})):window.modalIndex++,window.modalWindowObjects[window.modalIndex]),d=(null!=s&&delete window.modalWindowObjects[window.modalIndex],document.createElement("div")),r=(d.className="hidden cover-container container"+window.modalIndex,1==o?$(d).html(RegionUtil.drawerWindowHtml):$(d).html(RegionUtil.modalWindowHtml),document.body.appendChild(d),s=$(d),1==o&&s.find(".cover-window").attr("isdrawer","true"),s.find(".animation-holder").attr("index",window.modalIndex),window.modalWindowObjects[window.modalIndex]=s,1==o&&(s.find(".cover-window").click(function(e){null!=window.regionDetailHolder&&RS.regionClickFunction(e),e.stopPropagation()}),s.find(".cover-bgdiv").mousedown(function(e){$(RS.getEventTarget(e)).hasClass("cover-bgdiv")&&(s.mouseDownTime=(new Date).getTime())}),s.find(".cover-bgdiv").mouseup(function(e){$(RS.getEventTarget(e)).hasClass("cover-bgdiv")&&(new Date).getTime()-s.mouseDownTime<200&&RS.closeModalWindow()})),s.find(".animation-holder").bind("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){var e;this.getAttribute("index")!=window.modalIndex||(e=window.modalWindowObjects[window.modalIndex]).closed&&(e.addClass("hidden"),window.modalPromiseObjects[window.modalIndex].resolve(),window.modalPromiseObjects[window.modalIndex]=null,window.modalIndex--,-1!=window.modalIndex?(e=window.modalWindowObjects[window.modalIndex],RegionUtil.calPositionWithRatio(e.find(".cover-window"),e.widthRatio,e.heightRatio)):RegionUtil.enableScrollAfterPopupClosed())}),1==a?(s.find(".cover-header").addClass("hidden"),s.find(".animation-holder").addClass("paddingtop0")):(s.find(".cover-header").removeClass("hidden"),s.find(".animation-holder").removeClass("paddingtop0"),RegionUtil.isPc()?(s.find(".cover-header").dblclick(function(){RegionUtil.toggleModalWindow()}),1==r?s.find(".detach").addClass("hidden"):s.find(".detach").removeClass("hidden"),1!=o&&RegionUtil.enableDrag(s.find(".cover-header")[0],s.find(".cover-window")[0])):(s.find(".cover-header").find(".detach").addClass("hidden"),s.find(".cover-header").find(".popresize").addClass("hidden"))),s.closed=!1,null!=t&&(s.animationNo=t,null!=(a=(d=s.find(".animation-holder")).attr("animation-no"))&&d.removeClass("moveout-animation"+a+"-class"),d.addClass("movein-animation"+t+"-class"),d.attr("animation-no",t)),s.removeClass("hidden"),RegionUtil.disableScrollAfterPopupOpened(),new jQuery.Deferred),o=r.promise(),a=(window.modalPromiseObjects[window.modalIndex]=r,s.widthRatio=null!=i?i:null==u?.7:u/$(window).width(),s.heightRatio=null!=n?n:null==c?.7:c/$(window).height(),s.find(".cover-title").text(g),RegionUtil.calPositionWithRatio(s.find(".cover-window"),s.widthRatio,s.heightRatio),s.pageUrl=e,s.find(".modal-container").html(""),RegionUtil.loadRegion(s.find(".modal-container"),e,"modalcontainer"+window.modalIndex));return l.open=a,l.close=o,l},calPositionWithRatio:function(e,t,i){var t=$(window).width()*(t=(t=1<t?1:t)<0?.9:t),i=$(window).height()*(i=(i=1<i?1:i)<0?.9:i),n=e.attr("isdrawer");RegionUtil.calPositionWithFixedSize(e,t,i,n="true"==n?!0:n)},calPositionWithFixedSize:function(e,t,i,n){var r=$(window).width(),t=t=r<t?r:t,r=(r-t)/2,a=($(window).height()-i)/2,a=a<0?0:a;1==n?(e.css("right",0),e.attr("max"),e.css("top",0)):(e.css("left",r),e.css("top",a)),e.css("height",i),e.css("width",t)},toggleModalWindow:function(){var e=window.modalWindowObjects[window.modalIndex],t=e.find(".popresize");null==e.oriWidthRatio?(e.oriWidthRatio=e.widthRatio,e.oriHeightRatio=e.heightRatio,e.widthRatio=1,e.heightRatio=1,t.removeClass("fa-window-maximize"),t.addClass("fa-window-restore"),e.find(".cover-window").attr("max","true")):(e.widthRatio=e.oriWidthRatio,e.heightRatio=e.oriHeightRatio,e.oriWidthRatio=null,t.removeClass("fa-window-restore"),t.addClass("fa-window-maximize"),e.find(".cover-window").attr("max","false")),RegionUtil.calPositionWithRatio(e.find(".cover-window"),e.widthRatio,e.heightRatio)},detachModalWindow:function(){var i=window.modalWindowObjects[window.modalIndex];window.modalPromiseObjects[window.modalIndex].done(function(){var e=i.pageUrl,t=SaasUtil.getSystemCode();null!=t?window.open("sys/"+t+"/v.html?"+e):window.open("core/v.html?"+e)}),RegionUtil.closeModalWindow()},closeModalWindow:function(e){e?RegionUtil.subCloseModalWindow():setTimeout(function(){RegionUtil.subCloseModalWindow()})},subCloseModalWindow:function(){var e,t;null==window.modalIndex||null!=(e=window.modalWindowObjects[window.modalIndex])&&(e.closed=!0,null!=e.animationNo?((t=e.find(".animation-holder")).addClass("moveout-animation"+e.animationNo+"-class"),t.removeClass("movein-animation"+e.animationNo+"-class")):(window.modalPromiseObjects[window.modalIndex].resolve(),window.modalPromiseObjects[window.modalIndex]=null,window.modalIndex--,window.modalIndex<0&&RegionUtil.enableScrollAfterPopupClosed()),t=e.find(".popresize"),e.oriWidthRatio=null,t.removeClass("fa-window-restore"),t.addClass("fa-window-maximize"),null!=(t=RegionUtil.getRegionById("modalcontainer"+window.modalIndex))&&t.release(),e.find(".modal-container").html(""))},disableScrollAfterPopupOpened:function(){$(document).bind("mousewheel",function(e,t){e=$(RegionUtil.getEventTarget(e));if(e.hasClass("cover-bgdiv"))return!1;e=e.closest(".modal-container");return 0!=e.length&&(!!RegionUtil.hasOrChildHasScrollBar(e[0])&&void 0)})},enableScrollAfterPopupClosed:function(){$(document).unbind("mousewheel")},hasOrChildHasScrollBar:function(e){var t=RegionUtil.hasScrollBar(e);if(t)return!0;for(var i=$(e).children(),n=0;n<i.length;n++)if(t=RegionUtil.hasOrChildHasScrollBar(i[n]))return!0;return t},hasScrollBar:function(e){return e.scrollHeight>e.clientHeight||e.offsetHeight>e.clientHeight},fixUrl:function(e){var t=e.substring(e.lastIndexOf("/")+1,e.length);return e.substring(0,e.lastIndexOf("/")+1)+encodeURIComponent(t)},calculateMD5:function(i){var n=new FileReader,r=File.prototype.mozSlice||File.prototype.webkitSlice||File.prototype.slice,a=2097152,t=Math.ceil(i.size/a),o=0,l=new SparkMD5,s=new jQuery.Deferred;function d(){var e=o*a,t=e+a>=i.size?i.size:e+a;n.readAsBinaryString(r.call(i,e,t))}return n.onload=function(e){l.appendBinary(e.target.result),++o<t?d():s.resolve(l.end())},d(),s.promise()},convertToTreeData:function(e){var t=new HashMap,i={id:"0",depth:0,label:"root node",childs:new Array,expand:!0};if(t.put(i.id,i),null==e)return i;for(var n=0;n<e.length;n++)e[n].childs=null,t.put(e[n].id,e[n]);for(n=0;n<e.length;n++){var r=t.get(e[n].parentNodeId);null!=r&&(null==r.childs&&(r.childs=[]),r.childs.push(e[n]),e[n].parent=r)}return function e(t,i){if(null!=t.childs)for(var n=0;n<t.childs.length;n++)t.childs[n].depth=i,e(t.childs[n],i+1)}(i,1),function e(t){var i=t.childs;if(null==i||0==i.length)return;for(var n=0;n<i.length-1;n++){for(var r,a=n+1;a<i.length;a++)i[a].seqNo>i[n].seqNo&&(r=i[n],i[n]=i[a],i[a]=r);e(i[n])}}(i),[i,t]},clearAllMsg:function(){setTimeout(function(){for(var e in window.regionMsgRegistry)RS.clearMsg(window.regionMsgRegistry[e].id)},100)},clearMsg:function(e){var t=RS.getRegionById(e);null!=t&&(delete window.regionMsgRegistry[e],$(t.getRegionDivContainer().parentNode).remove(),t.release())},showMsgAuto:function(a,e,t,o,i,l){1!=l&&(l=!1);e=RS.showMsg(a,e,t,0,0,"movein-animation5-class",!0,i);return e.done(function(r){setTimeout(function(){var e=$(window.regionMsgRegistry[r.regionId].holder),t=parseFloat(e.css("left").replace("px",""))+1e5,i=$(window).width(),n=e.css("width"),i=i-parseFloat(n.replace("px",""))-30,n=(i<t&&(t=i),0);l?(n=parseFloat(e.css("top").replace("px",""))-$(r.getRegionDivElem()).outerHeight()-o)<0?(n=parseFloat(e.css("top").replace("px",""))+$(a).outerHeight()+o)+$(r.getRegionDivElem()).outerHeight()>document.body.clientHeight&&(n=2,e.removeClass("movein-animation5-class"),e.addClass("movein-animation6-class")):(e.removeClass("movein-animation5-class"),e.addClass("movein-animation6-class")):(n=parseFloat(e.css("top").replace("px",""))+$(a).outerHeight()+o)+$(r.getRegionDivElem()).outerHeight()>document.body.clientHeight&&((n=parseFloat(e.css("top").replace("px",""))-$(r.getRegionDivElem()).outerHeight()-o)<0&&(n=2),e.removeClass("movein-animation5-class"),e.addClass("movein-animation6-class")),e.css("top",n+"px"),e.css("left",t+"px")})}),e},showMsg:function(e,t,i,n,r,a,g,o){null==window.regionMsgRegistry&&(window.regionMsgRegistry={}),console.warn("use showMsgAuto instead of this"),null==i&&(i="floatmsg"+RS.getUUID());var l=document.createElement("div"),i=(document.body.appendChild(l),(msgBoxObj={}).id=i,msgBoxObj.target=e,msgBoxObj.holder=l,msgBoxObj.offseTop=n,msgBoxObj.offsetLeft=r,regionMsgRegistry[msgBoxObj.id]=msgBoxObj,d(e));function s(e){var t=d(e.target);$(e.holder).css("left",t.x+e.offsetLeft),$(e.holder).css("top",t.y+e.offseTop)}function d(e){var t=e.getBoundingClientRect();return{x:t.left,y:t.top,w:$(e).outerWidth(!0),h:$(e).outerHeight(!0)}}return $(l).addClass(msgBoxObj.id).addClass("floatmsg").css("position","fixed").css("left",i.x+r).css("top",i.y+n).css("z-index",600),null!=o&&$(l).css("width",o),1==g&&$(l).css("left",$(l).css("left").replace("px","")-1e5),null!=a&&$(l).addClass(a),$(window).resize(function(){for(var e in window.regionMsgRegistry)s(window.regionMsgRegistry[e])}),$(window).scroll(function(){for(var e in window.regionMsgRegistry)s(window.regionMsgRegistry[e])}),RS.loadRegion($(l),t,msgBoxObj.id)},addDialog:function(e,a,o,l,s){RS.getRegionByElem(e[0]);e.focus(function(){var t=$(this),i=t.attr("dialog");if(null==i){i=RS.getUUID(),t.attr("dialog",i);function e(){RS.showMsgAuto(t[0],RS.appendParaMapToUrl(a,o),n,2).done(function(e){$(e.getRegionDivElem()).mouseover(function(){RS.removeCloseDialogTask(i)}),$(e.getRegionDivElem()).click(function(){RS.removeCloseDialogTask(i)}),$(e.getRegionDivElem()).mouseout(function(){RS.tryCloseDialog(t)}),"function"==typeof s&&s(e,t)})}var n="msg_"+i;if("function"==typeof l){var r=l(t,o);if(null!=r)return void r.done(function(){e()})}e()}}),e.blur(function(){RS.tryCloseDialog($(this))}),e.bind("mousewheel",function(){RS.tryCloseDialog($(this),0)}),e.mouseout(function(){RS.tryCloseDialog($(this),500)})},tryCloseDialog:function(e,t){var i=e.attr("dialog");null!=i&&(0==(t=null==t?200:t)?(e.attr("dialog",null),RS.clearMsg("msg_"+i),e.blur()):RS.addCloseDialogTask(e,i,function(){this.attr("dialog",null),RS.clearMsg("msg_"+i),this.blur()},t))},addCloseDialogTask:function(e,t,i,n){null==window.closeFloatTask&&(window.closeFloatTask={}),window.closeFloatTask["task_"+t]=setTimeout(i.bind(e),n)},removeCloseDialogTask:function(e){null==window.closeFloatTask&&(window.closeFloatTask={}),null!=window.closeFloatTask["task_"+e]&&(clearTimeout(window.closeFloatTask["task_"+e]),window.closeFloatTask["task_"+e]=null)},getDomPosition:function(e){for(var t,i,n=e,r=(e.offsetWidth,e.offsetHeight,!0),a=e.offsetTop,o=e.offsetLeft;e=e.offsetParent;)a+=e.offsetTop,o+=e.offsetLeft,r&&(r=!1,i=(t=window.getComputedStyle(e)).getPropertyValue("padding-top"),t=t.getPropertyValue("padding-left"),a=(a-=i=parseFloat(i.replace("px","")))-(t=parseFloat(t.replace("px",""))));return{x:o,y:a,w:$(n).outerWidth(!0),h:$(n).outerHeight(!0)}},resolveCodeMark:function(e){e.find("code").each(function(){RegionUtil.resolveSingleCode(e,$(this))})},resolveSingleCode:function(i,e){var t=e.attr("width"),n=e.attr("height"),r=e.attr("name"),a=e.attr("minimized"),o=e.attr("showheader"),l=(null==r&&(r="code"),null==t&&(t="100%"),a="true"==a,$('<div class="hidden codepre"><div class="code-desc"><i class="fa fa-minus toggleBtn" aria-hidden="true"></i><h4 class=\'codeName\'></h4><div class="code-control"><span><message key="global_msg.copy"></message></span></div></div><div class="codeblock"></div></div>')),s=(l.insertAfter(e),RegionUtil.addRegionUniqueId(l[0],i.regionId),l.find(".toggleBtn").click(function(){$(this).hasClass("fa-minus")?($(this).removeClass("fa-minus").addClass("fa-plus"),l.find(".codeblock").addClass("hidden")):($(this).addClass("fa-minus").removeClass("fa-plus"),l.find(".codeblock").removeClass("hidden"))}),a&&(l.find(".codeblock").addClass("hidden"),l.find(".toggleBtn").removeClass("fa-minus").addClass("fa-plus")),e.html()),a=(s="true"==e.attr("escapeHtml")?s.replace(/[<>&"]/g,function(e){return{"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;"}[e]}):s).replace(/\n/g,"</li><li>");9<(a=a.trim()).length&&(a="<ul>"+(a=(a=(a=a.startWith("</li>")?a.substring(5):a).startWith("<li>")?a:"<li>"+a).endWith("<li>")?a.substring(0,a.length-4):a)+"</ul>"),l.find("h4").html(r),"false"==o&&l.find(".code-desc").addClass("hidden"),l.find("message").each(function(e){var t=this.getAttribute("key"),t=RegionUtil.getMessage(i,t);$(this).replaceWith("<label class='index_"+e+" "+this.className+"'>"+t+"</label>")}),l.css("width",t),null!=n&&l.find(".codeblock").css("height",n),l.find(".codeblock").html(a),l.find(".index_0").click(function(){RegionUtil.copy(s),RegionUtil.alert(global_msg.copy_success)}),e.remove(),l.removeClass("hidden")},createTouchValidation:function(c,p,h){RegionUtil.setInnerHtml(p,c[0],'<div class="dragBg"></div><div class="dragText"></div><div class="dragHandler dragHandlerBg"></div>'),setTimeout(function(){var t,i,n=RegionUtil.isPc(),r=n?(t="mousedown",i="mousemove","mouseup"):(t="touchstart",i="touchmove","touchend"),a=c.find(".dragBg"),o=c.find(".dragText"),l=c.find(".dragHandler"),s=c[0].clientWidth-l[0].clientWidth;function u(){document.addEventListener(i,d),document.addEventListener(r,g)}function d(){var e=n?event.clientX-l[0].clientWidth/2:event.targetTouches[0].pageX-l[0].clientWidth/2;e<0?e=0:s<e&&(e=s,o[0].textContent="验证通过",o[0].style.color="white",l[0].setAttribute("class","dragHandlerOkBg"),l[0].removeEventListener(t,u),document.removeEventListener(i,d),document.removeEventListener(r,g),"function"==typeof h&&h(c,p)),l[0].style.left=e+"px",a[0].style.width=l[0].style.left}function g(){document.removeEventListener(i,d),document.removeEventListener(r,g),l[0].style.left=0,a[0].style.width=0}o[0].textContent="拖动滑块验证",l[0].addEventListener(t,u)})},enbalePullRefresh:function(g,u,c){var e=g.attr("region-id"),p=RegionUtil.getRegionById(e);RegionUtil.insertBefore(p,g[0],'<div class="pull-refresh-wrapper">\t\t\t<div class="refresh-prompt hidden" style="z-index: 9999;">下拉刷新</div>\t   </div>');g.insertAfter(p.find(".refresh-prompt")),setTimeout(function(){var i,e,n,r,a,o,l;function s(){var e,t=i?event.clientY:event.targetTouches[0].pageY;if(null!=c&&"function"==typeof c&&0==c(g[0]))return;0==g[0].scrollTop&&(p.isPulling?(p.currentPullingPostion=t,e=p.currentPullingPostion-p.startPullingPosition,a<e&&((o<e?p.find(".refresh-prompt").text("释放刷新"):p.find(".refresh-prompt").text("下拉刷新")).removeClass("hidden"),l<e&&(e=l),p.find(".refresh-prompt").css("height",e).css("line-height",e+"px"),g.css("top",e))):(p.isPulling=!0,p.startPullingPosition=t))}function d(){var e,t;document.removeEventListener(n,s),document.removeEventListener(r,d),p.isPulling&&((t=p.currentPullingPostion-p.startPullingPosition)<0&&(t=0),p.isPulling=!1,p.currentPullingPostion=0,p.startPullingPosition=0,e=p.find(".refresh-prompt"),o<t?(e.html('<i class="fa fa-spinner fa-pulse fa-2x fa-fw"></i>'),RegionUtil.disableInput(p,!0),"function"==typeof u&&(null==(t=u(p))?(console.error("Promise must be returned back"),RegionUtil.alert("Promise must be returned back","Function Error")):t.done(function(){e.css("height",a+"px"),e.css("line-height",a+"px"),e.addClass("hidden"),e.text("下拉刷新"),g.animate({top:"0px"},function(){RegionUtil.disableInput(p,!1)})}))):(RegionUtil.disableInput(p,!0),e.css("height",a+"px"),e.css("line-height",a+"px"),e.addClass("hidden"),e.text("下拉刷新"),g.animate({top:"0px"},function(){RegionUtil.disableInput(p,!1)})))}null!=p.find(".refresh-prompt")&&0!=p.find(".refresh-prompt").length&&(p.isPulling=!1,i=RegionUtil.isPc(),r=i?(e="mousedown",n="mousemove","mouseup"):(e="touchstart",n="touchmove","touchend"),g[0].addEventListener(e,function(){document.addEventListener(n,s),document.addEventListener(r,d)}),a=15,o=50,l=100,p.find(".refresh-prompt").css(a+"px"),p.find(".refresh-prompt").css("line-height",a+"px"))})},resolveParaVal:function(paraData,regionAttr){if(null==regionAttr)return null;var script="tmpParaVal = paraData.";script+=regionAttr;try{eval(script)}catch(e){tmpParaVal=null}return tmpParaVal},constructObject:function(e,t){for(var i=t.split("."),n={},r=null,a=(1==i.length&&(n[t]=e,r=t),n),r=i[0],o=0;o<i.length;o++)o==i.length-1?a[i[o]]=e:(null==a[i[o]]&&(a[i[o]]={}),a=a[i[o]]);return[r,n]},packParaVal:function(e,t){var i=t.split(".");if(1==i.length)return[e,t];for(var n=e,r=0;r<i.length;r++)t=(r==i.length-1||(null==n[i[r]]&&(n[i[r]]={}),n=n[i[r]]),i[r]);return[n,t]},eval:function(e){return new Function("return "+e)()},replacePage:function(e){null==window.screenRegion?window.location.replace(e):window.screenRegion.clearBackState().done(function(){window.location.replace(e)})},showMobileSelect:function(){},enableScale:function(e,t){null==t&&(t=e);var i,n,u,c,r=$(t),p=$(e),h=p.width(),f=p.height(),a=h,o=f,m=h/f,l=(r.dblclick(function(){p.css("height",o),p.css("width",a),h=o,f=a}),i="touchmove",n="touchend",function(){var e,t,i,n;null==u&&(u={},c={}),null!=event.targetTouches[0]&&(t=(e=event.targetTouches[0]).pageX,i=e.pageY,n="id_"+e.identifier,null==u[n]?(u[n]={},c[n]={},u[n].first=!0,u[n].left=t,u[n].top=i):(c[n].left=t,c[n].top=i)),null!=event.targetTouches[1]&&(t=(e=event.targetTouches[1]).pageX,i=e.pageY,n="id_"+e.identifier,null==u[n]?(u[n]={},c[n]={},u[n].left=t,u[n].top=i):(c[n].left=t,c[n].top=i)),s()}),s=function(){var e,t,i,n,r,a,o,l=null,s=null,d=null,g=null;for(x in u)null==l?(l=u[x],s=c[x]):(d=u[x],g=c[x]);null!=l&&null!=d&&(e=l.left-d.left,t=(i=(i=s.left-g.left)<0?-i:i)-(e=e<0?-e:e),(e=l.top-d.top)<0&&(e=-e),e=t+(i=(i=(i=s.top-g.top)<0?-i:i)-e),t=Math.abs(t),i=Math.abs(i),o=n=0,o=.8*Math.sqrt(Math.pow(t,2)+Math.pow(i,2)),i<t&&(n=1),0<e?0==n?(r=f+o,p.css("height",r),p.css("width",m*r)):(a=h+o,p.css("width",a),p.css("height",a/m)):0==n?(r=f-o,p.css("height",r),p.css("width",m*r)):(a=h-o,p.css("width",a),p.css("height",a/m)))},d=function(){s(),h=p.width(),f=p.height(),t.removeEventListener(i,l),t.removeEventListener(n,d),c=u=null};t.addEventListener("touchstart",function(){t.addEventListener(i,l),t.addEventListener(n,d),u=null})},connectWebsocket:function(e,t){null==t&&(t=window.location.port),window.WebSocket||(window.WebSocket=window.MozWebSocket),window.WebSocket||alert("WebSocket is not support for your browser"),null==window.websocketsReg&&(window.websocketsReg={});var i=null,i="https:"==location.protocol?""==t?"wss://"+document.domain+"/websocket/"+e:"wss://"+document.domain+":"+t+"/websocket/"+e:"ws://"+document.domain+":"+t+"/websocket/"+e,n=new jQuery.Deferred;if(null!=(r=window.websocketsReg[i])&&r.readyState==WebSocket.OPEN)return n.resolve(r),n.promise();var n=null,n=null!=r?(clearInterval(r.heartBeat),r.serverMsgInterceptor):{},r=new window.WebSocket(i),n=((window.websocketsReg[i]=r).serverMsgInterceptor=n,r.extData={},r.extData.rcsName=e,r.extData.portNum=t,r.extData.connectStr=i,r.callws=function(e,t){var i=this,n={};return n.requestId=getUUID2(),null==i.requestDefs&&(i.requestDefs={}),i.requestDefs[n.requestId]=new jQuery.Deferred,n.url=e,n.body=JSON.stringify(t),i.send(JSON.stringify(n)),i.requestDefs[n.requestId].promise()},r.heartBeat=setInterval(RegionUtil.sendHeartbeat.bind(r),1e4),r.openDef=new jQuery.Deferred,r.openDef.promise());return RegionUtil.addWebsocketInterceptor(r),n},sendHeartbeat:function(){this.send(0)},reconnectWebsocket:function(e){var t=e.extData.rcsName,i=e.extData.portNum,n=e.extData.connectStr,a=window.webSockestTopicReg[e.extData.connectStr];console.log("重新连接中:"+n),RegionUtil.connectWebsocket(t,i).done(function(e){for(xTopic in console.log("topicReg",a),a){var t=xTopic,i=a[t];for(xTag in i){var n=xTag,r=(i[n],{});r.topic=t,r.tag=n,e.callws("/region-websocket-topic/add-topic-listener",r)}}})},addWebsocketInterceptor:function(c){c.onopen=function(e){e=e.currentTarget;e.openDef.resolve(e),console.log("websocket连接成功: "+e.url)},c.onclose=function(e){var t=e.currentTarget;null!=t.extData&&(console.log("websocket连接断开: "+t.url),window.websocketsReg[t.connectStr]=null,clearInterval(t.heartBeat),console.log("Websocket连接断开，3秒后自动连接"),setTimeout(function(){RegionUtil.reconnectWebsocket(t)},3e3))},c.getTopicListener=function(e,t,i){if(null!=t){var n=t+"$$"+(i=null==i?"*":i),r=(null==e.topicListenersReg&&(e.topicListenersReg={}),e.topicListenersReg[n]);if(null!=r)return r;null==window.webSockestTopicReg&&(window.webSockestTopicReg={});var r=window.webSockestTopicReg[this.extData.connectStr],a=(null==r&&(r={},window.webSockestTopicReg[this.extData.connectStr]=r),r[t]),r=(null==a&&(r[t]=a={}),a[i]),a=(null==r&&(a[i]=r=[]),{}),r=(a.id=getUUID2(),r.push(a),{});return r.topic=t,r.tag=i,this.callws("/region-websocket-topic/add-topic-listener",r),a.topic=t,a.tag=i,a.websocket=this,a.listenerKeyInRegion=n,a.topicTarget=e,a.release=function(){var e={};e.topic=this.topic,e.tag=this.tag,this.websocket.callws("/region-websocket-topic/remove-topic-listener",e);for(var t=window.webSockestTopicReg[this.websocket.extData.connectStr][this.topic][this.tag],i=0;i<t.length;i++)if(t[i].id==this.id){t.splice(i,1);break}delete this.topicTarget.topicListenersReg[this.listenerKeyInRegion]},e.topicListenersReg[n]=a}alert("topic is empty")},c.onmessage=function(e){var t=e.currentTarget;if("NEED_TO_LOGIN"!=e.data){var i=JSON.parse(e.data);try{var n=i.topic,r=i.tag;if(null!=n){var g=window.webSockestTopicReg[t.extData.connectStr];if(null==g)return;var a=g[n];if(null==a)return;var o=null;if(null==r||"*"==r)for(x in o=[],a)o=o.concat(a[x]);else{var o=a[r],l=a["*"];null==o?o=l:null!=l&&(o=[].concat(l))}if(null!=o)for(var s=0;s<o.length;s++)"function"==typeof o[s].onmessage&&o[s].onmessage(i.body,i.tag);return}if(null!=window.websocketsInterceptorReg){var u=t.url,d=(null!=i.url&&(u+=i.url),window.websocketsInterceptorReg[u]);if(null!=d)for(s=0;s<d.length;s++)"function"==typeof d[s].onmessage&&d[s].onmessage(i.body,c)}}catch(e){console.log(e)}null!=t.requestDefs&&(null!=(e=t.requestDefs[i.requestId])&&e.resolve(i.body),delete t.requestDefs[i.requestId])}else RS.alert("会话已失效，请重新登录").done(function(){LoginPlugin.preLogin()})}},addMsgInterceptor:function(e,t,i){null==window.websocketsInterceptorReg&&(window.websocketsInterceptorReg={});t=("https:"==location.protocol?"wss://"+document.domain+":"+t+"/websocket/"+e:"ws://"+document.domain+":"+t+"/websocket/"+e)+i,e={},e.id=getUUID2(),e.listenerKey=t,i=window.websocketsInterceptorReg[t];return null==i&&(i=[],window.websocketsInterceptorReg[t]=i),i.push(e),e},removeMsgInterceptor:function(e){if(null!=window.websocketsInterceptorReg){var t=e.listenerKey,i=window.websocketsInterceptorReg[t];if(null!=i)for(var n=0;n<i.length;n++)if(i[n].id==e.id){i.splice(n,1);break}}},SHA256:function(e){function v(e,t){var i=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(i>>16)<<16|65535&i}function R(e,t){return e>>>t|e<<32-t}for(var t=function(g,u){var e,t,i,c,n,r,a,p,h,o,f,l,m=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],s=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],d=new Array(64);for(g[u>>5]|=128<<24-u%32,g[15+(u+64>>9<<4)]=u,h=0;h<g.length;h+=16){for(e=s[0],t=s[1],i=s[2],c=s[3],n=s[4],r=s[5],a=s[6],p=s[7],o=0;o<64;o++)d[o]=o<16?g[o+h]:v(v(v(R(l=d[o-2],17)^R(l,19)^l>>>10,d[o-7]),R(l=d[o-15],7)^R(l,18)^l>>>3),d[o-16]),l=v(v(v(v(p,R(n,6)^R(n,11)^R(n,25)),n&r^~n&a),m[o]),d[o]),f=v(R(e,2)^R(e,13)^R(e,22),e&t^e&i^t&i),p=a,a=r,r=n,n=v(c,l),c=i,i=t,t=e,e=v(l,f);s[0]=v(e,s[0]),s[1]=v(t,s[1]),s[2]=v(i,s[2]),s[3]=v(c,s[3]),s[4]=v(n,s[4]),s[5]=v(r,s[5]),s[6]=v(a,s[6]),s[7]=v(p,s[7])}return s}(function(e){for(var t=[],i=0;i<8*e.length;i+=8)t[i>>5]|=(255&e.charCodeAt(i/8))<<24-i%32;return t}(e=function(e){e=e.replace(/\r\n/g,"\n");for(var t="",i=0;i<e.length;i++){var n=e.charCodeAt(i);n<128?t+=String.fromCharCode(n):t=127<n&&n<2048?(t+=String.fromCharCode(n>>6|192))+String.fromCharCode(63&n|128):(t=(t+=String.fromCharCode(n>>12|224))+String.fromCharCode(n>>6&63|128))+String.fromCharCode(63&n|128)}return t}(e)),8*e.length),i="0123456789abcdef",n="",r=0;r<4*t.length;r++)n+=i.charAt(t[r>>2]>>8*(3-r%4)+4&15)+i.charAt(t[r>>2]>>8*(3-r%4)&15);return n}},RS=RegionUtil;function isEmpty(e){return null==e||""===e.trim()}var RegionCache={set:function(e,t,i){try{var n={ttl:216e5,createTime:(new Date).valueOf(),value:t};"number"==typeof i&&0<i&&(n.ttl=1e3*i),sessionStorage.setItem(e,JSON.stringify(n))}catch(e){RegionCache.clear()}},get:function(e){try{var t=JSON.parse(sessionStorage.getItem(e));return t?t.ttl&&t.ttl+t.createTime<(new Date).valueOf()?(sessionStorage.removeItem(e),null):t.value:null}catch(e){return RegionCache.clear(),null}},remove:function(e){sessionStorage.removeItem(e)},clear:function(){for(var e in sessionStorage)e.startWith("page:")&&sessionStorage.removeItem(e)}};function collapseToggle(e){RegionUtil.findInHtmlObj(e[0],".collapsePanel").click(function(){var e=$(this).closest(".panel-heading"),t=e.siblings(".panel-body");$(this).toggleClass("fa-minus fa-plus"),t.toggleClass("collapse"),e.find("span.panel-heading-sub-hide").toggleClass("hidden")})}function refreshMessage(jqueryObj){for(var regionId=jqueryObj.attr("region-id"),msgEles=jqueryObj.find("message"),i=0;i<msgEles.length;i++){var elem=$(msgEles[i]),keyVal,text;elem.attr("region-id")==regionId&&(keyVal=elem.attr("key"),text=eval(keyVal),elem.replaceWith(text))}}function clone(e){return RegionUtil.clone(e)}function getUUID(){var e=setTimeout("0");return clearTimeout(e),e+""}function getUUID2(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})}function sampleValidation(e,t,i,n){var r=!1,a=e.getDomObjByBindAttribute(t);return a.value=a.value.trim(),(r=111!=a.value?!0:r)?e.addFieldError(t,i,n):e.removeFieldError(i),!r}function openModalWindow(e,t,i){return"l"==i?RegionUtil.openModalWindow(e,t,2,.9,.9,null,null,!1):null==i||"m"==i?RegionUtil.openModalWindow(e,t,2,.8,.8,null,null,!1):"s"==i?RegionUtil.openModalWindow(e,t,2,.7,.7,null,null,!1):RegionUtil.openModalWindow(e,t,2,null,null,i.w,i.h,!1)}function openModalWindowWithoutHeader(e,t,i){return"l"==i?RegionUtil.openModalWindow(e,t,2,.9,.9,null,null,!1,!0):null==i||"m"==i?RegionUtil.openModalWindow(e,t,2,.7,.7,null,null,!1,!0):"s"==i?RegionUtil.openModalWindow(e,t,2,.5,.5,null,null,!1,!0):RegionUtil.openModalWindow(e,t,2,null,null,i.w,i.h,!1)}function openDrawerWindow(e,t,i,n,r){null==i?i=$(window).width()-17.4*parseInt(document.documentElement.style.fontSize.replace("px","")):"s"==i?i="50rem":"m"==i?i="70rem":"l"==i&&(i="109rem");var a,o=i+"",o=(o.endWith("px")?i=o.substring(0,o.indexOf("px")):o.endWith("rem")?(i=o.substring(0,o.indexOf("rem")),i=parseInt(i),a=(a=document.documentElement.style.fontSize).substring(0,a.length-2),i=parseInt(a)*i):o.endWith("%")&&(a=parseInt(o.substring(0,o.indexOf("%"))),i=$(window).width()*a/100),i=parseInt(i),$(window).height());return RegionUtil.openModalWindow(e,t,4,null,null,i,o,r=null==r?!1:r,n=null==n?!1:n,!0)}function closeModalWindow(){RegionUtil.closeModalWindow()}function cleanFormAllError(){for(var e=this.validationErrors.values(),t=0;t<e.length;t++)e[t].cleanErrorMsg()}function containAttr(e){for(var t in this)if(t==e)return!0;return!1}function getMsg(keyVal){var text=eval(keyVal);return text}function loadScript(e,t){var i=document.createElement("script");i.type="text/javascript",i.readyState?i.onreadystatechange=function(){RegionUtil.alert(i.readyState),"loaded"!=i.readyState&&"complete"!=i.readyState||(i.onreadystatechange=null,t())}:i.onload=function(){t()},i.src=e,document.getElementsByTagName("head")[0].appendChild(i)}function zip(e){e=pako.gzip(e,{to:"string"});return btoa(e)}function unzip(e){e=atob(e).split("").map(function(e){return e.charCodeAt(0)}),e=new Uint8Array(e);return Utf8ArrayToStr(pako.ungzip(e))}function Utf8ArrayToStr(e){for(var t,i,n,r="",a=0,o=e.length;a<o;)(t=e[a++])>>4<=7?r+=String.fromCharCode(t):t>>4==12||t>>4==13?(i=e[a++],r+=String.fromCharCode((31&t)<<6|63&i)):t>>4==14&&(i=e[a++],n=e[a++],r+=String.fromCharCode((15&t)<<12|(63&i)<<6|(63&n)<<0));return r}function RegionForm(regionDivSelector,paraRegionId,grid,readOnly,useRowRenderCallBack,resources){this.useRowRenderCallBack=useRowRenderCallBack,this.readOnly=readOnly,RegionUtil.cleanRegions(),this.isInGrid=!1,null!=grid&&(this.isInGrid=!0,this.parent=grid,grid.child=this),this.type="RegionForm",this.resources=resources,this.paraMap=RegionUtil.getUrlParaMap();var tmpArray=document.querySelectorAll(regionDivSelector),regionDivSelectorObj=(null==tmpArray||0==tmpArray.length?RegionUtil.alert("No region form found "):1<tmpArray.length&&RegionUtil.alert("Duplicate region form found : duplicate region"),tmpArray[0]),loadId,tmpDef,time=(this.isInGrid||$(regionDivSelectorObj).prepend('<div class="loadingIcon  text-center" style="position:absolute;z-index:1;float:right;width:100%;top:45%"><i class="fa fa-spinner fa-pulse fa-2x fa-fw"></i></div>'),this.mainUrl=RegionUtil.wrapRegionParas(regionDivSelectorObj,this.paraMap),null!=grid?paraRegionId=grid.regionId:isEmpty(paraRegionId)?isEmpty(this.paraMap.get("region-id"))?isEmpty(paraRegionId)&&(paraRegionId=getUUID()):paraRegionId=this.paraMap.get("region-id"):(paraRegionId=paraRegionId.trim(),loadId=this.paraMap.get("region-id"),isEmpty(loadId)||(tmpDef=window.regionDef[DEF_DEFINITIONS.REG_DEF_RENDERED+loadId],null!=tmpDef&&(window.regionDef[DEF_DEFINITIONS.REG_DEF_RENDERED+paraRegionId]=tmpDef,window.regionDef[DEF_DEFINITIONS.REG_DEF_RENDERED+loadId]=null))),null==window.regions&&(window.regions={}),1!=this.isInGrid&&(window.regions[paraRegionId]=this),this.regionId=paraRegionId,this.regionDivId="region_"+this.regionId,regionDivSelectorObj.setAttribute("id",this.regionDivId),$(regionDivSelectorObj).css("height","100%"),$(regionDivSelectorObj).css("width","100%"),this.validators={},this.validationErrors=new HashMap,this.validationErrorCount=0,this.renderCount=0,this.regionUIData={},this.regionData={},this.regionDataBakup=null,this.refreshCells=[],this.addRegionId(regionDivSelectorObj),1!=this.isInGrid&&collapseToggle($(this.getRegionDivElem())),(new Date).getTime()),regionAttrArray=this.find($("*[region-attr]")),tmpObj=null,tmpAttrName=null,curRegion=this,bindData={};curRegion.isInGrid?curRegion.parent.$=bindData:curRegion.$=bindData;for(var i=0,tmpLength=regionAttrArray.length;i<tmpLength;i++){var methodName,methodName,tmpObj=regionAttrArray[i],tmpAttrName=tmpObj.getAttribute("region-attr");curRegion.isInGrid?$(tmpObj).hasClass("region-searchable")&&(methodName=tmpAttrName.replaceAll("\\.","_").firstCapitalize(),eval("this.parent.set"+methodName+'= function(value){this.child.setRegionUIAttr("'+tmpAttrName+'",value)};this.parent.get'+methodName+'= function(){return this.child.getRegionUIAttr("'+tmpAttrName+'")};'),bindData[tmpAttrName]=null):(methodName=tmpAttrName.replaceAll("\\.","_").firstCapitalize(),eval("this.set"+methodName+'= function(value){this.setRegionUIAttr("'+tmpAttrName+'",value)};this.get'+methodName+'= function(){return this.getRegionUIAttr("'+tmpAttrName+'")};'),bindData[tmpAttrName]=null)}this.proxyData(this,bindData)}function FieldError(e,t,i,n,r){this.regionAttribute=e,this.errorDivId=t,this.errorMsg=i,this.region=n,this.labelTxt=r}String.prototype.trim=function(){return this.replace(/(^\s*)|(\s*$)/g,"")},String.prototype.ltrim=function(){return this.replace(/(^\s*)/g,"")},String.prototype.rtrim=function(){return this.replace(/(\s*$)/g,"")},String.prototype.startWith=function(e){return!(null==e||""==e||0==this.length||e.length>this.length)&&this.substr(0,e.length)==e},String.prototype.endWith=function(e){return!(null==e||""==e||0==this.length||e.length>this.length)&&this.substring(this.length-e.length)==e},String.prototype.firstCapitalize=function(){return this.substring(0,1).toUpperCase()+this.substring(1)},String.prototype.firstSmall=function(){return this.substring(0,1).toLowerCase()+this.substring(1)},String.prototype.replaceAll=function(e,t){return this.replace(new RegExp(e,"gm"),t)},function(o,t){var i,n=o([]),r=o.resize=o.extend(o.resize,{}),l="setTimeout",a="resize",s=a+"-special-event",d="throttleWindow";r.delay=150,r[d]=!0,o.event.special[a]={setup:function(){if(!r[d]&&this[l])return!1;var e=o(this);n=n.add(e),o.data(this,s,{w:e.width(),h:e.height()}),1===n.length&&function e(){i=t[l](function(){n.each(function(){var e=o(this),t=e.width(),i=e.height(),n=o.data(this,s);t===n.w&&i===n.h||e.trigger(a,[n.w=t,n.h=i])}),e()},r.delay)}()},teardown:function(){if(!r[d]&&this[l])return!1;var e=o(this);n=n.not(e),e.removeData(s),n.length||clearTimeout(i)},add:function(e){if(!r[d]&&this[l])return!1;var a;function t(e,t,i){var n=o(this),r=o.data(this,s);r.w=void 0!==t?t:n.width(),r.h=void 0!==i?i:n.height(),a.apply(this,arguments)}if(o.isFunction(e))return a=e,t;a=e.handler,e.handler=t}}}(jQuery,this),window.getRegionById=function(e){return window.regions[e]},RegionForm.prototype.proxyData=function(e,t){},RegionForm.prototype.saveOrUpdate=function(){return this.saveOrUpdateRegion()},RegionForm.prototype.saveOrUpdateRegion=function(){if((Config.REGION_DEBUG_MODE&&console.log(this.regionId+":beforeValidate"),"function"==typeof this.beforeValidate)&&0==this.beforeValidate())return void(Config.REGION_DEBUG_MODE&&console.log(this.regionId+":beforeValidate false in region:"+this.regionId));var e=this.validate(!0);if(Config.REGION_DEBUG_MODE&&console.log(this.regionId+":afterValidate"),"function"==typeof this.afterValidate&&this.afterValidate(),e)return e=RegionUtil.createNewDef(DEF_DEFINITIONS.REG_DEF_RENDERED+this.regionId),this.editSCallback(),e.promise()},RegionForm.prototype.editSCallback=function(){var e=this.packFormData();this.postTableData(e)},RegionForm.prototype.getData=function(){return this.packFormData()},RegionForm.prototype.setData=function(e){this.renderRegionWithData(e)},RegionForm.prototype.refresh=function(){this.setData(this.regionData)},RegionForm.prototype.refreshUIData=function(){return this.isInGrid?(this.regionUIData=this.packUIData(),null==this.regionUIData&&(this.regionUIData={list:null})):this.readOnly&&null!=this.regionDataBakup&&null!=this.regionDataBakup.list?this.regionUIData=this.regionDataBakup:this.regionUIData=this.packUIData(),this.regionUIData},RegionForm.prototype.subEditSCallback=function(e){var t,i;Config.REGION_DEBUG_MODE&&console.log(this.regionId+":afterRetrieveData"),"function"==typeof this.afterRetrieveData&&this.afterRetrieveData(e),null!=e.msg&&0==e.success&&this.isPopup(),0!=e.success?(this.regionData=e.data,this.renderData(),"function"==typeof this.saveSuccessCallBack&&this.saveSuccessCallBack(e)):(i=null)!=(i="function"==typeof(t=this).beforeRenderData?this.beforeRenderData():i)?i.done(function(){t.renderDataComplete(),"function"==typeof t.saveFailedCallBack&&t.saveFailedCallBack(e)}):(t.renderDataComplete(),"function"==typeof t.saveFailedCallBack&&t.saveFailedCallBack(e))},RegionForm.prototype.editCCallback=function(){this.renderData()},RegionForm.prototype.addValidator=function(e,t,i){var n=this.validators[e];null==n&&(this.validators[e]=n={}),n.ruleArray=t,n.msgArray=i},RegionForm.prototype.removeValidator=function(e){delete this.validators[e]},RegionForm.prototype.removeValidators=function(){this.validators={}},RegionForm.prototype.validateItem=function(e){var t=this.validators[e];this.checkText(e,t.ruleArray,t.msgArray,this.getRegionUIAttr(e))},RegionForm.prototype.validate=function(e){for(var t=this.validationErrors.keySet(),i=0;i<t.length;i++){var n=t[i];this.validationErrors.remove(n).cleanErrorMsg(this)}if(1==this.disableValidaiton)return!0;var r=null,r=this.isInGrid?this.packFormData("region-searchable"):this.packFormData();for(objAttr in this.validators){var a=this.validators[objAttr];this.checkText(objAttr,a.ruleArray,a.msgArray,RegionUtil.resolveParaVal(r,objAttr))}if(this.validationErrorCount=this.validationErrors.size(),null!=this.childRegionIds)for(i=0;i<this.childRegionIds.length;i++){var o=RegionUtil.getRegionById(this.childRegionIds[i]);null!=o&&"RegionForm"==o.type&&(o.validate(),this.validationErrorCount+=o.validationErrorCount)}return 1==e&&0<this.validationErrorCount&&RegionUtil.toast(this.validationErrorCount+global_msg.items_to_complete),0==this.validationErrorCount},RegionForm.prototype.isPopup=function(e){return"1"==this.paraMap.get("popUp")},RegionForm.prototype.postTableData=function(e){var t=this,i=(Config.REGION_DEBUG_MODE&&console.log(this.regionId+":beforePostData"),null);"function"==typeof this.beforePostData?i=this.beforePostData(e):"function"==typeof this.beforeSaveData&&(i=this.beforeSaveData(e)),this.showLoading(),null!=i?i.done(function(){t.resUrl=null==t.paraMap.get("resUrl")?t.resUrl:t.paraMap.get("resUrl"),null!=t.resUrl?RegionUtil.ajaxRequestJson(t,t.resUrl+"save/","POST",e,t.subEditSCallback,!0,null):null==t.saveUrl?console.log("error:saveUrl is not defined"):RegionUtil.ajaxRequestJson(t,t.saveUrl,"POST",e,t.subEditSCallback,!0,null)}):(t.resUrl=null==t.paraMap.get("resUrl")?t.resUrl:t.paraMap.get("resUrl"),null!=t.resUrl?RegionUtil.ajaxRequestJson(t,t.resUrl+"save/","POST",e,t.subEditSCallback,!0,null):null==t.saveUrl?console.log("error:saveUrl is not defined"):RegionUtil.ajaxRequestJson(t,t.saveUrl,"POST",e,t.subEditSCallback,!0,null))},RegionForm.prototype.packFormData=function(e){var t={};return this.packNode($(this.getRegionDivElem()),this.regionId,t,e),this.regionUIData=t},RegionForm.prototype.packUIData=function(){var e={};return this.packNode($(this.getRegionDivElem()),this.regionId,e,null),e},RegionForm.prototype.packNode=function(e,t,i,n){var r=e.attr("region-id");if(null==r){if(null!=e.attr("region-url"))return}else if(r!=t)return;r=e.attr("region-list");if(null==r){var a=e.attr("region-attr");if(null!=n){if(null!=a&&e.hasClass(n)&&""!=a){if(e.hasClass("inner"))return;this.packAttribute(e,i,a)}for(var o=e.children(),l=0;l<o.length;l++)this.packNode($(o[l]),t,i,n)}else{if(null!=a&&""!=a){if(e.hasClass("inner"))return;this.packAttribute(e,i,a)}for(o=e.children(),l=0;l<o.length;l++)this.packNode($(o[l]),t,i,null)}}else if(null==n){for(var s=e.children(),g=[],l=0;l<s.length;l++){d={};this.packNode($(s[l]),t,d,null),g.push(d)}i[r]=g}else if(e.hasClass(n)){for(var s=e.children(),g=[],l=0;l<s.length;l++){var d={};this.packNode($(s[l]),t,d,n),g.push(d)}i[r]=g}},RegionForm.prototype.packAttribute=function(e,t,i){var n,r,a=e.get(0).tagName,o=e.attr("type"),l=RegionUtil.packParaVal(t,i);if(e.hasClass("inner-region"))l[0][l[1]]=RegionTagPlugin.packData(e);else if("INPUT"==a&&(e.hasClass("img")||e.hasClass("file")||e.hasClass("video"))){var t=e.val();if(l[0][l[1]]=[],null!=t&&""!=t)for(var s=t.split(","),d=0;d<s.length;d++){var g={};g.id=s[d],l[0][l[1]].push(g)}}else if("SPAN"!=a&&"TD"!=a&&"DIV"!=a)if("VIEW"!=a){if("radio"==o)return t=e.closest(".ds-gen").find("input:radio[region-attr='"+i+"']:checked"),void(l[0][l[1]]=null!=t?t.val():null);"checkbox"!=o?"TD"!=a?"SELECT"==a&&e.attr("multiple")?null!=e.attr("multiple")?(n=[],e.find("> option").each(function(e,t){n.push($(t).val())}),l[0][l[1]]=JSON.stringify(n)):l[0][l[1]]=e.val():"INPUT"==a&&e.parent().hasClass("editable-table-wrapper")?l[0][l[1]]=EditableTablePlugin.packData(e):"INPUT"!=a||"text"!=o&&"hidden"!=o?(r="","string"==(i=typeof e.val())?r=e.val().trim():null==i||(r=e.val()),l[0][l[1]]=""!=r?r:null):(r=(r=null==(r=e.val())?"":r).trim(),l[0][l[1]]=""===r?null:r):l[0][l[1]]=e.text():e.prop("checked")&&((t=(t=null)==(a=l[0][l[1]])||""===a.trim()?[]:JSON.parse(a)).push(e.val()),l[0][l[1]]=JSON.stringify(t))}else l[0][l[1]]=e.attr("real-val");else null==e.attr("region-ds")?"false"==e.attr("escapeHtml")?l[0][l[1]]=e.html():l[0][l[1]]=e.text():l[0][l[1]]=e.attr("real-val")},RegionForm.prototype.getDomObjByBindAttribute=function(e){return this.find("[region-attr='"+e+"']")[0]},RegionForm.prototype.cleanFields=function(){for(var e=this.find("[region-attr]"),t=0;t<e.length;t++){var i=$(e[t]);"hidden"!=i.attr("type")&&i.val("")}},RegionForm.prototype.checkText=function(e,t,i,n){if(null==t||0==t.length)return!0;var r=this.getDomObjByBindAttribute(e);if(null!=r){null==n&&(n="");for(var a=$(r).parent().prev().find("."+e+"label").text(),o=(null!=a&&""!==a||(a=e),"region_"+this.regionId+"."+e+"_validation_error"),l=0;l<t.length;l++){if("function"==typeof t[l]){var s,d=t[l](r,this);if(null==d||!0===d)continue;return s=null,s=0==d?i[l]:d,null==(d=this.validationErrors.get(o))?(d=new FieldError(e,o,s,this,a),this.validationErrors.put(o,d)):d.errorMsg=s,d.showErrorMsg(this),!1}if(0==t[l].test(n))return null==(s=this.validationErrors.get(o))?(s=new FieldError(e,o,i[l],this,a),this.validationErrors.put(o,s)):s.errorMsg=i[l],s.showErrorMsg(this),!1}return this.validationErrors.containsKey(o)&&(this.validationErrors.get(o).cleanErrorMsg(this),this.validationErrors.remove(o)),!0}console.log("validation error: attribute "+e+" not found")},RegionForm.prototype.addFieldError=function(e,t,i){e=new FieldError(e,t,i,this);this.validationErrors.put(t,e)},RegionForm.prototype.removeFieldError=function(e){this.validationErrors.containsKey(e)&&(this.validationErrors.get(e).cleanErrorMsg(this),this.validationErrors.remove(e))},RegionForm.prototype.render=function(){this.renderRegion()},RegionForm.prototype.renderRegion=function(){null==this.dataIdPara&&(this.dataIdPara="recordId"),this.id=this.paraMap.get("id"),null==this.id&&(this.id=this.paraMap.get(this.dataIdPara));var e=this.paraMap.get("callGet"),t=this.paraMap.get("useGet"),i=this.paraMap.get("autoGet");if(Config.REGION_DEBUG_MODE&&console.log(this.regionId+":beforeRetrieveData"),"function"==typeof this.beforeRetrieveData&&this.beforeRetrieveData(),null==this.resUrl&&null==this.getUrl||this.isInGrid||null==i&&null==e&&null==t&&(null==this.id||""===this.id))this.renderData();else{for(var n={},r=(this.paraMap.remove("callGet"),this.paraMap.remove("useGet"),this.paraMap.remove("autoGet"),this.paraMap.keySet()),a=0;a<r.length;a++)r[a]!=this.dataIdPara&&(n[r[a]]=this.paraMap.get(r[a]));null!=this.dataIdAttribute?n[this.dataIdAttribute]=this.id:n.id=this.id,this.showLoading(),this.resUrl=null==this.paraMap.get("resUrl")?this.resUrl:this.paraMap.get("resUrl"),null!=this.resUrl?RegionUtil.ajaxRequestJson(this,this.resUrl+"get/","POST",n,this.retrieveDataCallBack,!0,null):null==this.getUrl?console.log("error:getUrl is not defined"):RegionUtil.ajaxRequestJson(this,this.getUrl,"POST",n,this.retrieveDataCallBack,!0,null)}},RegionForm.prototype.refreshRegion=function(){var e=RegionUtil.createNewDef(DEF_DEFINITIONS.REG_DEF_RENDERED+this.regionId);return this.renderRegion(),e.promise()},RegionForm.prototype.renderWithData=function(e){this.renderRegionWithData(e)},RegionForm.prototype.renderRegionWithData=function(e){var t=this,i=(this.regionDataBakup=this.regionData,this.regionData=e,new jQuery.Deferred);return setTimeout(function(){t.renderData(),i.resolve()}),i.promise()},RegionForm.prototype.updateUI=function(){this.renderRegionWithData(this.regionData)},RegionForm.prototype.setRegionData=function(e){this.renderRegionWithData(e)},RegionForm.prototype.retrieveDataCallBack=function(e){0==e.success&&null!=e.msg&&console.log(e.msg);var t=this,i=null;e.success?(this.regionData=e.data,Config.REGION_DEBUG_MODE&&console.log(this.regionId+":afterRetrieveData"),null!=(i="function"==typeof this.afterRetrieveData?this.afterRetrieveData():i)?i.done(function(){t.renderData()}):t.renderData()):(Config.REGION_DEBUG_MODE&&console.log(this.regionId+":afterRetrieveData"),this.renderDataComplete(),"function"==typeof this.afterRetrieveData&&this.afterRetrieveData())},RegionForm.prototype.renderNode=function(targetNode,regionId,paraData,selectDomArray,listTmpDataPara,regionListNamePara,listIndexPara,rowElem){var curRegion=this,tmpRegionId=targetNode.getAttribute("region-id");if(null==tmpRegionId){if(null!=targetNode.getAttribute("region-url"))return}else if(tmpRegionId!=regionId)return;if("MESSAGE"!=targetNode.tagName)if(null==targetNode.getAttribute("msgKey")){var regionListName=null;if(null==regionListNamePara&&(regionListName=targetNode.getAttribute("region-list")),null==regionListName){var regionAttr=targetNode.getAttribute("region-attr"),listNodeChangedState=(targetNode.setAttribute("region-id",regionId),-1),regionDs=targetNode.getAttribute("region-ds"),selectVal,selectVal,tmp,listIndex,tmp,listIndex,val,gird,val,parentRow,primaryField,tmpData,tagName;if(null!=regionDs?(selectVal=null,null==listTmpDataPara?(selectVal=RegionUtil.resolveParaVal(paraData,regionAttr),tmp=$(targetNode),tmp.selectValue=selectVal):(listIndex=listIndexPara,null!=regionAttr&&(selectVal=RegionUtil.resolveParaVal(listTmpDataPara[listIndex],regionAttr)),tmp=$(targetNode),tmp.selectValue=selectVal,tmp.listIndex=listIndex),selectDomArray.push(tmp)):null!=regionAttr?null==listTmpDataPara?this.renderAttribute(targetNode,regionId,RegionUtil.resolveParaVal(paraData,regionAttr),regionAttr,null,null):(listIndex=listIndexPara,val=null,val="index"==regionAttr?this.isInGrid?(gird=this.parent,null==gird.regionData.pageSize?listIndex+1:gird.regionData.pageSize*(gird.regionData.currentPageNo-1)+listIndex+1):listIndex+1:RegionUtil.resolveParaVal(listTmpDataPara[listIndex],regionAttr),parentRow=rowElem,primaryField=parentRow.getAttribute("region-ls-primary"),null==primaryField&&(primaryField="id"),tmpData=listTmpDataPara[listIndex][primaryField],null==tmpData&&(listTmpDataPara[listIndex][primaryField]=RegionUtil.getUUID(),tmpData=listTmpDataPara[listIndex][primaryField]),parentRow.getAttribute("primary-val")!=tmpData&&$(parentRow).attr("primary-val",tmpData),listNodeChangedState=this.renderAttribute(targetNode,regionId,val,regionAttr,regionListNamePara,listIndex)):null==listTmpDataPara&&(tagName=targetNode.tagName,RegionUtil.resolveTag(this,targetNode,tagName,null)),1==listNodeChangedState||-1==listNodeChangedState)for(var childs=targetNode.childNodes,i=0,tmpLength=childs.length;i<tmpLength;i++)null!=childs[i]&&null!=childs[i].tagName&&this.renderNode(childs[i],regionId,paraData,selectDomArray,listTmpDataPara,regionListNamePara,listIndexPara,rowElem);var regionShow=targetNode.getAttribute("region-show"),rowData,paraMap,regionData,scriptVal,jqObj,regionHide,rowData,paraMap,regionData,scriptVal,jqObj,regionRemove,rowData,paraMap,regionData,scriptVal,jqObj;null!=regionShow&&""!=regionShow?(rowData=RegionUtil.getRowData(targetNode),paraMap=this.paraMap,regionData=this.regionData,this.isInGrid&&(regionData=this.parent.regionData,paraMap=this.parent.paraMap),null!=regionData&&(scriptVal=function(arg,rowData,paraMap,regionData){var scriptVal=!1;return eval("scriptVal=("+arg+")"),scriptVal}(regionShow,rowData,paraMap,regionData),jqObj=$(targetNode),scriptVal?jqObj.removeClass("hidden"):jqObj.addClass("hidden"))):(regionHide=targetNode.getAttribute("region-hide"),null!=regionHide&&""!=regionHide?(rowData=RegionUtil.getRowData(targetNode),paraMap=this.paraMap,regionData=this.regionData,this.isInGrid&&(regionData=this.parent.regionData,paraMap=this.parent.paraMap),null!=regionData&&(scriptVal=function(arg,rowData,paraMap,regionData){var scriptVal=!1;return eval("scriptVal=("+arg+")"),scriptVal}(regionHide,rowData,paraMap,regionData),jqObj=$(targetNode),scriptVal?jqObj.addClass("hidden"):jqObj.removeClass("hidden"))):(regionRemove=targetNode.getAttribute("region-remove"),null!=regionRemove&&""!=regionRemove&&(rowData=RegionUtil.getRowData(targetNode),paraMap=this.paraMap,regionData=this.regionData,this.isInGrid&&(regionData=this.parent.regionData,paraMap=this.parent.paraMap),null!=regionData&&(scriptVal=function(arg,rowData,paraMap,regionData){var scriptVal=!1;return eval("scriptVal=("+arg+")"),scriptVal}(regionRemove,rowData,paraMap,regionData),jqObj=$(targetNode),scriptVal&&jqObj.remove()))))}else{var checkedMap=null,rowsArray=$(targetNode).children("*[index]");if(null!=rowsArray&&0<rowsArray.length)for(var i=0,tmpLength=rowsArray.length;i<tmpLength;i++){var tmpRowObj=rowsArray[i];if(tmpRowObj.getAttribute("region-id")==regionId){var tmpPrmaryVal=tmpRowObj.getAttribute("primary-val");if(null==tmpPrmaryVal)break;var tmpCheckBox=tmpRowObj.querySelector(".multipleCbs");null!=tmpCheckBox&&null==tmpCheckBox.getAttribute("region-attr")&&null!=tmpPrmaryVal&&(null==checkedMap&&(checkedMap={}),checkedMap[tmpPrmaryVal]=tmpCheckBox.checked)}}var innerCompMap=null,listInnerArray=$(targetNode).children(".list-inner-comp");if(null!=listInnerArray&&0<listInnerArray.length)for(var innerCompMap=new HashMap,i=0,tmpLength=listInnerArray.length;i<tmpLength;i++){var tmpObj=$(listInnerArray[i]),tmpRecordId=tmpObj.attr("record-id"),innerCompArray=innerCompMap.get(tmpRecordId);null==innerCompArray&&(innerCompArray=[],innerCompMap.put(tmpRecordId,innerCompArray)),innerCompArray.push(tmpObj),targetNode.removeChild(listInnerArray[i])}var listTmpData=this.regionData[regionListName],oldListTmpData=this.regionUIData[regionListName],template=null,diff=0,tmpClassName=(null==listTmpData&&(listTmpData=[]),null==oldListTmpData&&(oldListTmpData=[]),targetNode.className);if(null==tmpClassName||""===tmpClassName?targetNode.className="region-list":-1==tmpClassName.indexOf("region-list")&&(targetNode.className+=" region-list"),"true"!=targetNode.getAttribute("region-dsrendered")){var childs=targetNode.childNodes;if(0==childs.length)return;template=targetNode.innerHTML;var templateObj=$(template),targetRegion=this;templateObj.find("message").each(function(e){var t=this.getAttribute("key"),t=RegionUtil.getMessage(targetRegion,t);$(this).replaceWith("<label class='messagelabel "+this.className+"'>"+t+"</label>")}),template=templateObj.prop("outerHTML"),targetNode.innerHTML=this.renderListTag(regionId,listTmpData,template),targetNode.setAttribute("template",template),targetNode.setAttribute("region-dsrendered","true"),diff=listTmpData.length}else{if(template=targetNode.getAttribute("template"),FORM_CONSTANTS.buf=[],null==listTmpData&&(listTmpData=[]),null==oldListTmpData&&(oldListTmpData=[]),diff=oldListTmpData.length-listTmpData.length,0<diff)if(diff==oldListTmpData.length)$(targetNode).html("");else for(var childrenTmp=$(targetNode).children(),i=0;i<diff;i++)childrenTmp.eq(oldListTmpData.length-1-i).remove();else if(diff<0){var offset=-diff,tmpTmplate=$(template);tmpTmplate.removeClass("hidden");for(var i=0;i<offset;i++)tmpTmplate.attr("index",oldListTmpData.length+i),FORM_CONSTANTS.buf.push($(tmpTmplate).prop("outerHTML"))}$(targetNode).append(FORM_CONSTANTS.buf.join("")),FORM_CONSTANTS.buf=null}for(var childs=$(targetNode).children(),template=targetNode.getAttribute("template"),i=0,tmpLength=childs.length,tmpTmplate;i<tmpLength;i++){$(childs).hasClass("inner-region")&&(diff++,tmpTmplate=$(template),tmpTmplate.removeClass("hidden"),tmpTmplate.attr("index",oldListTmpData.length+i),$(childs).replaceWith($(tmpTmplate).prop("outerHTML")))}childs=0!=diff?$(targetNode).children():rowsArray;for(var j=0,i=0,tmpLength=childs.length;i<tmpLength;i++)null!=childs[i].tagName&&childs[i].getAttribute("region-id")==this.regionId&&this.renderRowNode(childs[i],regionId,paraData,selectDomArray,listTmpData,regionListName,j++,childs[i]);if((null!=innerCompMap||null!=checkedMap)&&null!=rowsArray&&0<rowsArray.length){RegionUtil.disableReady=!0;for(var tmpRowObj=null,tmpCheckBox=null,tmpValPri=null,innerCompArray=null,i=0,rowsArrLength=rowsArray.length,tmpPrmaryVal,savedVal;i<rowsArrLength;i++){if(tmpRowObj=rowsArray[i],tmpCheckBox=tmpRowObj.querySelector(".multipleCbs"),null!=tmpCheckBox&&null==tmpCheckBox.getAttribute("region-attr")&&(tmpPrmaryVal=tmpRowObj.getAttribute("primary-val"),savedVal=checkedMap[tmpPrmaryVal],tmpCheckBox.checked=null!=savedVal&&savedVal),tmpValPri=$(tmpRowObj).attr("primary-val"),null!=innerCompMap&&null!=tmpValPri&&""!=(tmpValPri+"").trim()&&(innerCompArray=innerCompMap.get(tmpValPri),null!=innerCompArray))for(var j=0,tmpLength=innerCompArray.length;j<tmpLength;j++)innerCompArray[innerCompArray.length-1-j].insertAfter(tmpRowObj)}RegionUtil.disableReady=!1}}}else{var keyVal=targetNode.getAttribute("msgKey"),text=null;try{text=this.getLocaleMsg(keyVal)}catch(e){console.log(e),text=keyVal}$(targetNode).html(text)}else{var keyVal=$(targetNode).attr("key"),text=null;try{text=this.getLocaleMsg(keyVal)}catch(e){console.log("error: message key "+keyVal+" does not exist"),text=keyVal}var labelTagClass=keyVal.substring(keyVal.lastIndexOf(".")+1);$(targetNode).replaceWith("<label class='messagelabel "+targetNode.className+"' key='"+keyVal+"' region-id='"+tmpRegionId+"' class='messagelabel "+labelTagClass+"label'>"+text+"</label>")}},RegionForm.prototype.renderRowNode=function(targetNode,regionId,paraData,selectDomArray,listTmpDataPara,regionListNamePara,listIndexPara,rowElem){var regionAttr=targetNode.getAttribute("region-attr"),listIndex,parentRow,primaryField,tmpData,listNodeChangedState=(RS.enablePrompt(targetNode),RS.enableCopy(targetNode),null!=listTmpDataPara&&(listIndex=listIndexPara,parentRow=rowElem,primaryField=parentRow.getAttribute("region-ls-primary"),null==primaryField&&(primaryField="id"),tmpData=listTmpDataPara[listIndex][primaryField],null==tmpData&&(listTmpDataPara[listIndex][primaryField]=RegionUtil.getUUID(),tmpData=listTmpDataPara[listIndex][primaryField]),parentRow.getAttribute("primary-val")!=tmpData&&$(parentRow).attr("primary-val",tmpData)),-1),regionDs=targetNode.getAttribute("region-ds"),listIndex,val,gird,val;if(null!=regionDs){var selectVal=null,selectVal,tmp,listIndex,tmp;null==listTmpDataPara?(selectVal=RegionUtil.resolveParaVal(paraData,regionAttr),tmp=$(targetNode),tmp.selectValue=selectVal,selectDomArray.push(tmp)):null!=this.regionUIData[regionListNamePara]&&null!=this.regionUIData[regionListNamePara][listIndexPara]&&RegionUtil.resolveParaVal(this.regionUIData[regionListNamePara][listIndexPara],regionAttr)==RegionUtil.resolveParaVal(this.regionData[regionListNamePara][listIndexPara],regionAttr)||(listIndex=listIndexPara,null!=regionAttr&&(selectVal=RegionUtil.resolveParaVal(listTmpDataPara[listIndex],regionAttr)),tmp=$(targetNode),tmp.selectValue=selectVal,tmp.listIndex=listIndex,selectDomArray.push(tmp))}else{if("REGION"==targetNode.tagName)return void RegionTagPlugin.render(this,$(targetNode),listTmpDataPara[listIndexPara]);null!=regionAttr&&(null==listTmpDataPara?this.renderAttribute(targetNode,regionId,RegionUtil.resolveParaVal(listTmpDataPara[listIndex],regionAttr),regionAttr,null,null):(listIndex=listIndexPara,val=null,val="index"==regionAttr?this.isInGrid?(gird=this.parent,null==gird.regionData.pageSize?listIndex+1:gird.regionData.pageSize*(gird.regionData.currentPageNo-1)+listIndex+1):listIndex+1:RegionUtil.resolveParaVal(listTmpDataPara[listIndex],regionAttr),listNodeChangedState=this.renderAttribute(targetNode,regionId,val,regionAttr,regionListNamePara,listIndex)))}if(1==listNodeChangedState||-1==listNodeChangedState)for(var childs=targetNode.childNodes,i=0,tmpLength=childs.length;i<tmpLength;i++)null!=childs[i].tagName&&this.renderRowNode(childs[i],regionId,paraData,selectDomArray,listTmpDataPara,regionListNamePara,listIndexPara,rowElem);var regionShow=targetNode.getAttribute("region-show"),rowData,paraMap,regionData,scriptVal,jqObj,regionHide,rowData,paraMap,regionData,scriptVal,jqObj,regionRemove,rowData,paraMap,regionData,scriptVal,jqObj;null!=regionShow&&""!=regionShow?(rowData=RegionUtil.getRowData(targetNode),paraMap=this.paraMap,regionData=this.regionData,this.isInGrid&&(regionData=this.parent.regionData,paraMap=this.parent.paraMap),null!=regionData&&(scriptVal=function(arg,rowData,paraMap,regionData){var scriptVal=!1;return eval("scriptVal=("+arg+")"),scriptVal}(regionShow,rowData,paraMap,regionData),jqObj=$(targetNode),scriptVal?jqObj.removeClass("hidden"):jqObj.addClass("hidden"))):(regionHide=targetNode.getAttribute("region-hide"),null!=regionHide&&""!=regionHide?(rowData=RegionUtil.getRowData(targetNode),paraMap=this.paraMap,regionData=this.regionData,this.isInGrid&&(regionData=this.parent.regionData,paraMap=this.parent.paraMap),null!=regionData&&(scriptVal=function(arg,rowData,paraMap,regionData){var scriptVal=!1;return eval("scriptVal=("+arg+")"),scriptVal}(regionHide,rowData,paraMap,regionData),jqObj=$(targetNode),scriptVal?jqObj.addClass("hidden"):jqObj.removeClass("hidden"))):(regionRemove=targetNode.getAttribute("region-remove"),null!=regionRemove&&""!=regionRemove&&(rowData=RegionUtil.getRowData(targetNode),paraMap=this.paraMap,regionData=this.regionData,this.isInGrid&&(regionData=this.parent.regionData,paraMap=this.parent.paraMap),null!=regionData&&(scriptVal=function(arg,rowData,paraMap,regionData){var scriptVal=!1;return eval("scriptVal=("+arg+")"),scriptVal}(regionRemove,rowData,paraMap,regionData),jqObj=$(targetNode),scriptVal&&jqObj.remove()))))},RegionForm.prototype.renderListTag=function(g,e,t){for(var i=$(t),n=(i.removeClass("hidden"),i.attr("region-ls-primary")),r=i.find("[region-attr=index]"),a=null,o=null,l=(0<r.length&&(o="SPAN"==(t=(a=r[0]).tagName)||"TD"==t?"1":"2"),FORM_CONSTANTS.buf=[],0),s=0,d=e.length;s<d;s++){var u=e[s];l++,i.attr("index",s),null!=n&&i.attr("primary-val",u[n]),"1"==o?(a.setAttribute("index",l),a.innerText=l):"2"==o&&(a.setAttribute("index",l),r.val(l)),FORM_CONSTANTS.buf.push(i.prop("outerHTML"))}i=null;try{return FORM_CONSTANTS.buf.join("")}finally{FORM_CONSTANTS.buf=[]}},RegionForm.prototype.resolveInnerTags=function(e){if(null!=e){var t,i,n=null;try{n=e.getAttribute("region-attr")}catch(e){}null!=n?((i=null)!=(t=RegionUtil.getRegionById(e.getAttribute("region-id"))).regionData&&(i=t.regionData[n]),RegionUtil.resolveTag(this,e,e.tagName,i)):"REGION"==e.tagName&&RegionUtil.resolveTag(this,e,"REGION",i);var r=this;if($(e).find("message").each(function(e){var t=this.getAttribute("key"),t=RegionUtil.getMessage(r,t);$(this).replaceWith("<label class='messagelabel "+this.className+"'>"+t+"</label>")}),1<e.length)for(var a=0;a<e.length;a++)this.resolveInnerTags(e[a]);var o=e.childNodes;if(null!=o)for(a=0;a<o.length;a++)this.resolveInnerTags(o[a])}},RegionForm.prototype.renderAttribute=function(e,t,i,n,r,a){null==i&&(i="");var o=e.tagName;if(0<this.renderCount){if(null!=r){if("index"==n)return(l={}).htmlElem=e,l.paraData=i,void this.refreshCells.push(l);return null!=this.regionUIData[r]&&null!=this.regionUIData[r][a]&&RegionUtil.resolveParaVal(this.regionUIData[r][a],n)==RegionUtil.resolveParaVal(this.regionData[r][a],n)?0:("SPAN"==o||"TD"==o||"DIV"==o?((l={}).htmlElem=e,l.paraData=i,this.refreshCells.push(l)):RegionUtil.updateValForElem(this,$(e),i,a),1)}var l,r=$(e);r.hasClass("region-searchable")||RegionUtil.resolveParaVal(this.regionUIData,n)!=RegionUtil.resolveParaVal(this.regionData,n)&&("SPAN"==o||"TD"==o?((l={}).htmlElem=e,l.paraData=i,this.refreshCells.push(l)):RegionUtil.updateValForElem(this,r,i))}else{if("index"==n)return;if("SPAN"==o||"TD"==o)return(l={}).htmlElem=e,l.paraData=i,void this.refreshCells.push(l);if("INPUT"==o&&"hidden"==e.type)return void $(e).val(i);if(RegionUtil.resolveTag(this,e,o,i))return;"INPUT"==o&&"checkbox"==e.type?e.value==i?$(e).prop("checked",!0):$(e).prop("checked",!1):"IMG"==o?$(e).attr("src",i):"false"==$(e).attr("escapeHtml")?$(e).html(i):$(e).val(i)}},RegionForm.prototype.dsDataChanged=function(e,t){if(null==t&&null==e)return!1;if(null==t&&null!=e)return!0;if(null!=t&&null==e)return!0;if(t.length!=e.length)return!0;for(var i=0,n=t.length;i<n;i++){var r,a=t[i],o=e[i];for(r in a)if(a[r]!=o[r])return!0}return!1},RegionForm.prototype.reset=function(){var e=this;RS.confirm(getMsg("global_msg.reset_confirm"),"",function(){ErrorPromptPlugin.cleanErrorsForRegion(e),e.renderData()})},RegionForm.prototype.renderData=function(){$(this.getRegionDivElem()).addClass("hidden");this.subRenderData()},RegionForm.prototype.subRenderData=function(){var e=this,t=(this.refreshCells=[],this.refreshUIData(),Config.REGION_DEBUG_MODE&&console.log(this.regionId+":beforeRenderData"),null);null!=(t="function"==typeof this.beforeRenderData?this.beforeRenderData():t)?t.done(function(){e.underSubRenderData()}):e.underSubRenderData()},RegionForm.prototype.underSubRenderData=function(){for(var e={},t=this.paraMap.keySet(),i=0,n=t.length;i<n;i++)if(""!==t[i]&&null!=t[i])if(-1==t[i].indexOf("."))e[t[i]]=this.paraMap.get(t[i]);else{var r=t[i],a=this.paraMap.get(r),a=RegionUtil.constructObject(a,r),o=a[0],g=(null==e[o]&&(e[o]={}),a[1][o]);for(x in g)e[o][x]=g[x]}if(null!=this.regionData){var u=clone(this.regionData);for(x in u)e[x]=u[x]}for(var l=[],c=this.getRegionDivElem(),s=(this.renderNode(c,this.regionId,e,l,null,null,null,null),null),i=0,n=l.length;i<n;i++)RegionUtil.resolveDataSourceTag(this,(s=l[i])[0],s[0].tagName,s.selectValue);for(s=null,i=0,n=this.refreshCells.length;i<n;i++){var d=(s=this.refreshCells[i]).htmlElem.getAttribute("default");null==d&&(d=""),null==s.paraData||""===s.paraData?s.htmlElem.innerText=d:"false"==s.htmlElem.getAttribute("escapeHtml")?s.htmlElem.innerHTML=s.paraData:s.htmlElem.innerText=s.paraData}this.isInGrid?console.log(this.refreshCells.length+l.length+" cells updated for GridRegion"):console.log(this.refreshCells.length+l.length+" cells updated for FormRegoin"),this.renderDataComplete(),this.renderCount++},RegionForm.prototype.showLoading=function(){this.find(".loadingIcon").removeClass("hidden"),this.isInGrid||this.find(".region-refresh").addClass("rotate-class")},RegionForm.prototype.hideLoading=function(){this.show(),this.find(".loadingIcon").addClass("hidden"),this.isInGrid||this.find(".region-refresh").removeClass("rotate-class")},RegionForm.prototype.addRegionId=function(e){RegionUtil.addRegionUniqueId(e,this.regionId)},RegionForm.prototype.callRowRender=function(){for(var curRegion=this,listParts=curRegion.find(".region-list"),i=0;i<listParts.length;i++){var listObj=$(listParts[i]),listData=eval("curRegion.regionData."+listObj.attr("region-list"));null!=listData&&listObj.children().each(function(e,t){curRegion.onRowRender(t,listData[e],listData)})}},RegionForm.prototype.renderDataComplete=function(){RegionUtil.resolveCodeMark(this);var e,t=this.regionData;null==t||"403"!=t.respCode&&"405"!=t.respCode&&"409"!=t.respCode?(null!=this.onRowRender&&"function"==typeof this.onRowRender&&this.callRowRender(),Config.REGION_DEBUG_MODE&&console.log(this.regionId+":afterRenderData"),t=null,"function"==typeof this.afterRenderData&&(t=this.afterRenderData()),e=this,null!=t?t.done(function(){e.subRenderDataComplete()}):e.subRenderDataComplete()):this.subRenderDataComplete()},RegionForm.prototype.subRenderDataComplete=function(){null==window.regionDef&&(window.regionDef={});var e=this;Config.lazyLoadImg&&window.setTimeout(function(){try{e.find(".lazyImg").lazyload({placeholder:"images/loading.gif",threshold:200,effect:"fadeIn",container:$(e.getRegionDivElem())})}catch(e){}}),this.isInGrid?(Config.REGION_DEBUG_MODE&&console.log(this.regionId+":resolve inputform of grid afterRenderData def"),RegionUtil.resolveDef(DEF_DEFINITIONS.REG_DEF_FORMINGRID_RENDERRED+this.regionId,this),this.parent.renderDataComplete()):(Config.REGION_DEBUG_MODE&&console.log(this.regionId+":resolve inputform afterRenderData def"),RegionUtil.resolveDef(DEF_DEFINITIONS.REG_DEF_RENDERED+this.regionId,this),this.hideLoading())},RegionForm.prototype.hide=function(){$(this.getRegionDivElem()).addClass("hidden")},RegionForm.prototype.show=function(){$(this.getRegionDivElem()).removeClass("hidden")},RegionForm.prototype.getRegionDivElem=function(){return null!=this.regionDivElem||(this.regionDivElem=document.getElementById(this.regionDivId)),this.regionDivElem},RegionForm.prototype.getDom=function(){return null!=this.regionDivElem||(this.regionDivElem=document.getElementById(this.regionDivId)),this.regionDivElem},RegionForm.prototype.getRegionDivContainer=function(){return this.getRegionDivElem().parentNode},RegionForm.prototype.getHolder=function(){return this.getRegionDivElem().parentNode.parentNode},FieldError.prototype.showErrorMsg=function(e){var t=this.region.getDomObjByBindAttribute(this.regionAttribute);ErrorPromptPlugin.showErrorMsg(t,this,e)},FieldError.prototype.cleanErrorMsg=function(e){var t=this.region.getDomObjByBindAttribute(this.regionAttribute);ErrorPromptPlugin.cleanErrorMsg(t,this,e)},RegionForm.prototype.disable=function(){RS.disableInput(this,!0)},RegionForm.prototype.enable=function(){RS.disableInput(this,!1)},RegionForm.prototype.find=function(e){return RegionUtil.findInRegion(e,this.regionId)},RegionForm.prototype.findExsit=function(e){return $(this.getRegionDivElem()).find(e)},RegionForm.prototype.getRegionUIAttr=function(e){e=this.find("[region-attr='"+e+"']"),e=RegionUtil.getAttriObjVal(e);return e=""===e?null:e},RegionForm.prototype.geObjByRegionAttri=function(e){return this.find("[region-attr='"+e+"']")},RegionForm.prototype.getAttriObj=function(e){return this.find("[region-attr='"+e+"']")},RegionForm.prototype.setRegionUIAttr=function(e,t){e=this.find("[region-attr='"+e+"']");RegionUtil.updateValForElem(this,e,t,null)},RegionForm.prototype.setAttr=function(e,t){null==this.regionData&&(this.regionData={}),this.regionData=this.packFormData();t=RegionUtil.constructObject(t,e);this.regionData[t[0]]=t[1][t[0]],this.renderData()},RegionForm.prototype.getAttr=function(e){return null==this.regionData?null:(this.regionData=this.packFormData(),this.regionData[e])},RegionForm.prototype.setAttrs=function(e){this.regionData=this.packFormData();for(var t=e.keySet(),i=0;i<t.length;i++)this.regionData[t[i]]=e.get(t[i]);this.renderData()},RegionForm.prototype.getLocaleMsg=function(e){return RegionUtil.getMessage(this,e)},RegionForm.prototype.config=function(e,t){null==this.configs&&(this.configs={}),this.configs[e]=t},RegionForm.prototype.getAttrConfig=function(e){return null==this.configs?(this.configs={},null):this.configs[e]},RegionForm.prototype.release=function(){"function"==typeof this.onRelease&&this.onRelease(),this.removeWebsocketTopicListeners(),this.clearEventListeners(),this.clearIntervals();var e=this.childRegionIds,t=(delete window.regions[this.regionId],delete window["region_"+this.regionId],RS.getOuterRegion(this));if(null!=t)for(var i=0;i<t.childRegionIds.length;i++)if(t.childRegionIds[i]==this.regionId){t.childRegionIds.splice(i,1);break}if($(this.getRegionDivElem()).parent().remove(),null!=e)for(i=0;i<e.length;i++){var n=RegionUtil.getRegionById(e[i]);null!=n&&n.release()}RS.callOnReleaseHock(this)},RegionForm.prototype.removeWebsocketTopicListeners=function(){var e=this.topicListenersReg;if(null!=e)for(x in e)e[x].release();delete this.topicListenersReg},RegionForm.prototype.releaseChildRegions=function(){var e=this.childRegionIds;if(null!=e){for(var t=0;t<e.length;t++){var i=RegionUtil.getRegionById(e[t]);null!=i&&i.release()}this.childRegionIds=null}},RegionForm.prototype.addEventListener=function(e,t){return null==e?(console.error("eventCode is empty"),!1):null==t?(console.error("eventListener is empty"),!1):(null==this.listenerRegistry&&(this.listenerRegistry={}),null!=this.listenerRegistry[e]?(console.error("exists listener for eventCode:"+e+",ignored this listener"),!1):((this.listenerRegistry[e]=t).regionId=this.regionId,RegionUtil.eventBus().addEventListener(e,t),!0))},RegionForm.prototype.removeEventListener=function(e){var t=this.listenerRegistry[e];return null!=t&&(this.listenerRegistry[e]=null,RegionUtil.eventBus().removeListener(e,t),!0)},RegionForm.prototype.clearEventListeners=function(){this.listenerRegistry=null,RegionUtil.eventBus().removeListenersForRegion(this)},RegionForm.prototype.publishEvent=function(e,t){var i={};i.eventCode=e,i.eventData=t,RegionUtil.eventBus().publishEvent(i)},RegionForm.prototype.addInterval=function(e,t){e=setInterval(e,t);return e.id=RegionUtil.UUID(),null==this.intervals&&(this.intervals={}),this.intervals[e.id]=e},RegionForm.prototype.clearIntervals=function(){if(null!=this.intervals)for(x in this.intervals)clearInterval(this.intervals[x])};var FORM_CONSTANTS={escapeHtml:"escapeHtml",falseStr:"false",trueStr:"true",regionUrl:"region-url",functionStr:"function",type:"type",regionId:"region-id",span:"SPAN",td:"TD",message:"MESSAGE",regionAttr:"region-attr",input:"INPUT",template:"template",indexStar:"*[index]",listInnerComp:".list-inner-comp",regionDsrendered:"region-dsrendered",outerHtml:"outerHTML",priVal:"primary-val",index:"index",emptyStr:"",buf:null};function RequestData(){this.currentPageNo=0,this.totalPageAmount=0,this.totalAmount=0,this.pageNumberBtns=0,this.deleteIds=null,this.deleteId=null}function RegionGrid(e,t,i,n){RegionUtil.cleanRegions(),this.webContext=Config.frontendPath,this.defaultPageSize=10,this.type="RegionGrid",this.resources=n,this.paraMap=RegionUtil.getUrlParaMap();var r,n=document.querySelectorAll(e),n=(null==n||0==n.length?RegionUtil.alert("No region grid found : "+e):1<n.length&&RegionUtil.alert("Duplicate region grid found : duplicate region :"+e),n[0]),a=($(n).css("height","100%"),$(n).css("width","100%"),$(n).prepend('<div class="loadingIcon  text-center" style="position:absolute;z-index:1;float:right;width:100%;top:45%"><i class="fa fa-spinner fa-pulse fa-2x fa-fw"></i></div>'),this.mainUrl=RegionUtil.wrapRegionParas(n,this.paraMap),isEmpty(t)?isEmpty(this.paraMap.get("region-id"))?isEmpty(t)&&(t=getUUID()):t=this.paraMap.get("region-id"):(t=t.trim(),isEmpty(n=this.paraMap.get("region-id"))||null!=(r=window.regionDef[DEF_DEFINITIONS.REG_DEF_RENDERED+n])&&(window.regionDef[DEF_DEFINITIONS.REG_DEF_RENDERED+t]=r,window.regionDef[DEF_DEFINITIONS.REG_DEF_RENDERED+n]=null)),null==window.regions&&(window.regions=new Object),this.waitingForSearched=null==i||i,this.regionId=t,this.regionDivId="region_"+this.regionId,this.validators=new Object,this.validationErrors=new HashMap,(window.regions[t]=this).requestData=new RequestData,this.regionData=null,this);this.orderMap=new HashMap,this.regionForm=new RegionForm(e,t,this,null,null,this.resources),RegionUtil.createNewDef(DEF_DEFINITIONS.REG_DEF_FORMINGRID_RENDERRED+this.regionForm.regionId).done(function(e){var t=document.getElementById(a.regionDivId);a.addRegionId(t),a.initSearchBar(),console.log("inner form loaded"),collapseToggle($(t)),a.hideLoading()}),this.regionForm.renderData()}function setUrlParametersToBindAttr(e,n){for(var r=n.keySet(),a=0;a<r.length;a++)""!=r[a]&&null!=r[a]&&RegionUtil.findInHtmlObj(e,"[region-attr='"+r[a]+"']").each(function(e,t){var i=$(this);i.hasClass("region-searchable")&&("SPAN"==i.get(0).tagName?i.html(n.get(r[a])):i.val(n.get(r[a])))})}function StaticRegion(regionDivSelector,resources,paraRegionId){RegionUtil.cleanRegions(),this.type="StaticRegion",this.resources=resources,this.paraMap=RS.getUrlParaMap(),this.proxyData({}),this.regionUIData=this.regionData;for(var tmpArray=document.querySelectorAll(regionDivSelector),regionId=(null==tmpArray||0==tmpArray.length?RS.alert("Dom selector does not found "):1<tmpArray.length&&RS.alert("Duplicate dom selector are found"),this.regionDivElem=tmpArray[0],this.mainUrl=RS.wrapRegionParas(this.regionDivElem,this.paraMap),this.paraMap.get("region-id")),regionAttrArray=(isEmpty(regionId)&&(regionId=paraRegionId),isEmpty(regionId)&&(regionId=getUUID()),this.regionId=regionId,null==window.regions&&(window.regions={}),window.regions[regionId]=this,this.regionDivId="region_"+regionId,this.regionDivElem.setAttribute("id",this.regionDivId),$(this.regionDivElem).css("height","100%"),$(this.regionDivElem).css("width","100%"),RS.addRegionUniqueId(this.regionDivElem,regionId),this.validators={},this.validationErrors=new HashMap,this.validationErrorCount=0,this.renderCount=0,this.find($("*[region-attr]"))),i=0,tmpLength=regionAttrArray.length;i<tmpLength;i++){tmpObj=regionAttrArray[i],tmpAttrName=tmpObj.getAttribute("region-attr");var methodName=tmpAttrName.replaceAll("\\.","_").firstCapitalize();eval("this.set"+methodName+'= function(value){this.setRegionUIAttr("'+tmpAttrName+'",value)};this.get'+methodName+'= function(){return this.getRegionUIAttr("'+tmpAttrName+'")};')}}function FieldError(e,t,i,n,r){this.regionAttribute=e,this.errorDivId=t,this.errorMsg=i,this.region=n,this.labelTxt=r}RegionGrid.prototype.initSearchBar=function(){var e,a=this,t=this.getRegionDivElem(),i=this.find(".form-info");i.find(".grid-search").click(function(){var e=a.find(".form-search");"none"==e.css("display")?e.show(300):e.hide(300)}),i.find(".grid-plus").click(function(){for(var e=$(this),t=a.paraMap,i=RegionUtil.wrapBtnParameters(e),e=(i.put("refreshRegionId",e.attr("region-id")),a.paraMap.get("rsAppId")),n=(null!=e&&i.put("rsAppId",e),i.keySet()),r=0;r<n.length;r++)t.put(n[r],i.get(n[r]));t.put("popUp",1);openModalWindow(RegionUtil.appendParaMapToUrl(a.reqRes,t),a.addTitle,a.popupSize)}),this.find(".regionSearchBtn").click(function(){a.search()}),this.find(".regionResetBtn").click(function(){a.reset(),a.search()}),this.find(".batch-delete").click(function(){a.batchDelete()}),RegionUtil.findInHtmlObj(t,".region-list");RegionUtil.findInHtmlObj(t,".selectAll").change(function(){e=RegionUtil.findInHtmlObj(t,".region-list"),$(this).is(":checked")?RegionUtil.findInHtmlObj(e[0],".multipleCbs").prop("checked",!0):RegionUtil.findInHtmlObj(e[0],".multipleCbs").prop("checked",!1)}),this.find(".region-refresh").click(function(){a.refreshRegion()}),this.find(".datas-columns").each(function(){a.enableOrderForTable($(this))})},RegionGrid.prototype.enableOrderForTable=function(e){for(var t=e.children(),i=this,n=0;n<t.length;n++){var r=$(t[n]),a=r.attr("region-order");null!=a&&(0==r.find(".dmcaret").length?(this.orderMap.put(a,r),r.append('<b class="dmcaret"></b>'),r.click(function(){var e=$(this),t=e.attr("region-order");i.orderBy==t+" desc"?(i.orderBy=t+" asc",e.find(".dmcaret").attr("class","amcaret")):(i.orderBy=t+" desc",e.find(".amcaret").attr("class","dmcaret")),i.refreshRegion()}).css("cursor","pointer")):r.click(function(){var e=$(this),t=e.attr("region-order");i.orderBy==t+" desc"?(i.orderBy=t+" asc",e.find(".dmcaret").attr("class","amcaret")):(i.orderBy=t+" desc",e.find(".amcaret").attr("class","dmcaret")),i.refreshRegion()}).css("cursor","pointer")),this.enableOrderForTable(r)}},RegionGrid.prototype.renderOrderColumn=function(){if(null!=this.regionData.orderBy&&""!=this.regionData.orderBy)for(var e=this.regionData.orderBy.split(" ")[0],t=this.orderMap.keySet(),i=0;i<t.length;i++)t[i]==e?this.orderMap.get(t[i]).addClass("hightsort"):this.orderMap.get(t[i]).removeClass("hightsort")},RegionGrid.prototype.hide=function(){var e=this.getRegionDivElem();$(e).addClass("hidden")},RegionGrid.prototype.show=function(){var e=this.getRegionDivElem();$(e).removeClass("hidden")},RegionGrid.prototype.viewRecord=function(e,t,i,n,r){var e=e.id,a="",o=this.reqRes;if(null!=n&&(o=n),null!=i)for(var l=i.keySet(),s=0;s<l.length;s++)a=a+"&"+l[s]+"="+i.get(l[s]);var n=this.paraMap.get("rsAppId"),d=this.viewTitle;return openModalWindow(o+"?popUp=1&recordId="+e+"&refreshRegionId="+t+(a=null!=n?a+"&rsAppId="+n:a),d=null!=r?r:d,this.popupSize)},RegionGrid.prototype.getRequestData=function(){return this.requestData},RegionGrid.prototype.isPopup=function(e){return"1"==this.paraMap.get("popUp")},RegionGrid.prototype.prePage=function(){this.requestData.deleteIds=null,this.requestData.deleteId=null,this.requestData.currentPageNo<=1||this.retrivePage(this.requestData.currentPageNo-1)},RegionGrid.prototype.nextPage=function(){this.requestData.deleteIds=null,this.requestData.deleteId=null,this.retrivePage(this.requestData.currentPageNo+1)},RegionGrid.prototype.gotoPage=function(e,t){this.requestData.deleteIds=null,this.requestData.deleteId=null,this.retrivePage(e,t)},RegionGrid.prototype.retriveDeletePage=function(t,i){Config.REGION_DEBUG_MODE&&console.log(this.regionId+":beforeRetrieveData");var n=this,r=("function"==typeof this.beforeRetrivePage&&this.beforeRetrivePage(),t<1?t=1:t>this.requestData.totalPageAmount&&(t=this.requestData.totalPageAmount),clone(this.requestData)),e=null;null!=(e="function"==typeof this.beforePostData?this.beforePostData(r):e)?e.done(function(){var e;r.currentPageNo=t,null==i?(n.resUrl=null==n.paraMap.get("resUrl")?n.resUrl:n.paraMap.get("resUrl"),null!=n.resUrl&&null==n.resUrl&&(n.resUrl=n.resUrl),null!=n.resUrl?(e=n.searchCallBack,n.showLoading(),RegionUtil.ajaxRequestJson(n,n.resUrl+"/delete","POST",r,e,!0,null)):(RegionUtil.alert("resUrl is empty"),n.hideLoading())):n.searchCallBack(i)}):(r.currentPageNo=t,null==i?(this.resUrl=null==this.paraMap.get("resUrl")?this.resUrl:this.paraMap.get("resUrl"),null!=this.resUrl&&null==this.resUrl&&(this.resUrl=this.resUrl),null!=this.resUrl?(e=this.searchCallBack,this.showLoading(),RegionUtil.ajaxRequestJson(this,this.resUrl+"/delete","POST",r,e,!0,null)):(RegionUtil.alert("resUrl is empty"),this.hideLoading())):this.searchCallBack(i))},RegionGrid.prototype.retrivePage=function(e,t){Config.REGION_DEBUG_MODE&&console.log(this.regionId+":beforeRetrieveData"),"function"==typeof this.beforeRetrivePage&&this.beforeRetrivePage(),e<1?e=1:e>this.requestData.totalPageAmount&&(e=this.requestData.totalPageAmount);var i,n,r=clone(this.requestData);r.orderBy=this.orderBy,r.currentPageNo=e,null!=r.pageSize&&0!=r.pageSize||null==this.defaultPageSize||(r.pageSize=this.defaultPageSize),null==t?(this.resUrl=null==this.paraMap.get("resUrl")?this.resUrl:this.paraMap.get("resUrl"),null!=this.resUrl&&null==this.resUrl&&(this.resUrl=this.resUrl),null!=this.resUrl?(i=this.searchCallBack,this.showLoading(),(e=null)!=(e="function"==typeof(n=this).beforePostData?this.beforePostData(r):e)?e.done(function(){RegionUtil.ajaxRequestJson(n,n.resUrl,"POST",r,i,!0,null)}):RegionUtil.ajaxRequestJson(n,n.resUrl,"POST",r,i,!0,null)):(RegionUtil.alert("resUrl is empty"),this.hideLoading())):this.searchCallBack(t)},RegionGrid.prototype.searchCallBack=function(e,t,i){Config.REGION_DEBUG_MODE&&console.log(this.regionId+":afterRetrieveData");var n=this;if(!e.success)return this.renderDataComplete(),RegionUtil.resolveDef(DEF_DEFINITIONS.REG_DEF_GRID_DELETE+this.regionId,this),void(403==e.respCode||null!=e.msg&&""!=e.msg.trim()&&RegionUtil.alert(e.msg));if(this.regionData=e.data,Config.REGION_DEBUG_MODE&&console.log(this.regionId+":beforeRenderData"),"function"==typeof this.beforeRenderData){var r=this.beforeRenderData();if(null!=r)return void r.done(function(){n.subSearchCallBack(e)})}n.subSearchCallBack(e)},RegionGrid.prototype.subSearchCallBack=function(e){this.requestData.currentPageNo=this.regionData.currentPageNo,this.requestData.totalPageAmount=this.regionData.totalPageAmount,this.requestData.totalAmount=this.regionData.totalAmount,this.orderBy=this.regionData.orderBy,this.requestData.pageSize=this.regionData.pageSize,this.requestData.deleteIds=null,this.requestData.deleteId=null,this.regionForm.regionDataBakup=this.regionForm.regionData,this.regionForm.regionData=e.data;var t=this.regionForm.packFormData("region-searchable");for(x in t)this.regionForm.regionData[x]=t[x];this.regionForm.refreshRegion(),this.renderData(),RegionUtil.resolveDef(DEF_DEFINITIONS.REG_DEF_GRID_DELETE+this.regionId,this),"function"==typeof this.searchSuccessCallBack&&this.searchSuccessCallBack()},RegionGrid.prototype.renderData=function(){this.renderOrderColumn();var e=this.getRegionDivElem();PaginationPlugin.renderPaginationControl(this,this.find(".paginationControl"),this.requestData.totalAmount,this.requestData.currentPageNo,this.requestData.totalPageAmount,this.requestData.pageSize),0!=this.regionData.totalAmount?(this.find(".table-body").removeClass("hidden"),this.find(".norecordmsg").addClass("hidden")):(this.find(".table-body").addClass("hidden"),this.find(".norecordmsg").removeClass("hidden")),null!=this.regionData.msg&&""!=this.regionData.msg.trim()&&console.log(this.regionData.msg),this.addRegionId(e),refreshMessage(this.find(".paginationControl")),Config.REGION_DEBUG_MODE&&console.log(this.regionId+":resolve afterRenderData def")},RegionGrid.prototype.addRegionId=function(e){RegionUtil.addRegionUniqueId(e,this.regionId)},RegionGrid.prototype.dummySearch=function(e){if("function"==typeof this.beforeRetrieveData&&this.beforeRetrieveData(),this.regionForm.validate()){var t=this.regionForm.packFormData("region-searchable");for(x in t)this.requestData[x]=t[x];this.gotoPage(1,e)}},RegionGrid.prototype.search=function(){var t=this;if("function"==typeof this.beforeValidate&&0==this.beforeValidate())return Config.REGION_DEBUG_MODE&&console.log(this.regionId+":beforeValidate false in region:"+this.regionId),RegionUtil.resolveDef(DEF_DEFINITIONS.REG_DEF_RENDERED+this.regionId,this),void this.hideLoading();if(!this.validate())return"function"==typeof this.afterValidate&&this.afterValidate(),RegionUtil.resolveDef(DEF_DEFINITIONS.REG_DEF_RENDERED+this.regionId,this),void this.hideLoading();"function"==typeof this.afterValidate&&this.afterValidate();var e=null;if(null!=(e="function"==typeof this.beforeRetrieveData?this.beforeRetrieveData():e))e.done(function(){var e=t.regionForm.packFormData("region-searchable");for(x in e)t.requestData[x]=e[x];t.gotoPage(1)});else{var i=t.regionForm.packFormData("region-searchable");for(x in i)t.requestData[x]=i[x];t.gotoPage(1)}},RegionGrid.prototype.reset=function(){var r=this,e=r.getRegionDivElem();RegionUtil.findInHtmlObj(e,"[region-attr]").each(function(e,t){var i,n=$(this);n.hasClass("region-searchable")&&(n.hasClass("split-input")?(i=n.attr("region-attr"),r.regionForm.setRegionUIAttr(i,r.regionForm.regionData.attr)):n.val(""))}),setUrlParametersToBindAttr(e,r.paraMap)},RegionGrid.prototype.refreshRegion=function(){this.requestData.deleteIds=null,this.requestData.deleteId=null,this.retrivePage(this.requestData.currentPageNo)},RegionGrid.prototype.deleteData=function(i){var e=i.id,n=(this.highlightDeleteRecord(e),this.requestData.deleteId=e,null==this.deleteMsg&&(this.deleteMsg="global_msg.confirm_to_delete_single"),this),r=new jQuery.Deferred;return RegionUtil.confirm(getMsg(n.deleteMsg),global_msg.alert,function(){var e=n.requestData.deleteId,t=RegionUtil.createNewDef(DEF_DEFINITIONS.REG_DEF_GRID_DELETE+n.regionId);n.removeHighDeleteRecord(e),n.retriveDeletePage(n.requestData.currentPageNo),t.done(function(){r.resolve(!0),null!=n.deleteCallBack&&"function"==typeof n.deleteCallBack&&n.deleteCallBack(i)})},function(){r.resolve(!1);var e=n.requestData.deleteId;n.removeHighDeleteRecord(e)}).done(function(e){n.removeHighDeleteRecord(n.requestData.deleteId),n.requestData.deleteId=null}),r.promise()},RegionGrid.prototype.highlightDeleteRecord=function(e){for(var t=this.find(".region-list").children(),i=0;i<t.length;i++)if($(t[i]).attr("primary-val")==e){$(t[i]).addClass("darklight");break}},RegionGrid.prototype.removeHighDeleteRecord=function(e){this.getRegionDivElem();for(var t=this.find(".region-list").children(),i=0;i<t.length;i++)if($(t[i]).attr("primary-val")==e){$(t[i]).removeClass("darklight");break}},RegionGrid.prototype.batchDelete=function(){var t,e=this.getRegionDivElem(),i="",e=$(e).find(".region-list").find(".multipleCbs"),n=!1;$.each(e,function(e,t){t.checked&&(n=!0,i+=$(t).closest("*[index]").attr("primary-val")+";")}),n?(this.requestData.deleteIds=i,t=this,RegionUtil.confirm(getMsg("global_msg.confirm_to_delete"),global_msg.alert,function(){var e=RegionUtil.createNewDef(DEF_DEFINITIONS.REG_DEF_GRID_DELETE+t.regionId);t.retriveDeletePage(t.requestData.currentPageNo),e.done(function(){null!=t.deleteCallBack&&"function"==typeof t.deleteCallBack&&t.deleteCallBack()})},null).done(function(e){t.requestData.deleteIds=null})):RegionUtil.alert(getMsg("global_msg.no_item_selected"))},RegionGrid.prototype.batchChoose=function(){var e=this.getRegionDivElem(),i="",e=$(e).find(".region-list").find(".multipleCbs");return $.each(e,function(e,t){t.checked&&(i+=$(t).closest("*[index]").attr("primary-val")+";")}),i},RegionGrid.prototype.renderDataComplete=function(){Config.REGION_DEBUG_MODE&&console.log(this.regionId+"grid:afterRenderData"),"function"==typeof this.afterRenderData&&this.afterRenderData();var t=this;this.find(".selectAll").each(function(){var e=$(this);null==e.attr("nt")&&(e.attr("nt","1"),e.change(function(){var e=t.find(".region-list").find(".multipleCbs"),i=!1,e=($.each(e,function(e,t){if(t.checked)return!(i=!0)}),t.find(".batch-delete"));i?(e.removeClass("moveout-animation2-class"),e.addClass("movein-animation2-class"),e.removeClass("hidden")):e.addClass("moveout-animation2-class")}))}),this.find(".region-list").find(".multipleCbs").each(function(){var e=$(this);null==e.attr("nt")&&(e.attr("nt","1"),e.change(function(){var e=t.find(".region-list").find(".multipleCbs"),i=!1,e=($.each(e,function(e,t){if(t.checked)return!(i=!0)}),t.find(".batch-delete"));i?(e.removeClass("moveout-animation2-class"),e.addClass("movein-animation2-class"),e.removeClass("hidden")):e.addClass("moveout-animation2-class")}))}),this.waitingForSearched?this.waitingForSearched=!1:RegionUtil.resolveDef(DEF_DEFINITIONS.REG_DEF_RENDERED+this.regionId,this),this.hideLoading()},RegionGrid.prototype.hide=function(){var e=this.getRegionDivElem();$(e).addClass("hidden")},RegionGrid.prototype.show=function(){var e=this.getRegionDivElem();$(e).removeClass("hidden")},RegionGrid.prototype.showLoading=function(){RegionUtil.disableInput(this,!0),this.find(".loadingIcon").removeClass("hidden"),this.find(".region-refresh").addClass("rotate-class")},RegionGrid.prototype.hideLoading=function(){this.show(),this.find(".loadingIcon").addClass("hidden"),this.find(".region-refresh").removeClass("rotate-class"),RegionUtil.disableInput(this,!1)},RegionGrid.prototype.getRegionDivElem=function(){return null==this.regionDivElem&&(this.regionDivElem=document.getElementById(this.regionDivId)),this.regionDivElem},RegionGrid.prototype.getDom=function(){return null==this.regionDivElem&&(this.regionDivElem=document.getElementById(this.regionDivId)),this.regionDivElem},RegionGrid.prototype.getHolder=function(){return this.getRegionDivElem().parentNode.parentNode},RegionGrid.prototype.getRegionDivContainer=function(){return this.getRegionDivElem().parentNode},RegionGrid.prototype.setData=function(e){this.renderRegionWithData(e)},RegionGrid.prototype.renderWithData=function(e){this.renderRegionWithData(e)},RegionGrid.prototype.renderRegionWithData=function(e){this.regionData=e,this.regionForm.renderRegionWithData(e)},RegionGrid.prototype.updateUI=function(){this.regionForm.renderRegionWithData(this.regionData)},RegionGrid.prototype.addValidator=function(e,t,i){var n=this.validators[e];null==n&&(n=new Object,this.validators[e]=n),n.ruleArray=t,n.msgArray=i,this.regionForm.addValidator(e,t,i)},RegionGrid.prototype.removeValidator=function(e){delete this.regionForm.removeValidator[e]},RegionGrid.prototype.removeValidators=function(){this.regionForm.removeValidators()},RegionGrid.prototype.validateItem=function(e){this.regionForm.validateItem(e)},RegionGrid.prototype.validate=function(){return 1==this.disableValidaiton||this.regionForm.validate()},RegionGrid.prototype.disable=function(){RS.disableInput(this,!0)},RegionGrid.prototype.enable=function(){RS.disableInput(this,!1)},RegionGrid.prototype.find=function(e){return RegionUtil.findInRegion(e,this.regionId)},RegionGrid.prototype.findExsit=function(e){return $(this.getRegionDivElem()).find(e)},RegionGrid.prototype.getRegionUIAttr=function(e){e=this.find("[region-attr='"+e+"']");return RegionUtil.getAttriObjVal(e)},RegionGrid.prototype.geObjByRegionAttri=function(e){return this.find("[region-attr='"+e+"']")},RegionGrid.prototype.setRegionUIAttr=function(e,t){e=this.find("[region-attr='"+e+"']");RegionUtil.setAttriObjVal(e,t)},RegionGrid.prototype.getLocaleMsg=function(e){return RegionUtil.getMessage(this,e)},RegionGrid.prototype.release=function(){"function"==typeof this.onRelease&&this.onRelease(),this.removeWebsocketTopicListeners(),this.clearEventListeners();var e=this.childRegionIds;if(delete window.regions[this.regionId],delete window["region_"+this.regionId],$(this.getRegionDivElem()).parent().remove(),null!=e)for(var t=0;t<e.length;t++){var i=RegionUtil.getRegionById(e[t]);null!=i&&i.release()}this.regionForm.release(),RS.callOnReleaseHock(this)},RegionGrid.prototype.removeWebsocketTopicListeners=function(){var e=this.topicListenersReg;if(null!=e)for(x in e)e[x].release();delete this.topicListenersReg},RegionGrid.prototype.releaseChildRegions=function(){var e=this.childRegionIds;if(null!=e){for(var t=0;t<e.length;t++){var i=RegionUtil.getRegionById(e[t]);null!=i&&i.release()}this.childRegionIds=null}this.regionForm.releaseChildRegions()},RegionGrid.prototype.addEventListener=function(e,t){return null==e?(console.error("eventCode is empty"),!1):null==t?(console.error("eventListener is empty"),!1):(null==this.listenerRegistry&&(this.listenerRegistry={}),null!=this.listenerRegistry[e]?(console.error("exists listener for eventCode:"+e+",ignored this listener"),!1):((this.listenerRegistry[e]=t).regionId=this.regionId,RegionUtil.eventBus().addEventListener(e,t),!0))},RegionGrid.prototype.removeEventListener=function(e){var t=this.listenerRegistry[e];return null!=t&&(this.listenerRegistry[e]=null,RegionUtil.eventBus().removeListener(e,t),!0)},RegionGrid.prototype.clearEventListeners=function(){this.listenerRegistry=null,RegionUtil.eventBus().removeListenersForRegion(this)},RegionGrid.prototype.publishEvent=function(e,t){var i={};i.eventCode=e,i.eventData=t,RegionUtil.eventBus().publishEvent(i)},RegionGrid.prototype.addInterval=function(e,t){e=setInterval(e,t);return e.id=RegionUtil.UUID(),null==this.intervals&&(this.intervals={}),this.intervals[e.id]=e},RegionGrid.prototype.clearIntervals=function(){if(null!=this.intervals)for(x in this.intervals)clearInterval(this.intervals[x])},StaticRegion.prototype.getRegionUIAttr=function(e){e=this.find("[region-attr='"+e+"']"),e=RegionUtil.getAttriObjVal(e);return e=""===e?null:e},StaticRegion.prototype.reset=function(){var e=this;RS.confirm(getMsg("global_msg.reset_confirm"),"",function(){ErrorPromptPlugin.cleanErrorsForRegion(e),e.renderData()})},StaticRegion.prototype.refreshRegion=function(){this.render()},StaticRegion.prototype.render=function(){this.renderRegion()},StaticRegion.prototype.renderRegion=function(){this.renderData()},StaticRegion.prototype.renderData=function(){var e=this,t=null;null!=(t="function"==typeof e.beforeRenderData?e.beforeRenderData():t)?t.done(function(){e.subRenderData()}):e.subRenderData()},StaticRegion.prototype.callRowRender=function(){for(var curRegion=this,listParts=curRegion.find(".region-list"),i=0;i<listParts.length;i++){var listObj=$(listParts[i]),listData=eval("curRegion.regionData."+listObj.attr("region-list"));null!=listData&&listObj.children().each(function(e,t){curRegion.onRowRender(t,listData[e],listData)})}},StaticRegion.prototype.subRenderData=function(){var e=this,t=(e.underSubRenderData(),null!=this.onRowRender&&"function"==typeof this.onRowRender&&this.callRowRender(),Config.REGION_DEBUG_MODE&&console.log(this.regionId+":afterRenderData"),null);null!=(t="function"==typeof e.afterRenderData?e.afterRenderData():t)?t.done(function(){e.renderDataComplete()}):e.renderDataComplete()},StaticRegion.prototype.underSubRenderData=function(){this.refreshCells=[];for(var e={},t=this.paraMap.keySet(),i=0,n=t.length;i<n;i++)if(""!==t[i]&&null!=t[i])if(-1==t[i].indexOf("."))e[t[i]]=this.paraMap.get(t[i]);else{var r=t[i],a=this.paraMap.get(r),a=RegionUtil.constructObject(a,r),o=a[0],g=(null==e[o]&&(e[o]={}),a[1][o]);for(x in g)e[o][x]=g[x]}var u=clone(this.regionData);for(x in u)e[x]=u[x];for(var l=[],c=this.getRegionDivElem(),s=(this.renderNode(c,this.regionId,e,l,null,null,null,null),null),i=0,n=l.length;i<n;i++)RegionUtil.resolveDataSourceTag(this,(s=l[i])[0],s[0].tagName,s.selectValue);for(s=null,i=0,n=this.refreshCells.length;i<n;i++){var d=(s=this.refreshCells[i]).htmlElem.getAttribute("default");null==d&&(d=""),null==s.paraData||""===s.paraData?s.htmlElem.innerText=d:"false"==s.htmlElem.getAttribute("escapeHtml")?s.htmlElem.innerHTML=s.paraData:s.htmlElem.innerText=s.paraData}console.log(this.refreshCells.length+l.length+" cells updated for FormRegoin")},StaticRegion.prototype.renderDataComplete=function(){$(this.regionDivElem).removeClass("hidden"),RegionUtil.resolveDef(DEF_DEFINITIONS.REG_DEF_RENDERED+this.regionId,this),this.renderCount++;var e=this;Config.lazyLoadImg&&window.setTimeout(function(){try{e.find(".lazyImg").lazyload({placeholder:"images/loading.gif",threshold:200,effect:"fadeIn",container:$(e.getRegionDivElem())})}catch(e){}})},StaticRegion.prototype.getRegionDivElem=function(){return this.regionDivElem},StaticRegion.prototype.getDom=function(){return this.regionDivElem},StaticRegion.prototype.getHolder=function(){return this.getRegionDivElem().parentNode.parentNode},StaticRegion.prototype.setData=function(e){var t=this,i=RS.clone(e);setTimeout(function(){t.packFormData(),t.regionData=i,t.proxyData(t.regionData),t.renderData()})},StaticRegion.prototype.getData=function(){return this.packFormData()},StaticRegion.prototype.proxyData=function(e){var a=this;a.regionData=e,a.proxy=new Proxy(e,{get:function(e,t){return e[t]},set:function(e,t,i){var n=null,r=!0;(r=null!=(n=null!=e[t]?e[t]:i)&&n instanceof Object?!1:r)?(e[t]=i,n=a.find("[region-attr='"+t+"']"),RegionUtil.updateValForElem(this,n,i)):((r=RS.clone(a.getData()))[t]=i,a.proxyData(r),a.renderData())}})},StaticRegion.prototype.renderNode=function(targetNode,regionId,paraData,selectDomArray,listTmpDataPara,regionListNamePara,listIndexPara,rowElem){var curRegion=this,tmpRegionId=targetNode.getAttribute("region-id");if(null==tmpRegionId){if(null!=targetNode.getAttribute("region-url"))return}else if(tmpRegionId!=regionId)return;if("MESSAGE"!=targetNode.tagName)if(null==targetNode.getAttribute("msgKey")){var regionListName=null;if(null==regionListNamePara&&(regionListName=targetNode.getAttribute("region-list")),null==regionListName){var regionAttr=targetNode.getAttribute("region-attr"),listNodeChangedState=(targetNode.setAttribute("region-id",regionId),-1),regionDs=targetNode.getAttribute("region-ds"),selectVal,selectVal,tmp,listIndex,tmp,listIndex,val,val,parentRow,primaryField,tmpData,tagName;if(null!=regionDs?(selectVal=null,null==listTmpDataPara?(selectVal=RegionUtil.resolveParaVal(paraData,regionAttr),tmp=$(targetNode),tmp.selectValue=selectVal):(listIndex=listIndexPara,null!=regionAttr&&(selectVal=RegionUtil.resolveParaVal(listTmpDataPara[listIndex],regionAttr)),tmp=$(targetNode),tmp.selectValue=selectVal,tmp.listIndex=listIndex),selectDomArray.push(tmp)):null!=regionAttr?null==listTmpDataPara?this.renderAttribute(targetNode,regionId,RegionUtil.resolveParaVal(paraData,regionAttr),regionAttr,null,null):(listIndex=listIndexPara,val=null,val="index"==regionAttr?listIndex+1:RegionUtil.resolveParaVal(listTmpDataPara[listIndex],regionAttr),parentRow=rowElem,primaryField=parentRow.getAttribute("region-ls-primary"),null==primaryField&&(primaryField="id"),tmpData=listTmpDataPara[listIndex][primaryField],null==tmpData&&(listTmpDataPara[listIndex][primaryField]=RegionUtil.getUUID(),tmpData=listTmpDataPara[listIndex][primaryField]),parentRow.getAttribute("primary-val")!=tmpData&&$(parentRow).attr("primary-val",tmpData),listNodeChangedState=this.renderAttribute(targetNode,regionId,val,regionAttr,regionListNamePara,listIndex)):null==listTmpDataPara&&(tagName=targetNode.tagName,RegionUtil.resolveTag(this,targetNode,tagName,null)),1==listNodeChangedState||-1==listNodeChangedState)for(var childs=targetNode.childNodes,i=0,tmpLength=childs.length;i<tmpLength;i++)null!=childs[i]&&null!=childs[i].tagName&&this.renderNode(childs[i],regionId,paraData,selectDomArray,listTmpDataPara,regionListNamePara,listIndexPara,rowElem);var regionShow=targetNode.getAttribute("region-show"),rowData,paraMap,regionData,scriptVal,jqObj,regionHide,rowData,paraMap,regionData,scriptVal,jqObj,regionRemove,rowData,paraMap,regionData,scriptVal,jqObj;null!=regionShow&&""!=regionShow?(rowData=RegionUtil.getRowData(targetNode),paraMap=this.paraMap,regionData=this.regionData,null!=regionData&&(scriptVal=function(arg,rowData,paraMap,regionData){var scriptVal=!1;return eval("scriptVal=("+arg+")"),scriptVal}(regionShow,rowData,paraMap,regionData),jqObj=$(targetNode),scriptVal?jqObj.removeClass("hidden"):jqObj.addClass("hidden"))):(regionHide=targetNode.getAttribute("region-hide"),null!=regionHide&&""!=regionHide?(rowData=RegionUtil.getRowData(targetNode),paraMap=this.paraMap,regionData=this.regionData,null!=regionData&&(scriptVal=function(arg,rowData,paraMap,regionData){var scriptVal=!1;return eval("scriptVal=("+arg+")"),scriptVal}(regionHide,rowData,paraMap,regionData),jqObj=$(targetNode),scriptVal?jqObj.addClass("hidden"):jqObj.removeClass("hidden"))):(regionRemove=targetNode.getAttribute("region-remove"),null!=regionRemove&&""!=regionRemove&&(rowData=RegionUtil.getRowData(targetNode),paraMap=this.paraMap,regionData=this.regionData,null!=regionData&&(scriptVal=function(arg,rowData,paraMap,regionData){var scriptVal=!1;return eval("scriptVal=("+arg+")"),scriptVal}(regionRemove,rowData,paraMap,regionData),jqObj=$(targetNode),scriptVal&&jqObj.remove()))))}else{var rowsArray=$(targetNode).children("*[index]"),listTmpData=this.regionData[regionListName],oldListTmpData=this.regionUIData[regionListName],template=null,diff=0,tmpClassName=(null==listTmpData&&(listTmpData=[]),null==oldListTmpData&&(oldListTmpData=[]),targetNode.className);if(null==tmpClassName||""===tmpClassName?targetNode.className="region-list":-1==tmpClassName.indexOf("region-list")&&(targetNode.className+=" region-list"),"true"!=targetNode.getAttribute("region-dsrendered")){var childs=targetNode.childNodes;if(0==childs.length)return;template=targetNode.innerHTML;var templateObj=$(template);if(1!=templateObj.length)return void alert("region-list 标签下只能有一个子节点");var targetRegion=this;templateObj.find("message").each(function(e){var t=this.getAttribute("key"),t=RegionUtil.getMessage(targetRegion,t);$(this).replaceWith("<label class='messagelabel "+this.className+"'>"+t+"</label>")}),template=templateObj.prop("outerHTML"),targetNode.innerHTML=this.renderListTag(regionId,listTmpData,template),targetNode.setAttribute("template",template),targetNode.setAttribute("region-dsrendered","true"),diff=listTmpData.length}else{if(template=targetNode.getAttribute("template"),this.buf=[],null==listTmpData&&(listTmpData=[]),null==oldListTmpData&&(oldListTmpData=[]),diff=oldListTmpData.length-listTmpData.length,0<diff)if(diff==oldListTmpData.length)$(targetNode).html("");else for(var childrenTmp=$(targetNode).children(),i=0;i<diff;i++)childrenTmp.eq(oldListTmpData.length-1-i).remove();else if(diff<0){var offset=-diff,tmpTmplate=$(template);tmpTmplate.removeClass("hidden");for(var i=0;i<offset;i++)tmpTmplate.attr("index",oldListTmpData.length+i),this.buf.push($(tmpTmplate).prop("outerHTML"))}$(targetNode).append(this.buf.join("")),this.buf=[]}for(var childs=$(targetNode).children(),template=targetNode.getAttribute("template"),i=0,tmpLength=childs.length,tmpTmplate;i<tmpLength;i++){$(childs).hasClass("inner-region")&&(diff++,tmpTmplate=$(template),tmpTmplate.removeClass("hidden"),tmpTmplate.attr("index",oldListTmpData.length+i),$(childs).replaceWith($(tmpTmplate).prop("outerHTML")))}childs=0!=diff?$(targetNode).children():rowsArray;for(var j=0,i=0,tmpLength=childs.length;i<tmpLength;i++)null!=childs[i].tagName&&childs[i].getAttribute("region-id")==this.regionId&&this.renderRowNode(childs[i],regionId,paraData,selectDomArray,listTmpData,regionListName,j++,childs[i])}}else{var keyVal=targetNode.getAttribute("msgKey"),text=null;try{text=this.getLocaleMsg(keyVal)}catch(e){console.log(e),text=keyVal}$(targetNode).html(text)}else{var keyVal=$(targetNode).attr("key"),text=null;try{text=this.getLocaleMsg(keyVal)}catch(e){console.log("error: message key "+keyVal+" does not exist"),text=keyVal}var labelTagClass=keyVal.substring(keyVal.lastIndexOf(".")+1);$(targetNode).replaceWith("<label class='messagelabel "+targetNode.className+"' key='"+keyVal+"' region-id='"+tmpRegionId+"' class='messagelabel "+labelTagClass+"label'>"+text+"</label>")}},StaticRegion.prototype.resolveInnerTags=function(e){if(null!=e){var t,i,n=null;try{n=e.getAttribute("region-attr")}catch(e){}null!=n?((i=null)!=(t=RS.getRegionById(e.getAttribute("region-id"))).regionData&&(i=t.regionData[n]),RS.resolveTag(this,e,e.tagName,i)):"REGION"==e.tagName&&RS.resolveTag(this,e,"REGION",i);var r=this;if($(e).find("message").each(function(e){var t=this.getAttribute("key"),t=RS.getMessage(r,t);$(this).replaceWith("<label class='messagelabel "+this.className+"'>"+t+"</label>")}),1<e.length)for(var a=0;a<e.length;a++)this.resolveInnerTags(e[a]);var o=e.childNodes;if(null!=o)for(a=0;a<o.length;a++)this.resolveInnerTags(o[a])}},StaticRegion.prototype.renderAttribute=function(e,t,i,n,r,a){null==i&&(i="");var o=e.tagName;if(0<this.renderCount){if(null!=r){if("index"==n)return(s={}).htmlElem=e,s.paraData=i,void this.refreshCells.push(s);var l=a;return null!=this.regionUIData[r]&&null!=this.regionUIData[r][l]&&RegionUtil.resolveParaVal(this.regionUIData[r][l],n)==RegionUtil.resolveParaVal(this.regionData[r][l],n)?0:(RS.isPlainTag(o)?((s={}).htmlElem=e,s.paraData=i,this.refreshCells.push(s)):RegionUtil.updateValForElem(this,$(e),i,l),1)}var s,a=$(e);RegionUtil.resolveParaVal(this.regionUIData,n)!=RegionUtil.resolveParaVal(this.regionData,n)&&(RS.isPlainTag(o)?((s={}).htmlElem=e,s.paraData=i,this.refreshCells.push(s)):RegionUtil.updateValForElem(this,a,i))}else{if("index"==n)return(s={}).htmlElem=e,s.paraData=i,void this.refreshCells.push(s);if(RS.isPlainTag(o))return(s={}).htmlElem=e,s.paraData=i,void this.refreshCells.push(s);RegionUtil.updateValForElem(this,$(e),i,l)}},StaticRegion.prototype.getLocaleMsg=function(e){return RegionUtil.getMessage(this,e)},StaticRegion.prototype.addRegionId=function(e){RegionUtil.addRegionUniqueId(e,this.regionId)},StaticRegion.prototype.validate=function(e){for(var t=this.validationErrors.keySet(),i=0;i<t.length;i++){var n=t[i];this.validationErrors.remove(n).cleanErrorMsg(this)}if(1==this.disableValidaiton)return!0;var r=this.packFormData();for(objAttr in this.validators){var a=this.validators[objAttr];this.checkText(objAttr,a.ruleArray,a.msgArray,RegionUtil.resolveParaVal(r,objAttr))}if(this.validationErrorCount=this.validationErrors.size(),null!=this.childRegionIds)for(i=0;i<this.childRegionIds.length;i++){var o=RegionUtil.getRegionById(this.childRegionIds[i]);null==o||"RegionForm"!=o.type&&"StaticRegion"!=o.type||(o.validate(),this.validationErrorCount+=o.validationErrorCount)}return 1==e&&0<this.validationErrorCount&&RegionUtil.toast(this.validationErrorCount+global_msg.items_to_complete),0==this.validationErrorCount},StaticRegion.prototype.packFormData=function(e){var t={};return this.packNode($(this.getRegionDivElem()),this.regionId,t,e),this.regionUIData=t,RS.mergeData(this.regionUIData,this.regionData),RS.clone(this.regionData)},StaticRegion.prototype.packNode=function(e,t,i,n){var r=e.attr("region-id");if(null==r){if(null!=e.attr("region-url"))return}else if(r!=t)return;r=e.attr("region-list");if(null==r){var a=e.attr("region-attr");if(null!=n){if(null!=a&&e.hasClass(n)&&""!=a){if(e.hasClass("inner"))return;this.packAttribute(e,i,a)}for(var o=e.children(),l=0;l<o.length;l++)this.packNode($(o[l]),t,i,n)}else{if(null!=a&&""!=a){if(e.hasClass("inner"))return;this.packAttribute(e,i,a)}for(o=e.children(),l=0;l<o.length;l++)this.packNode($(o[l]),t,i,null)}}else if(null==n){for(var s=e.children(),g=[],l=0;l<s.length;l++){d={};this.packNode($(s[l]),t,d,null),g.push(d)}i[r]=g}else if(e.hasClass(n)){for(var s=e.children(),g=[],l=0;l<s.length;l++){var d={};this.packNode($(s[l]),t,d,n),g.push(d)}i[r]=g}},StaticRegion.prototype.packAttribute=function(e,t,i){var n,r,a=e.get(0).tagName,o=e.attr("type"),l=RegionUtil.packParaVal(t,i);if(e.hasClass("inner-region"))l[0][l[1]]=RegionTagPlugin.packData(e);else if("INPUT"==a&&(e.hasClass("img")||e.hasClass("file")||e.hasClass("video"))){var t=e.val();if(l[0][l[1]]=[],null!=t&&""!=t)for(var s=t.split(","),d=0;d<s.length;d++){var g={};g.id=s[d],l[0][l[1]].push(g)}}else if(RS.isPlainTag(a))null==e.attr("region-ds")?"false"==e.attr("escapeHtml")?l[0][l[1]]=e.html():l[0][l[1]]=e.text():l[0][l[1]]=e.attr("real-val");else if("VIEW"!=a){if("radio"==o)return t=e.closest(".ds-gen").find("input:radio[region-attr='"+i+"']:checked"),void(l[0][l[1]]=null!=t?t.val():null);"checkbox"!=o?"TD"!=a?"SELECT"==a&&e.attr("multiple")?null!=e.attr("multiple")?(n=[],e.find("> option").each(function(e,t){n.push($(t).val())}),l[0][l[1]]=JSON.stringify(n)):l[0][l[1]]=e.val():"INPUT"==a&&e.parent().hasClass("editable-table-wrapper")?l[0][l[1]]=EditableTablePlugin.packData(e):"INPUT"!=a||"text"!=o&&"hidden"!=o?(r="","string"==(i=typeof e.val())?r=e.val().trim():null==i||(r=e.val()),l[0][l[1]]=""!=r?r:null):(r=(r=null==(r=e.val())?"":r).trim(),l[0][l[1]]=""===r?null:r):l[0][l[1]]=e.text():e.prop("checked")&&((t=(t=null)==(a=l[0][l[1]])||""===a.trim()?[]:JSON.parse(a)).push(e.val()),l[0][l[1]]=JSON.stringify(t))}else l[0][l[1]]=e.attr("real-val")},StaticRegion.prototype.addValidator=function(e,t,i){var n=this.validators[e];null==n&&(this.validators[e]=n={}),n.ruleArray=t,n.msgArray=i},StaticRegion.prototype.removeValidators=function(){this.validators={}},StaticRegion.prototype.removeValidator=function(e){delete this.validators[e]},StaticRegion.prototype.validateItem=function(e){var t=this.validators[e];this.checkText(e,t.ruleArray,t.msgArray,this.getRegionUIAttr(e))},StaticRegion.prototype.getDomObjByBindAttribute=function(e){return this.find("[region-attr='"+e+"']")[0]},StaticRegion.prototype.cleanFields=function(){for(var e=this.find("[region-attr]"),t=0;t<e.length;t++){var i=$(e[t]);"hidden"!=i.attr("type")&&i.val("")}},StaticRegion.prototype.checkText=function(e,t,i,n){if(null==t||0==t.length)return!0;var r=this.getDomObjByBindAttribute(e);if(null!=r){null==n&&(n="");for(var a=$(r).parent().prev().find("."+e+"label").text(),o=(null!=a&&""!==a||(a=e),"region_"+this.regionId+"."+e+"_validation_error"),l=0;l<t.length;l++){if("function"==typeof t[l]){var s,d=t[l](r,this);if(null==d||!0===d)continue;return s=null,s=0==d?i[l]:d,null==(d=this.validationErrors.get(o))?(d=new FieldError(e,o,s,this,a),this.validationErrors.put(o,d)):d.errorMsg=s,d.showErrorMsg(this),!1}if(0==t[l].test(n))return null==(s=this.validationErrors.get(o))?(s=new FieldError(e,o,i[l],this,a),this.validationErrors.put(o,s)):s.errorMsg=i[l],s.showErrorMsg(this),!1}return this.validationErrors.containsKey(o)&&(this.validationErrors.get(o).cleanErrorMsg(this),this.validationErrors.remove(o)),!0}console.log("validation error: attribute "+e+" not found")},StaticRegion.prototype.addFieldError=function(e,t,i){e=new FieldError(e,t,i,this);this.validationErrors.put(t,e)},StaticRegion.prototype.removeFieldError=function(e){this.validationErrors.containsKey(e)&&(this.validationErrors.get(e).cleanErrorMsg(this),this.validationErrors.remove(e))},FieldError.prototype.showErrorMsg=function(e){var t=this.region.getDomObjByBindAttribute(this.regionAttribute);ErrorPromptPlugin.showErrorMsg(t,this,e)},FieldError.prototype.cleanErrorMsg=function(e){var t=this.region.getDomObjByBindAttribute(this.regionAttribute);ErrorPromptPlugin.cleanErrorMsg(t,this,e)},StaticRegion.prototype.disable=function(){RS.disableInput(this,!0)},StaticRegion.prototype.enable=function(){RS.disableInput(this,!1)},StaticRegion.prototype.find=function(e){return RegionUtil.findInRegion(e,this.regionId)},StaticRegion.prototype.getRegionDivContainer=function(){return this.getRegionDivElem().parentNode},StaticRegion.prototype.renderListTag=function(g,e,t){for(var i=$(t),n=(i.removeClass("hidden"),i.attr("region-ls-primary")),r=i.find("[region-attr=index]"),a=null,o=null,l=(0<r.length&&(o="SPAN"==(t=(a=r[0]).tagName)||"TD"==t?"1":"2"),this.buf=[],0),s=0,d=e.length;s<d;s++){var u=e[s];l++,i.attr("index",s),null!=n&&i.attr("primary-val",u[n]),"1"==o?(a.setAttribute("index",l),a.innerText=l):"2"==o&&(a.setAttribute("index",l),r.val(l)),this.buf.push(i.prop("outerHTML"))}i=null;try{return this.buf.join("")}finally{this.buf=[]}},StaticRegion.prototype.renderRowNode=function(targetNode,regionId,paraData,selectDomArray,listTmpDataPara,regionListNamePara,listIndexPara,rowElem){var regionAttr=targetNode.getAttribute("region-attr"),listIndex,parentRow,primaryField,tmpData,listNodeChangedState=(RS.enablePrompt(targetNode),RS.enableCopy(targetNode),null!=listTmpDataPara&&(listIndex=listIndexPara,parentRow=rowElem,primaryField=parentRow.getAttribute("region-ls-primary"),null==primaryField&&(primaryField="id"),tmpData=listTmpDataPara[listIndex][primaryField],null==tmpData&&(listTmpDataPara[listIndex][primaryField]=RegionUtil.getUUID(),tmpData=listTmpDataPara[listIndex][primaryField]),parentRow.getAttribute("primary-val")!=tmpData&&$(parentRow).attr("primary-val",tmpData)),-1),regionDs=targetNode.getAttribute("region-ds"),listIndex,val,val,listNodeChangedState;if(null!=regionDs){var selectVal=null,selectVal,tmp,listIndex,tmp;null==listTmpDataPara?(selectVal=RegionUtil.resolveParaVal(paraData,regionAttr),tmp=$(targetNode),tmp.selectValue=selectVal,selectDomArray.push(tmp)):null!=this.regionUIData[regionListNamePara]&&null!=this.regionUIData[regionListNamePara][listIndexPara]&&RegionUtil.resolveParaVal(this.regionUIData[regionListNamePara][listIndexPara],regionAttr)==RegionUtil.resolveParaVal(this.regionData[regionListNamePara][listIndexPara],regionAttr)||(listIndex=listIndexPara,null!=regionAttr&&(selectVal=RegionUtil.resolveParaVal(listTmpDataPara[listIndex],regionAttr)),tmp=$(targetNode),tmp.selectValue=selectVal,tmp.listIndex=listIndex,selectDomArray.push(tmp))}else{if("REGION"==targetNode.tagName)return void RegionTagPlugin.render(this,$(targetNode),listTmpDataPara[listIndexPara]);null!=regionAttr&&(null==listTmpDataPara?this.renderAttribute(targetNode,regionId,RegionUtil.resolveParaVal(listTmpDataPara[listIndex],regionAttr),regionAttr,null,null):(listIndex=listIndexPara,val=null,val="index"==regionAttr?listIndex+1:RegionUtil.resolveParaVal(listTmpDataPara[listIndex],regionAttr),listNodeChangedState=this.renderAttribute(targetNode,regionId,val,regionAttr,regionListNamePara,listIndex)))}if(1==listNodeChangedState||-1==listNodeChangedState)for(var childs=targetNode.childNodes,i=0,tmpLength=childs.length;i<tmpLength;i++)null!=childs[i].tagName&&this.renderRowNode(childs[i],regionId,paraData,selectDomArray,listTmpDataPara,regionListNamePara,listIndexPara,rowElem);var regionShow=targetNode.getAttribute("region-show"),rowData,paraMap,regionData,scriptVal,jqObj,regionHide,rowData,paraMap,regionData,scriptVal,jqObj,regionRemove,rowData,paraMap,regionData,scriptVal,jqObj;null!=regionShow&&""!=regionShow?(rowData=RegionUtil.getRowData(targetNode),paraMap=this.paraMap,regionData=this.regionData,null!=regionData&&(scriptVal=function(arg,rowData,paraMap,regionData){var scriptVal=!1;return eval("scriptVal=("+arg+")"),scriptVal}(regionShow,rowData,paraMap,regionData),jqObj=$(targetNode),scriptVal?jqObj.removeClass("hidden"):jqObj.addClass("hidden"))):(regionHide=targetNode.getAttribute("region-hide"),null!=regionHide&&""!=regionHide?(rowData=RegionUtil.getRowData(targetNode),paraMap=this.paraMap,regionData=this.regionData,null!=regionData&&(scriptVal=function(arg,rowData,paraMap,regionData){var scriptVal=!1;return eval("scriptVal=("+arg+")"),scriptVal}(regionHide,rowData,paraMap,regionData),jqObj=$(targetNode),scriptVal?jqObj.addClass("hidden"):jqObj.removeClass("hidden"))):(regionRemove=targetNode.getAttribute("region-remove"),null!=regionRemove&&""!=regionRemove&&(rowData=RegionUtil.getRowData(targetNode),paraMap=this.paraMap,regionData=this.regionData,null!=regionData&&(scriptVal=function(arg,rowData,paraMap,regionData){var scriptVal=!1;return eval("scriptVal=("+arg+")"),scriptVal}(regionRemove,rowData,paraMap,regionData),jqObj=$(targetNode),scriptVal&&jqObj.remove()))))},StaticRegion.prototype.release=function(){"function"==typeof this.onRelease&&this.onRelease(),this.removeWebsocketTopicListeners(),this.clearEventListeners();var e=this.childRegionIds;if(delete window.regions[this.regionId],delete window["region_"+this.regionId],$(this.getRegionDivElem()).parent().remove(),null!=e){for(var t=0;t<e.length;t++){var i=RegionUtil.getRegionById(e[t]);null!=i&&i.release()}this.childRegionIds=null}RS.callOnReleaseHock(this)},StaticRegion.prototype.removeWebsocketTopicListeners=function(){var e=this.topicListenersReg;if(null!=e)for(x in e)e[x].release();delete this.topicListenersReg},StaticRegion.prototype.releaseChildRegions=function(){var e=this.childRegionIds;if(null!=e){for(var t=0;t<e.length;t++){var i=RegionUtil.getRegionById(e[t]);null!=i&&i.release()}this.childRegionIds=null}},StaticRegion.prototype.addEventListener=function(e,t){return null==e?(console.error("eventCode is empty"),!1):null==t?(console.error("eventListener is empty"),!1):(null==this.listenerRegistry&&(this.listenerRegistry={}),null!=this.listenerRegistry[e]?(console.error("exists listener for eventCode:"+e+",ignored this listener"),!1):((this.listenerRegistry[e]=t).regionId=this.regionId,RegionUtil.eventBus().addEventListener(e,t),!0))},StaticRegion.prototype.removeEventListener=function(e){var t=this.listenerRegistry[e];return null!=t&&(this.listenerRegistry[e]=null,RegionUtil.eventBus().removeListener(e,t),!0)},StaticRegion.prototype.clearEventListeners=function(){this.listenerRegistry=null,RegionUtil.eventBus().removeListenersForRegion(this)},StaticRegion.prototype.publishEvent=function(e,t){var i={};i.eventCode=e,i.eventData=t,RegionUtil.eventBus().publishEvent(i)},StaticRegion.prototype.addInterval=function(e,t){e=setInterval(e,t);return e.id=RegionUtil.UUID(),null==this.intervals&&(this.intervals={}),this.intervals[e.id]=e},StaticRegion.prototype.clearIntervals=function(){if(null!=this.intervals)for(x in this.intervals)clearInterval(this.intervals[x])},StaticRegion.prototype.setRegionUIAttr=function(e,t){e=this.find("[region-attr='"+e+"']");RegionUtil.updateValForElem(this,e,t,null)},StaticRegion.prototype.getRegionUIAttr=function(e){e=this.find("[region-attr='"+e+"']"),e=RegionUtil.getAttriObjVal(e);return e=""===e?null:e};